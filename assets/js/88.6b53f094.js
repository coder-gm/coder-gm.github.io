(window.webpackJsonp=window.webpackJsonp||[]).push([[88],{706:function(s,a,t){"use strict";t.r(a);var e=t(33),_=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"第1章-视图"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第1章-视图"}},[s._v("#")]),s._v(" 第1章 视图")]),s._v(" "),t("h2",{attrs:{id:"_1-常见的数据库对象"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-常见的数据库对象"}},[s._v("#")]),s._v(" "),t("strong",[s._v("1.")]),s._v(" "),t("strong",[s._v("常见的数据库对象")])]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("对象")]),s._v(" "),t("th",[s._v("描述")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("表(TABLE)")]),s._v(" "),t("td",[s._v("表是存储数据的逻辑单元，以行和列的形式存在，列就是字段，行就是记录")])]),s._v(" "),t("tr",[t("td",[s._v("数据字典")]),s._v(" "),t("td",[s._v("就是系统表，存放数据库相关信息的表。系统表的数据通常由数据库系统维护，程序员通常不应该修改，只可查看")])]),s._v(" "),t("tr",[t("td",[s._v("约束(CONSTRAINT)")]),s._v(" "),t("td",[s._v("执行数据校验的规则，用于保证数据完整性的规则")])]),s._v(" "),t("tr",[t("td",[s._v("视图(VIEW)")]),s._v(" "),t("td",[s._v("一个或者多个数据表里的数据的逻辑显示，视图并不存储数据")])]),s._v(" "),t("tr",[t("td",[s._v("索引(INDEX)")]),s._v(" "),t("td",[s._v("用于提高查询性能，相当于书的目录")])]),s._v(" "),t("tr",[t("td",[s._v("存储过程(PROCEDURE)")]),s._v(" "),t("td",[s._v("用于完成一次完整的业务处理，没有返回值，但可通过传出参数将多个值传给调用环境")])]),s._v(" "),t("tr",[t("td",[s._v("存储函数(FUNCTION)")]),s._v(" "),t("td",[s._v("用于完成一次特定的计算，具有一个返回值")])]),s._v(" "),t("tr",[t("td",[s._v("触发器(TRIGGER)")]),s._v(" "),t("td",[s._v("相当于一个事件监听器，当数据库发生特定事件后，触发器被触发，完成相应的处理")])])])]),s._v(" "),t("h2",{attrs:{id:"_2-视图概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-视图概述"}},[s._v("#")]),s._v(" "),t("strong",[s._v("2.")]),s._v(" "),t("strong",[s._v("视图概述")])]),s._v(" "),t("h3",{attrs:{id:"_2-1-为什么使用视图"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-为什么使用视图"}},[s._v("#")]),s._v(" "),t("strong",[s._v("2.1")]),s._v(" "),t("strong",[s._v("为什么使用视图？")])]),s._v(" "),t("p",[s._v("视图一方面可以帮我们使用表的一部分而不是所有的表，另一方面也可以针对不同的用户制定不同的查询视图。")]),s._v(" "),t("h3",{attrs:{id:"_2-2-视图的理解"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-视图的理解"}},[s._v("#")]),s._v(" "),t("strong",[s._v("2.2")]),s._v(" "),t("strong",[s._v("视图的理解")])]),s._v(" "),t("ul",[t("li",[s._v("视图是一种"),t("code",[s._v("虚拟表")]),s._v("，本身是"),t("code",[s._v("不具有数据")]),s._v("的，占用很少的内存空间，它是 SQL 中的一个重要概念。")]),s._v(" "),t("li",[t("strong",[s._v("视图建立在已有表的基础上")]),s._v(", 视图赖以建立的这些表称为"),t("strong",[s._v("基表")]),s._v("。")]),s._v(" "),t("li",[s._v("视图的创建和删除只影响视图本身，不影响对应的基表。但是当对视图中的数据进行增加、删除和修改操作时，数据表中的数据会相应地发生变化，反之亦然。")]),s._v(" "),t("li",[s._v("向视图提供数据内容的语句为 SELECT 语句, 可以将视图理解为"),t("strong",[s._v("存储起来的")]),s._v(" "),t("strong",[s._v("SELECT")]),s._v(" "),t("strong",[s._v("语句")]),s._v(" "),t("ul",[t("li",[s._v("在数据库中，视图不会保存数据，数据真正保存在数据表中。当对视图中的数据进行增加、删除和修改操作时，数据表中的数据会相应地发生变化；反之亦然。")])])]),s._v(" "),t("li",[s._v("视图，是向用户提供基表数据的另一种表现形式。通常情况下，小型项目的数据库可以不使用视图，但是在大型项目中，以及数据表比较复杂的情况下，视图的价值就凸显出来了，它可以帮助我们把经常查询的结果集放到虚拟表中，提升使用效率。理解和使用起来都非常方便。")])]),s._v(" "),t("h2",{attrs:{id:"_3-创建视图"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-创建视图"}},[s._v("#")]),s._v(" "),t("strong",[s._v("3.")]),s._v(" "),t("strong",[s._v("创建视图")])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("在")]),s._v(" "),t("strong",[s._v("CREATE VIEW")]),s._v(" "),t("strong",[s._v("语句中嵌入子查询")])])]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("CREATE [OR REPLACE] \n[ALGORITHM = {UNDEFINED | MERGE | TEMPTABLE}] \nVIEW 视图名称 [(字段列表)] \nAS 查询语句 \n[WITH [CASCADED|LOCAL] CHECK OPTION]\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[s._v("精简版")])]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("CREATE VIEW 视图名称 \nAS 查询语句\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"_4-查看视图"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-查看视图"}},[s._v("#")]),s._v(" "),t("strong",[s._v("4.")]),s._v(" "),t("strong",[s._v("查看视图")])]),s._v(" "),t("p",[s._v("语法1：查看数据库的表对象、视图对象")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("SHOW TABLES;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("语法2：查看视图的结构")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("DESC / DESCRIBE 视图名称;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("语法3：查看视图的属性信息")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 查看视图信息（显示数据表的存储引擎、版本、数据行数和数据大小等） \nSHOW TABLE STATUS LIKE '视图名称'\\G\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("执行结果显示，注释Comment为VIEW，说明该表为视图，其他的信息为NULL，说明这是一个虚表。")]),s._v(" "),t("p",[s._v("语法4：查看视图的详细定义信息")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("SHOW CREATE VIEW 视图名称;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"_5-更新视图的数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-更新视图的数据"}},[s._v("#")]),s._v(" "),t("strong",[s._v("5.")]),s._v(" "),t("strong",[s._v("更新视图的数据")])]),s._v(" "),t("h3",{attrs:{id:"_5-1-一般情况"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-一般情况"}},[s._v("#")]),s._v(" "),t("strong",[s._v("5.1")]),s._v(" "),t("strong",[s._v("一般情况")])]),s._v(" "),t("p",[s._v("MySQL支持使用INSERT、UPDATE和DELETE语句对视图中的数据进行插入、更新和删除操作。当视图中的数据发生变化时，数据表中的数据也会发生变化，反之亦然。")]),s._v(" "),t("h3",{attrs:{id:"_5-2-不可更新的视图"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-不可更新的视图"}},[s._v("#")]),s._v(" "),t("strong",[s._v("5.2")]),s._v(" "),t("strong",[s._v("不可更新的视图")])]),s._v(" "),t("p",[s._v("要使视图可更新，视图中的行和底层基本表中的行之间必须存在"),t("code",[s._v("一对一")]),s._v("的关系。另外当视图定义出现如下情况时，视图不支持更新操作：")]),s._v(" "),t("ul",[t("li",[s._v("在定义视图的时候指定了“ALGORITHM = TEMPTABLE”，视图将不支持INSERT和DELETE操作；")]),s._v(" "),t("li",[s._v("视图中不包含基表中所有被定义为非空又未指定默认值的列，视图将不支持INSERT操作；")]),s._v(" "),t("li",[s._v("在定义视图的SELECT语句中使用了"),t("code",[s._v("JOIN联合查询")]),s._v("，视图将不支持INSERT和DELETE操作；")]),s._v(" "),t("li",[s._v("在定义视图的SELECT语句后的字段列表中使用了"),t("code",[s._v("数学表达式")]),s._v("或"),t("code",[s._v("子查询")]),s._v("，视图将不支持INSERT，也不支持UPDATE使用了数学表达式、子查询的字段值；")]),s._v(" "),t("li",[s._v("在定义视图的SELECT语句后的字段列表中使用"),t("code",[s._v("DISTINCT")]),s._v("、"),t("code",[s._v("聚合函数")]),s._v("、"),t("code",[s._v("GROUP BY")]),s._v("、"),t("code",[s._v("HAVING")]),s._v("、"),t("code",[s._v("UNION")]),s._v("等，视图将不支持INSERT、UPDATE、DELETE；")]),s._v(" "),t("li",[s._v("在定义视图的SELECT语句中包含了子查询，而子查询中引用了FROM后面的表，视图将不支持 INSERT、UPDATE、DELETE；")]),s._v(" "),t("li",[s._v("视图定义基于一个"),t("code",[s._v("不可更新视图")]),s._v("；")]),s._v(" "),t("li",[s._v("常量视图")])]),s._v(" "),t("blockquote",[t("p",[s._v("虽然可以更新视图数据，但总的来说，视图作为"),t("code",[s._v("虚拟表")]),s._v("，主要用于"),t("code",[s._v("方便查询")]),s._v("，不建议更新视图的数据。"),t("strong",[s._v("对视图数据的更改，都是通过对实际数据表里数据的操作来完成的。")])])]),s._v(" "),t("h2",{attrs:{id:"_6-修改、删除视图"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-修改、删除视图"}},[s._v("#")]),s._v(" "),t("strong",[s._v("6.")]),s._v(" "),t("strong",[s._v("修改、删除视图")])]),s._v(" "),t("h3",{attrs:{id:"_6-1-修改视图"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-修改视图"}},[s._v("#")]),s._v(" "),t("strong",[s._v("6.1")]),s._v(" "),t("strong",[s._v("修改视图")])]),s._v(" "),t("p",[s._v("方式1：使用CREATE "),t("strong",[s._v("OR REPLACE")]),s._v(" VIEW 子句"),t("strong",[s._v("修改视图")])]),s._v(" "),t("p",[s._v("方式2：ALTER VIEW")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("ALTER VIEW 视图名称 \nAS\n查询语句\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"_6-2-删除视图"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-删除视图"}},[s._v("#")]),s._v(" "),t("strong",[s._v("6.2")]),s._v(" "),t("strong",[s._v("删除视图")])]),s._v(" "),t("ul",[t("li",[s._v("删除视图只是删除视图的定义，并不会删除基表的数据。")])]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("DROP VIEW IF EXISTS 视图名称;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"_7-总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-总结"}},[s._v("#")]),s._v(" "),t("strong",[s._v("7.")]),s._v(" "),t("strong",[s._v("总结")])]),s._v(" "),t("h3",{attrs:{id:"_7-1-视图优点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-视图优点"}},[s._v("#")]),s._v(" "),t("strong",[s._v("7.1")]),s._v(" "),t("strong",[s._v("视图优点")])]),s._v(" "),t("p",[t("strong",[s._v("1.")]),s._v(" "),t("strong",[s._v("操作简单")])]),s._v(" "),t("p",[s._v("将经常使用的查询操作定义为视图，可以使开发人员不需要关心视图对应的数据表的结构、表与表之间的关联关系，也不需要关心数据表之间的业务逻辑和查询条件，而只需要简单地操作视图即可，极大简化了开发人员对数据库的操作。")]),s._v(" "),t("p",[t("strong",[s._v("2.")]),s._v(" "),t("strong",[s._v("减少数据冗余")])]),s._v(" "),t("p",[s._v("视图跟实际数据表不一样，它存储的是查询语句。所以，在使用的时候，我们要通过定义视图的查询语句来获取结果集。而视图本身不存储数据，不占用数据存储的资源，减少了数据冗余。")]),s._v(" "),t("p",[t("strong",[s._v("3.")]),s._v(" "),t("strong",[s._v("数据安全")])]),s._v(" "),t("p",[s._v("MySQL将用户对数据的"),t("code",[s._v("访问限制")]),s._v("在某些数据的结果集上，而这些数据的结果集可以使用视图来实现。用户不必直接查询或操作数据表。这也可以理解为视图具有"),t("code",[s._v("隔离性")]),s._v("。视图相当于在用户和实际的数据表之间加了一层虚拟表。")]),s._v(" "),t("p",[s._v("同时，MySQL可以根据权限将用户对数据的访问限制在某些视图上，"),t("strong",[s._v("用户不需要查询数据表，可以直接通过视图获取数据表中的信息")]),s._v("。这在一定程度上保障了数据表中数据的安全性。")]),s._v(" "),t("p",[t("strong",[s._v("4.")]),s._v(" "),t("strong",[s._v("适应灵活多变的需求")]),s._v(" 当业务系统的需求发生变化后，如果需要改动数据表的结构，则工作量相对较大，可以使用视图来减少改动的工作量。这种方式在实际工作中使用得比较多。")]),s._v(" "),t("p",[t("strong",[s._v("5.")]),s._v(" "),t("strong",[s._v("能够分解复杂的查询逻辑")]),s._v(" 数据库中如果存在复杂的查询逻辑，则可以将问题进行分解，创建多个视图获取数据，再将创建的多个视图结合起来，完成复杂的查询逻辑。")]),s._v(" "),t("h3",{attrs:{id:"_7-2-视图不足"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-视图不足"}},[s._v("#")]),s._v(" "),t("strong",[s._v("7.2")]),s._v(" "),t("strong",[s._v("视图不足")])]),s._v(" "),t("p",[s._v("如果我们在实际数据表的基础上创建了视图，那么，"),t("strong",[s._v("如果实际数据表的结构变更了，我们就需要及时对相关的视图进行相应的维护")]),s._v("。特别是嵌套的视图（就是在视图的基础上创建视图），维护会变得比较复杂， 可读性不好 ，容易变成系统的潜在隐患。因为创建视图的 SQL 查询可能会对字段重命名，也可能包含复杂的逻辑，这些都会增加维护的成本。")]),s._v(" "),t("p",[s._v("实际项目中，如果视图过多，会导致数据库维护成本的问题。")]),s._v(" "),t("p",[s._v("所以，在创建视图的时候，你要结合实际项目需求，综合考虑视图的优点和不足，这样才能正确使用视图，使系统整体达到最优。")]),s._v(" "),t("h1",{attrs:{id:"第2章-存储过程与函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第2章-存储过程与函数"}},[s._v("#")]),s._v(" 第2章 存储过程与函数")]),s._v(" "),t("h2",{attrs:{id:"_1-存储过程概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-存储过程概述"}},[s._v("#")]),s._v(" "),t("strong",[s._v("1.")]),s._v(" "),t("strong",[s._v("存储过程概述")])]),s._v(" "),t("h3",{attrs:{id:"_1-1-理解"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-理解"}},[s._v("#")]),s._v(" "),t("strong",[s._v("1.1")]),s._v(" "),t("strong",[s._v("理解")])]),s._v(" "),t("p",[t("strong",[s._v("含义")]),s._v("：存储过程的英文是"),t("code",[s._v("Stored Procedure")]),s._v("。它的思想很简单，就是一组经过"),t("code",[s._v("预先编译")]),s._v("的 SQL 语句的封装。")]),s._v(" "),t("p",[s._v("执行过程：存储过程预先存储在 MySQL 服务器上，需要执行的时候，客户端只需要向服务器端发出调用存储过程的命令，服务器端就可以把预先存储好的这一系列 SQL 语句全部执行。")]),s._v(" "),t("h2",{attrs:{id:"_2-创建存储过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-创建存储过程"}},[s._v("#")]),s._v(" "),t("strong",[s._v("2.")]),s._v(" "),t("strong",[s._v("创建存储过程")])]),s._v(" "),t("h3",{attrs:{id:"_2-1-语法分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-语法分析"}},[s._v("#")]),s._v(" "),t("strong",[s._v("2.1")]),s._v(" "),t("strong",[s._v("语法分析")])]),s._v(" "),t("p",[s._v("语法：")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("CREATE PROCEDURE 存储过程名(IN|OUT|INOUT 参数名 参数类型,...) \n[characteristics ...] \nBEGIN\n\t存储过程体 \nEND\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("说明：")]),s._v(" "),t("p",[s._v("1、参数前面的符号的意思")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("IN")]),s._v("：当前参数为输入参数，也就是表示入参；\n"),t("ul",[t("li",[s._v("存储过程只是读取这个参数的值。如果没有定义参数种类，"),t("code",[s._v("默认就是 IN")]),s._v("，表示输入参数。")])])]),s._v(" "),t("li",[t("code",[s._v("OUT")]),s._v("：当前参数为输出参数，也就是表示出参；\n"),t("ul",[t("li",[s._v("执行完成之后，调用这个存储过程的客户端或者应用程序就可以读取这个参数返回的值了。")])])]),s._v(" "),t("li",[t("code",[s._v("INOUT")]),s._v("：当前参数既可以为输入参数，也可以为输出参数。")])]),s._v(" "),t("p",[s._v("2、形参类型可以是 MySQL数据库中的任意类型。")]),s._v(" "),t("p",[s._v("3、"),t("code",[s._v("characteristics")]),s._v("表示创建存储过程时指定的对存储过程的约束条件，其取值信息如下：")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("LANGUAGE SQL \n| [NOT] DETERMINISTIC \n| { CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA } \n| SQL SECURITY { DEFINER | INVOKER } \n| COMMENT 'string'\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[t("p",[t("code",[s._v("LANGUAGE SQL")]),s._v("：说明存储过程执行体是由SQL语句组成的，当前系统支持的语言为SQL。")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("[NOT] DETERMINISTIC")]),s._v("：指明存储过程执行的结果是否确定。DETERMINISTIC表示结果是确定的。每次执行存储过程时，相同的输入会得到相同的输出。NOT DETERMINISTIC表示结果是不确定的，相同的输入可能得到不同的输出。如果没有指定任意一个值，默认为NOT DETERMINISTIC。")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("{ CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA }")]),s._v("：指明子程序使用SQL语句的限制。")]),s._v(" "),t("ul",[t("li",[s._v("CONTAINS SQL表示当前存储过程的子程序包含SQL语句，但是并不包含读写数据的SQL语句；")]),s._v(" "),t("li",[s._v("NO SQL表示当前存储过程的子程序中不包含任何SQL语句；")]),s._v(" "),t("li",[s._v("READS SQL DATA表示当前存储过程的子程序中包含读数据的SQL语句；")]),s._v(" "),t("li",[s._v("MODIFIES SQL DATA表示当前存储过程的子程序中包含写数据的SQL语句。")]),s._v(" "),t("li",[s._v("默认情况下，系统会指定为CONTAINS SQL。")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("SQL SECURITY { DEFINER | INVOKER }")]),s._v("：执行当前存储过程的权限，即指明哪些用户能够执行当前存储过程。")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("DEFINER")]),s._v("表示只有当前存储过程的创建者或者定义者才能执行当前存储过程；")]),s._v(" "),t("li",[t("code",[s._v("INVOKER")]),s._v("表示拥有当前存储过程的访问权限的用户能够执行当前存储过程。")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("COMMENT 'string'")]),s._v("：注释信息，可以用来描述存储过程。")])])]),s._v(" "),t("p",[s._v("4、存储过程体中可以有多条 SQL 语句，如果仅仅一条SQL 语句，则可以省略 BEGIN 和 END")]),s._v(" "),t("p",[s._v("5、需要设置新的结束标记")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("DELIMITER 新的结束标记\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_2-2-代码举例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-代码举例"}},[s._v("#")]),s._v(" "),t("strong",[s._v("2.2")]),s._v(" "),t("strong",[s._v("代码举例")])]),s._v(" "),t("p",[s._v("举例1：创建存储过程select_all_data()，查看 emps 表的所有数据")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DELIMITER")]),s._v(" $ \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" select_all_data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" emps"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v(" $ \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DELIMITER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("举例2：创建存储过程avg_employee_salary()，返回所有员工的平均工资")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("DELIMITER // \nCREATE PROCEDURE avg_employee_salary () \nBEGIN\n\tSELECT AVG(salary) AS avg_salary FROM emps; \nEND // \nDELIMITER ;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("举例3：创建存储过程show_max_salary()，用来查看“emps”表的最高薪资值。")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("DELIMITER // \nCREATE PROCEDURE show_max_salary() \n    LANGUAGE SQL\n    NOT DETERMINISTIC\n    CONTAINS SQL \n    SQL SECURITY DEFINER \n    COMMENT '查看最高薪资' \nBEGIN\n\tSELECT MAX(salary) FROM emps;\nEND // \nDELIMITER ;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("举例4：创建存储过程show_someone_salary2()，查看“emps”表的某个员工的薪资，并用IN参数empname输入员工姓名，用OUT参数empsalary输出员工薪资。")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("DELIMITER // \nCREATE PROCEDURE show_someone_salary2(IN empname VARCHAR(20),OUT empsalary DOUBLE) \nBEGIN\n\tSELECT salary INTO empsalary FROM emps WHERE ename = empname; \nEND // \nDELIMITER ;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("举例5：创建存储过程show_mgr_name()，查询某个员工领导的姓名，并用INOUT参数“empname”输入员工姓名，输出领导的姓名。")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("DELIMITER // \nCREATE PROCEDURE show_mgr_name(INOUT empname VARCHAR(20)) \nBEGIN\n\tSELECT ename INTO empname FROM emps WHERE eid = (SELECT MID FROM emps WHERE ename=empname); \nEND // \nDELIMITER ;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h2",{attrs:{id:"_3-调用存储过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-调用存储过程"}},[s._v("#")]),s._v(" "),t("strong",[s._v("3.")]),s._v(" "),t("strong",[s._v("调用存储过程")])]),s._v(" "),t("h3",{attrs:{id:"_3-1-调用格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-调用格式"}},[s._v("#")]),s._v(" "),t("strong",[s._v("3.1")]),s._v(" "),t("strong",[s._v("调用格式")])]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("CALL 存储过程名(实参列表)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("格式：")])]),s._v(" "),t("p",[s._v("1、调用in模式的参数：")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("CALL sp1('值');\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("2、调用out模式的参数：")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("SET @name; \nCALL sp1(@name); \nSELECT @name;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("3、调用inout模式的参数：")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("SET @name=值; \nCALL sp1(@name); \nSELECT @name;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"_4-存储函数的使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-存储函数的使用"}},[s._v("#")]),s._v(" "),t("strong",[s._v("4.")]),s._v(" "),t("strong",[s._v("存储函数的使用")])]),s._v(" "),t("h3",{attrs:{id:"_4-1-语法分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-语法分析"}},[s._v("#")]),s._v(" "),t("strong",[s._v("4.1")]),s._v(" "),t("strong",[s._v("语法分析")])]),s._v(" "),t("p",[s._v("语法格式：")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("CREATE FUNCTION 函数名(参数名 参数类型,...) \nRETURNS 返回值类型 \n[characteristics ...] \nBEGIN\n\t函数体 #函数体中肯定有 RETURN 语句 \nEND\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("说明：")]),s._v(" "),t("p",[s._v("1、参数列表：指定参数为IN、OUT或INOUT只对PROCEDURE是合法的，FUNCTION中总是默认为IN参数。")]),s._v(" "),t("p",[s._v("2、RETURNS type 语句表示函数返回数据的类型；")]),s._v(" "),t("p",[s._v("RETURNS子句只能对FUNCTION做指定，对函数而言这是"),t("code",[s._v("强制")]),s._v("的。它用来指定函数的返回类型，而且函数体必须包含一个"),t("code",[s._v("RETURN value")]),s._v("语句。")]),s._v(" "),t("p",[s._v("3、characteristic 创建函数时指定的对函数的约束。取值与创建存储过程时相同，这里不再赘述。")]),s._v(" "),t("p",[s._v("4、函数体也可以用BEGIN…END来表示SQL代码的开始和结束。如果函数体只有一条语句，也可以省略BEGIN…END。")]),s._v(" "),t("h3",{attrs:{id:"_4-2-调用存储函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-调用存储函数"}},[s._v("#")]),s._v(" "),t("strong",[s._v("4.2")]),s._v(" "),t("strong",[s._v("调用存储函数")])]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("SELECT 函数名(实参列表)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_4-3-代码举例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-代码举例"}},[s._v("#")]),s._v(" "),t("strong",[s._v("4.3")]),s._v(" "),t("strong",[s._v("代码举例")])]),s._v(" "),t("p",[s._v("创建存储函数count_by_id()，参数传入dept_id，该函数查询dept_id部门的员工人数，并返回，数据类型为整型。")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("DELIMITER // \nCREATE FUNCTION count_by_id(dept_id INT) \nRETURNS INT \n\tLANGUAGE SQL \n\tNOT DETERMINISTIC \n\tREADS SQL DATA \n\tSQL SECURITY DEFINER \n\tCOMMENT '查询部门平均工资' \nBEGIN\n\tRETURN (SELECT COUNT(*) FROM employees WHERE department_id = dept_id); \nEND // \nDELIMITER ;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("调用：")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("SET @dept_id = 50; \nSELECT count_by_id(@dept_id);\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("strong",[s._v("注意：")])]),s._v(" "),t("p",[s._v("若在创建存储函数中报错“"),t("code",[s._v("you might want to use the less safe log_bin_trust_function_creators variable")]),s._v("”，有两种处理方法：")]),s._v(" "),t("ul",[t("li",[s._v("方式1：加上必要的函数特性“[NOT] DETERMINISTIC”和“{CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA}”")]),s._v(" "),t("li",[s._v("方式2：")])]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("mysql> SET GLOBAL log_bin_trust_function_creators = 1;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_4-4-对比存储函数和存储过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-对比存储函数和存储过程"}},[s._v("#")]),s._v(" "),t("strong",[s._v("4.4")]),s._v(" "),t("strong",[s._v("对比存储函数和存储过程")])]),s._v(" "),t("table",[t("thead",[t("tr",[t("th"),s._v(" "),t("th",[s._v("关键字")]),s._v(" "),t("th",[s._v("调用语法")]),s._v(" "),t("th",[s._v("返回值")]),s._v(" "),t("th",[s._v("应用场景")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("存储过程")]),s._v(" "),t("td",[s._v("PROCEDURE")]),s._v(" "),t("td",[s._v("CALL 存储过程()")]),s._v(" "),t("td",[s._v("理解为有0个或多个")]),s._v(" "),t("td",[s._v("一般用于更新")])]),s._v(" "),t("tr",[t("td",[s._v("存储函数")]),s._v(" "),t("td",[s._v("FUNCTION")]),s._v(" "),t("td",[s._v("SELECT 函数()")]),s._v(" "),t("td",[s._v("只能是一个")]),s._v(" "),t("td",[s._v("一般用于查询结果为一个值并返回时")])])])]),s._v(" "),t("p",[s._v("此外，"),t("strong",[s._v("存储函数可以放在查询语句中使用，存储过程不行")]),s._v("。反之，存储过程的功能更加强大，包括能够执行对表的操作（比如创建表，删除表等）和事务操作，这些功能是存储函数不具备的。")]),s._v(" "),t("h2",{attrs:{id:"_5-存储过程和函数的查看、修改、删除"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-存储过程和函数的查看、修改、删除"}},[s._v("#")]),s._v(" "),t("strong",[s._v("5.")]),s._v(" "),t("strong",[s._v("存储过程和函数的查看、修改、删除")])]),s._v(" "),t("h3",{attrs:{id:"_5-1-查看"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-查看"}},[s._v("#")]),s._v(" "),t("strong",[s._v("5.1")]),s._v(" "),t("strong",[s._v("查看")])]),s._v(" "),t("p",[t("strong",[s._v("1.")]),s._v(" "),t("strong",[s._v("使用SHOW CREATE语句查看存储过程和函数的创建信息")])]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("SHOW CREATE {PROCEDURE | FUNCTION} 存储过程名或函数名\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("2.")]),s._v(" "),t("strong",[s._v("使用SHOW STATUS语句查看存储过程和函数的状态信息")])]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("SHOW {PROCEDURE | FUNCTION} STATUS [LIKE 'pattern']\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("3.")]),s._v(" "),t("strong",[s._v("从information_schema.Routines表中查看存储过程和函数的信息")])]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("SELECT * FROM information_schema.Routines \nWHERE ROUTINE_NAME='存储过程或函数的名' [AND ROUTINE_TYPE = {'PROCEDURE|FUNCTION'}];\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"_5-2-修改"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-修改"}},[s._v("#")]),s._v(" "),t("strong",[s._v("5.2")]),s._v(" "),t("strong",[s._v("修改")])]),s._v(" "),t("p",[s._v("修改存储过程或函数，不影响存储过程或函数功能，只是修改相关特性。使用ALTER语句实现。")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("ALTER {PROCEDURE | FUNCTION} 存储过程或函数的名 [characteristic ...];\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("其中，characteristic指定存储过程或函数的特性，其取值信息与创建存储过程、函数时的取值信息略有不同。")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("{ CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA } \n| SQL SECURITY { DEFINER | INVOKER } \n| COMMENT 'string'\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"_5-3-删除"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-删除"}},[s._v("#")]),s._v(" "),t("strong",[s._v("5.3")]),s._v(" "),t("strong",[s._v("删除")])]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("DROP {PROCEDURE | FUNCTION} [IF EXISTS] 存储过程或函数的名;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"_6-关于存储过程使用的争议"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-关于存储过程使用的争议"}},[s._v("#")]),s._v(" "),t("strong",[s._v("6.")]),s._v(" "),t("strong",[s._v("关于存储过程使用的争议")])]),s._v(" "),t("h3",{attrs:{id:"_6-1-优点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-优点"}},[s._v("#")]),s._v(" "),t("strong",[s._v("6.1")]),s._v(" "),t("strong",[s._v("优点")])]),s._v(" "),t("p",[s._v("**1、存储过程可以一次编译多次使用。**存储过程只在创建时进行编译，之后的使用都不需要重新编译，这就提升了 SQL 的执行效率。")]),s._v(" "),t("p",[s._v("**2、可以减少开发工作量。**将代码"),t("code",[s._v("封装")]),s._v("成模块，实际上是编程的核心思想之一，这样可以把复杂的问题拆解成不同的模块，然后模块之间可以"),t("code",[s._v("重复使用")]),s._v("，在减少开发工作量的同时，还能保证代码的结构清晰。")]),s._v(" "),t("p",[s._v("**3、存储过程的安全性强。**我们在设定存储过程的时候可以"),t("code",[s._v("设置对用户的使用权限")]),s._v("，这样就和视图一样具有较强的安全性。")]),s._v(" "),t("p",[s._v("**4、可以减少网络传输量。**因为代码封装到存储过程中，每次使用只需要调用存储过程即可，这样就减少了网络传输量。")]),s._v(" "),t("p",[s._v("**5、良好的封装性。**在进行相对复杂的数据库操作时，原本需要使用一条一条的 SQL 语句，可能要连接多次数据库才能完成的操作，现在变成了一次存储过程，只需要"),t("code",[s._v("连接一次即可")]),s._v("。")]),s._v(" "),t("h3",{attrs:{id:"_6-2-缺点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-缺点"}},[s._v("#")]),s._v(" "),t("strong",[s._v("6.2")]),s._v(" "),t("strong",[s._v("缺点")])]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("阿里开发规范")])]),s._v(" "),t("p",[s._v("【强制】禁止使用存储过程，存储过程难以调试和扩展，更没有移植性。")])]),s._v(" "),t("p",[s._v("**1、可移植性差。**存储过程不能跨数据库移植，比如在 MySQL、Oracle 和 SQL Server 里编写的存储过程，在换成其他数据库时都需要重新编写。")]),s._v(" "),t("p",[s._v("**2、调试困难。**只有少数 DBMS 支持存储过程的调试。对于复杂的存储过程来说，开发和维护都不容易。虽然也有一些第三方工具可以对存储过程进行调试，但要收费。")]),s._v(" "),t("p",[s._v("**3、存储过程的版本管理很困难。**比如数据表索引发生变化了，可能会导致存储过程失效。我们在开发软件的时候往往需要进行版本管理，但是存储过程本身没有版本控制，版本迭代更新的时候很麻烦。")]),s._v(" "),t("p",[s._v("**4、它不适合高并发的场景。**高并发的场景需要减少数据库的压力，有时数据库会采用分库分表的方式，而且对可扩展性要求很高，在这种情况下，存储过程会变得难以维护， 增加数据库的压力 ，显然就不适用了。")]),s._v(" "),t("p",[s._v("小结：")]),s._v(" "),t("p",[s._v("存储过程既方便，又有局限性。尽管不同的公司对存储过程的态度不一，但是对于我们开发人员来说，不论怎样，掌握存储过程都是必备的技能之一。")]),s._v(" "),t("h1",{attrs:{id:"第3章-变量、流程控制与游标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第3章-变量、流程控制与游标"}},[s._v("#")]),s._v(" 第3章 变量、流程控制与游标")]),s._v(" "),t("h2",{attrs:{id:"_1-变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-变量"}},[s._v("#")]),s._v(" "),t("strong",[s._v("1.")]),s._v(" "),t("strong",[s._v("变量")])]),s._v(" "),t("h3",{attrs:{id:"_1-1-系统变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-系统变量"}},[s._v("#")]),s._v(" "),t("strong",[s._v("1.1")]),s._v(" "),t("strong",[s._v("系统变量")])]),s._v(" "),t("h4",{attrs:{id:"_1-1-1-系统变量分类"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-1-系统变量分类"}},[s._v("#")]),s._v(" "),t("strong",[s._v("1.1.1")]),s._v(" "),t("strong",[s._v("系统变量分类")])]),s._v(" "),t("p",[s._v("系统变量分为全局系统变量（需要添加"),t("code",[s._v("global")]),s._v("关键字）以及会话系统变量（需要添加"),t("code",[s._v("session")]),s._v("关键字），有时也把全局系统变量简称为全局变量，有时也把会话系统变量称为local变量。**如果不写，默认会话级别。**静态变量（在 MySQL 服务实例运行期间它们的值不能使用 set 动态修改）属于特殊的全局系统变量。")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("全局系统变量针对于所有会话（连接）有效，但"),t("code",[s._v("不能跨重启")])])]),s._v(" "),t("li",[t("p",[s._v("会话系统变量仅针对于当前会话（连接）有效。会话期间，当前会话对某个会话系统变量值的修改，不会影响其他会话同一个会话系统变量的值。")])]),s._v(" "),t("li",[t("p",[s._v("会话1对某个全局系统变量值的修改会导致会话2中同一个全局系统变量值的修改。")])])]),s._v(" "),t("h4",{attrs:{id:"_1-1-2-查看系统变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-2-查看系统变量"}},[s._v("#")]),s._v(" "),t("strong",[s._v("1.1.2")]),s._v(" "),t("strong",[s._v("查看系统变量")])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("查看所有或部分系统变量")])])]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#查看所有全局变量 \nSHOW GLOBAL VARIABLES; \n#查看所有会话变量 \nSHOW SESSION VARIABLES; \n#或\nSHOW VARIABLES;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#查看满足条件的部分系统变量。 \nSHOW GLOBAL VARIABLES LIKE '%标识符%';\n#查看满足条件的部分会话变量 \nSHOW SESSION VARIABLES LIKE '%标识符%';\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("ul",[t("li",[t("strong",[s._v("查看指定系统变量")])])]),s._v(" "),t("p",[s._v("作为 MySQL 编码规范，MySQL 中的系统变量以"),t("code",[s._v("两个“@”")]),s._v("开头，其中“@@global”仅用于标记全局系统变量，“@@session”仅用于标记会话系统变量。“@@”首先标记会话系统变量，如果会话系统变量不存在，则标记全局系统变量。")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#查看指定的系统变量的值 \nSELECT @@global.变量名; \n#查看指定的会话变量的值 \nSELECT @@session.变量名; \n#或者 \nSELECT @@变量名;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("ul",[t("li",[t("strong",[s._v("修改系统变量的值")])])]),s._v(" "),t("p",[s._v("方式1：修改MySQL 配置文件 ，继而修改MySQL系统变量的值（该方法需要重启MySQL服务）")]),s._v(" "),t("p",[s._v("方式2：在MySQL服务运行期间，使用“set”命令重新设置系统变量的值")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#为某个系统变量赋值 \n#方式1： \nSET @@global.变量名=变量值; \n#方式2： \nSET GLOBAL 变量名=变量值;\n#为某个会话变量赋值 \n#方式1： \nSET @@session.变量名=变量值; \n#方式2： \nSET SESSION 变量名=变量值;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h3",{attrs:{id:"_1-2-用户变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-用户变量"}},[s._v("#")]),s._v(" "),t("strong",[s._v("1.2")]),s._v(" "),t("strong",[s._v("用户变量")])]),s._v(" "),t("h4",{attrs:{id:"_1-2-1-用户变量分类"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-用户变量分类"}},[s._v("#")]),s._v(" "),t("strong",[s._v("1.2.1")]),s._v(" "),t("strong",[s._v("用户变量分类")])]),s._v(" "),t("p",[s._v("用户变量是用户自己定义的，作为 MySQL 编码规范，MySQL 中的用户变量以"),t("code",[s._v("一个“@”")]),s._v("开头。根据作用范围不同，又分为"),t("code",[s._v("会话用户变量")]),s._v("和"),t("code",[s._v("局部变量")]),s._v("。")]),s._v(" "),t("ul",[t("li",[s._v("会话用户变量：作用域和会话变量一样，只对"),t("code",[s._v("当前连接")]),s._v("会话有效。")]),s._v(" "),t("li",[s._v("局部变量：只在 BEGIN 和 END 语句块中有效。局部变量只能在"),t("code",[s._v("存储过程和函数")]),s._v("中使用。")])]),s._v(" "),t("h4",{attrs:{id:"_1-2-2-会话用户变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-2-会话用户变量"}},[s._v("#")]),s._v(" "),t("strong",[s._v("1.2.2")]),s._v(" "),t("strong",[s._v("会话用户变量")])]),s._v(" "),t("ul",[t("li",[s._v("变量的定义")])]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#方式1：“=”或“:=” \nSET @用户变量 = 值; \nSET @用户变量 := 值; \n#方式2：“:=” 或 INTO关键字 \nSELECT @用户变量 := 表达式 [FROM 等子句]; \nSELECT 表达式 INTO @用户变量 [FROM 等子句];\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("ul",[t("li",[s._v("查看用户变量的值 （查看、比较、运算等）")])]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("SELECT @用户变量\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"_1-2-3-局部变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-3-局部变量"}},[s._v("#")]),s._v(" "),t("strong",[s._v("1.2.3")]),s._v(" "),t("strong",[s._v("局部变量")])]),s._v(" "),t("p",[s._v("定义：可以使用"),t("code",[s._v("DECLARE")]),s._v("语句定义一个局部变量")]),s._v(" "),t("p",[s._v("作用域：仅仅在定义它的 BEGIN ... END 中有效")]),s._v(" "),t("p",[s._v("位置：只能放在 BEGIN ... END 中，而且只能放在第一句")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("BEGIN\n\t#声明局部变量 \n\tDECLARE 变量名1 变量数据类型 [DEFAULT 变量默认值]; \n\tDECLARE 变量名2,变量名3,... 变量数据类型 [DEFAULT 变量默认值];\n    #为局部变量赋值 \n    SET 变量名1 = 值; \n    SELECT 值 INTO 变量名2 [FROM 子句]; \n    #查看局部变量的值 \n    SELECT 变量1,变量2,变量3; \nEND\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[t("strong",[s._v("1.定义变量")])]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("DECLARE 变量名 类型 [default 值]; # 如果没有DEFAULT子句，初始值为NULL\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("2.变量赋值")])]),s._v(" "),t("p",[s._v("方式1：一般用于赋简单的值")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("SET 变量名=值; \nSET 变量名:=值;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("方式2：一般用于赋表中的字段值")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("SELECT 字段名或表达式 INTO 变量名 FROM 表;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("3.使用变量")]),s._v("（查看、比较、运算等）")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("SELECT 局部变量名;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"_1-2-4-对比会话用户变量与局部变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-4-对比会话用户变量与局部变量"}},[s._v("#")]),s._v(" "),t("strong",[s._v("1.2.4")]),s._v(" "),t("strong",[s._v("对比会话用户变量与局部变量")])]),s._v(" "),t("table",[t("thead",[t("tr",[t("th"),s._v(" "),t("th",[s._v("作用域")]),s._v(" "),t("th",[s._v("定义位置")]),s._v(" "),t("th",[s._v("语法")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("会话用户变量")]),s._v(" "),t("td",[s._v("当前会话")]),s._v(" "),t("td",[s._v("会话的任何地方")]),s._v(" "),t("td",[s._v("加@符号，不用指定类型")])]),s._v(" "),t("tr",[t("td",[s._v("局部变量")]),s._v(" "),t("td",[s._v("定义它的BEGIN END中")]),s._v(" "),t("td",[s._v("BEGIN END的第一句话")]),s._v(" "),t("td",[s._v("一般不用加@,需要指定类型")])])])]),s._v(" "),t("h2",{attrs:{id:"_2-定义条件与处理程序"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-定义条件与处理程序"}},[s._v("#")]),s._v(" "),t("strong",[s._v("2.")]),s._v(" "),t("strong",[s._v("定义条件与处理程序")])]),s._v(" "),t("p",[t("code",[s._v("定义条件")]),s._v("是事先定义程序执行过程中可能遇到的问题，"),t("code",[s._v("处理程序")]),s._v("定义了在遇到问题时应当采取的处理方式，并且保证存储过程或函数在遇到警告或错误时能继续执行。这样可以增强存储程序处理问题的能力，避免程序异常停止运行。")]),s._v(" "),t("p",[s._v("说明：定义条件和处理程序在存储过程、存储函数中都是支持的。")]),s._v(" "),t("p",[s._v("在存储过程中未定义条件和处理程序，且当存储过程中执行的SQL语句报错时，MySQL数据库会抛出错误，并退出当前SQL逻辑，不再向下继续执行。")]),s._v(" "),t("h3",{attrs:{id:"_2-1-定义条件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-定义条件"}},[s._v("#")]),s._v(" "),t("strong",[s._v("2.1")]),s._v(" "),t("strong",[s._v("定义条件")])]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("DECLARE 错误名称 CONDITION FOR 错误码（或错误条件）\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("错误码的说明：")]),s._v(" "),t("ul",[t("li",[t("p",[t("code",[s._v("MySQL_error_code")]),s._v("和"),t("code",[s._v("sqlstate_value")]),s._v("都可以表示MySQL的错误。")]),s._v(" "),t("ul",[t("li",[s._v("MySQL_error_code是数值类型错误代码。")]),s._v(" "),t("li",[s._v("sqlstate_value是长度为5的字符串类型错误代码。")])])]),s._v(" "),t("li",[t("p",[s._v("例如，在ERROR 1418 (HY000)中，1418是MySQL_error_code，'HY000'是sqlstate_value。")])])]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#使用MySQL_error_code \nDECLARE Field_Not_Be_NULL CONDITION FOR 1048; \n#使用sqlstate_value \nDECLARE Field_Not_Be_NULL CONDITION FOR SQLSTATE '23000';\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"_2-2-定义处理程序"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-定义处理程序"}},[s._v("#")]),s._v(" "),t("strong",[s._v("2.2")]),s._v(" "),t("strong",[s._v("定义处理程序")])]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("DECLARE 处理方式 HANDLER FOR 错误类型 处理语句\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[t("p",[t("strong",[s._v("处理方式")]),s._v("：处理方式有3个取值：CONTINUE、EXIT、UNDO。")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("CONTINUE")]),s._v("：表示遇到错误不处理，继续执行。")]),s._v(" "),t("li",[t("code",[s._v("EXIT")]),s._v("：表示遇到错误马上退出。")]),s._v(" "),t("li",[t("code",[s._v("UNDO")]),s._v("：表示遇到错误后撤回之前的操作。MySQL中暂时不支持这样的操作。")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("错误类型")]),s._v("（即条件）可以有如下取值：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("SQLSTATE '字符串错误码'")]),s._v("：表示长度为5的sqlstate_value类型的错误代码；")]),s._v(" "),t("li",[t("code",[s._v("MySQL_error_code")]),s._v("：匹配数值类型错误代码；")]),s._v(" "),t("li",[t("code",[s._v("错误名称")]),s._v("：表示DECLARE ... CONDITION定义的错误条件名称。")]),s._v(" "),t("li",[t("code",[s._v("SQLWARNING")]),s._v("：匹配所有以01开头的SQLSTATE错误代码；")]),s._v(" "),t("li",[t("code",[s._v("NOT FOUND")]),s._v("：匹配所有以02开头的SQLSTATE错误代码；")]),s._v(" "),t("li",[t("code",[s._v("SQLEXCEPTION")]),s._v("：匹配所有没有被SQLWARNING或NOT FOUND捕获的SQLSTATE错误代码；")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("处理语句")]),s._v("：如果出现上述条件之一，则采用对应的处理方式，并执行指定的处理语句。语句可以是像“"),t("code",[s._v("SET 变量 = 值")]),s._v("”这样的简单语句，也可以是使用"),t("code",[s._v("BEGIN ... END")]),s._v("编写的复合语句。")])])]),s._v(" "),t("p",[s._v("定义处理程序的几种方式，代码如下：")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#方法1：捕获sqlstate_value \nDECLARE CONTINUE HANDLER FOR SQLSTATE '42S02' SET @info = 'NO_SUCH_TABLE'; \n#方法2：捕获mysql_error_value \nDECLARE CONTINUE HANDLER FOR 1146 SET @info = 'NO_SUCH_TABLE'; \n#方法3：先定义条件，再调用 \nDECLARE no_such_table CONDITION FOR 1146;\nDECLARE CONTINUE HANDLER FOR NO_SUCH_TABLE SET @info = 'NO_SUCH_TABLE'; \n#方法4：使用SQLWARNING \nDECLARE EXIT HANDLER FOR SQLWARNING SET @info = 'ERROR'; \n#方法5：使用NOT FOUND \nDECLARE EXIT HANDLER FOR NOT FOUND SET @info = 'NO_SUCH_TABLE'; \n#方法6：使用SQLEXCEPTION \nDECLARE EXIT HANDLER FOR SQLEXCEPTION SET @info = 'ERROR';\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("h2",{attrs:{id:"_3-流程控制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-流程控制"}},[s._v("#")]),s._v(" "),t("strong",[s._v("3.")]),s._v(" "),t("strong",[s._v("流程控制")])]),s._v(" "),t("h3",{attrs:{id:"_3-1-分支结构之-if"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-分支结构之-if"}},[s._v("#")]),s._v(" "),t("strong",[s._v("3.1")]),s._v(" "),t("strong",[s._v("分支结构之")]),s._v(" "),t("strong",[s._v("IF")])]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("IF 表达式1 THEN 操作1 \n[ELSEIF 表达式2 THEN 操作2]…… \n[ELSE 操作N] \nEND IF\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"_3-2-分支结构之-case"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-分支结构之-case"}},[s._v("#")]),s._v(" "),t("strong",[s._v("3.2")]),s._v(" "),t("strong",[s._v("分支结构之")]),s._v(" "),t("strong",[s._v("CASE")])]),s._v(" "),t("p",[s._v("CASE 语句的语法结构1：")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#情况一：类似于switch \nCASE 表达式 \nWHEN 值1 THEN 结果1或语句1(如果是语句，需要加分号) \nWHEN 值2 THEN 结果2或语句2(如果是语句，需要加分号) \n... \nELSE 结果n或语句n(如果是语句，需要加分号) \nEND [case]（如果是放在begin end中需要加上case，如果放在select后面不需要）\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("CASE 语句的语法结构2：")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#情况二：类似于多重if \nCASE \nWHEN 条件1 THEN 结果1或语句1(如果是语句，需要加分号) \nWHEN 条件2 THEN 结果2或语句2(如果是语句，需要加分号) \n... \nELSE 结果n或语句n(如果是语句，需要加分号) \nEND [case]（如果是放在begin end中需要加上case，如果放在select后面不需要）\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h3",{attrs:{id:"_3-3-循环结构之loop"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-循环结构之loop"}},[s._v("#")]),s._v(" "),t("strong",[s._v("3.3")]),s._v(" "),t("strong",[s._v("循环结构之LOOP")])]),s._v(" "),t("p",[s._v("LOOP循环语句用来重复执行某些语句。LOOP内的语句一直重复执行直到循环被退出（使用LEAVE子句），跳出循环过程。")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[loop_label:] LOOP \n\t循环执行的语句 \nEND LOOP [loop_label]\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"_3-4-循环结构之while"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-循环结构之while"}},[s._v("#")]),s._v(" "),t("strong",[s._v("3.4")]),s._v(" "),t("strong",[s._v("循环结构之WHILE")])]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[while_label:] WHILE 循环条件 DO \n\t循环体 \nEND WHILE [while_label];\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"_3-5-循环结构之repeat"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-循环结构之repeat"}},[s._v("#")]),s._v(" "),t("strong",[s._v("3.5")]),s._v(" "),t("strong",[s._v("循环结构之REPEAT")])]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[repeat_label:] REPEAT \n\t循环体的语句 \n\tUNTIL 结束循环的条件表达式 \nEND REPEAT [repeat_label]\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("strong",[s._v("对比三种循环结构：")])]),s._v(" "),t("p",[s._v('1、这三种循环都可以省略名称，但如果循环中添加了循环控制语句（LEAVE或ITERATE）则必须添加名称。 2、 LOOP：一般用于实现简单的"死"循环；WHILE：先判断后执行；REPEAT：先执行后判断，无条件至少执行一次。')]),s._v(" "),t("h3",{attrs:{id:"_3-6-跳转语句之leave语句"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-跳转语句之leave语句"}},[s._v("#")]),s._v(" "),t("strong",[s._v("3.6")]),s._v(" "),t("strong",[s._v("跳转语句之LEAVE语句")])]),s._v(" "),t("p",[s._v("LEAVE语句：可以用在循环语句内，或者以 BEGIN 和 END 包裹起来的程序体内，表示跳出循环或者跳出程序体的操作。如果你有面向过程的编程语言的使用经验，你可以把 LEAVE 理解为 break。")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("LEAVE 标记名\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_3-7-跳转语句之iterate语句"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-7-跳转语句之iterate语句"}},[s._v("#")]),s._v(" "),t("strong",[s._v("3.7")]),s._v(" "),t("strong",[s._v("跳转语句之ITERATE语句")])]),s._v(" "),t("p",[s._v("ITERATE语句：只能用在循环语句（LOOP、REPEAT和WHILE语句）内，表示重新开始循环，将执行顺序转到语句段开头处。如果你有面向过程的编程语言的使用经验，你可以把 ITERATE 理解为 continue，意思为“再次循环”。")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("ITERATE label\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"_4-游标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-游标"}},[s._v("#")]),s._v(" "),t("strong",[s._v("4.")]),s._v(" "),t("strong",[s._v("游标")])]),s._v(" "),t("h3",{attrs:{id:"_4-1-什么是游标-或光标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-什么是游标-或光标"}},[s._v("#")]),s._v(" "),t("strong",[s._v("4.1")]),s._v(" "),t("strong",[s._v("什么是游标（或光标）")])]),s._v(" "),t("p",[s._v("游标，提供了一种灵活的操作方式，让我们能够对结果集中的每一条记录进行定位，并对指向的记录中的数据进行操作的数据结构。"),t("strong",[s._v("游标让")]),s._v(" "),t("strong",[s._v("SQL")]),s._v(" "),t("strong",[s._v("这种面向集合的语言有了面向过程开发的能力。")])]),s._v(" "),t("h3",{attrs:{id:"_4-2-使用游标步骤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-使用游标步骤"}},[s._v("#")]),s._v(" "),t("strong",[s._v("4.2")]),s._v(" "),t("strong",[s._v("使用游标步骤")])]),s._v(" "),t("p",[s._v("游标必须在声明处理程序之前被声明，并且变量和条件还必须在声明游标或处理程序之前被声明。")]),s._v(" "),t("p",[t("strong",[s._v("第一步，声明游标")])]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("DECLARE cursor_name CURSOR FOR select_statement;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("第二步，打开游标")])]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("OPEN cursor_name\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("第三步，使用游标（从游标中取得数据）")])]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("FETCH cursor_name INTO var_name [, var_name] ...\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("注意："),t("strong",[s._v("游标的查询结果集中的字段数，必须跟")]),s._v(" "),t("strong",[s._v("INTO")]),s._v(" "),t("strong",[s._v("后面的变量数一致")]),s._v("，否则，在存储过程执行的时候，MySQL 会提示错误。")]),s._v(" "),t("p",[t("strong",[s._v("第四步，关闭游标")])]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("CLOSE cursor_name\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("当我们使用完游标后需要关闭掉该游标。因为游标会占用系统资源 ，如果不及时关闭，"),t("strong",[s._v("游标会一直保持到存储过程结束")]),s._v("，影响系统运行的效率。")]),s._v(" "),t("h3",{attrs:{id:"_4-3-小结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-小结"}},[s._v("#")]),s._v(" "),t("strong",[s._v("4.3")]),s._v(" "),t("strong",[s._v("小结")])]),s._v(" "),t("p",[s._v("游标是 MySQL 的一个重要的功能，为"),t("code",[s._v("逐条读取")]),s._v("结果集中的数据，提供了完美的解决方案。跟在应用层面实现相同的功能相比，游标可以在存储程序中使用，效率高，程序也更加简洁。")]),s._v(" "),t("p",[s._v("但同时也会带来一些性能问题，比如在使用游标的过程中，会对数据行进行"),t("code",[s._v("加锁")]),s._v("，这样在业务并发量大的时候，不仅会影响业务之间的效率，还会"),t("code",[s._v("消耗系统资源")]),s._v("，造成内存不足，这是因为游标是在内存中进行的处理。")]),s._v(" "),t("p",[s._v("建议：养成用完之后就关闭的习惯，这样才能提高系统的整体效率。")]),s._v(" "),t("h2",{attrs:{id:"补充-mysql-8-0的新特性-全局变量的持久化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#补充-mysql-8-0的新特性-全局变量的持久化"}},[s._v("#")]),s._v(" "),t("strong",[s._v("补充：MySQL 8.0的新特性—全局变量的持久化")])]),s._v(" "),t("p",[s._v("使用SET GLOBAL语句设置的变量值只会"),t("code",[s._v("临时生效")]),s._v("。"),t("code",[s._v("数据库重启")]),s._v("后，服务器又会从MySQL配置文件中读取变量的默认值。 MySQL 8.0版本新增了"),t("code",[s._v("SET PERSIST")]),s._v("命令。")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("SET PERSIST global max_connections = 1000;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("MySQL会将该命令的配置保存到数据目录下的 mysqld-auto.cnf 文件中，下次启动时会读取该文件，用其中的配置来覆盖默认的配置文件。")]),s._v(" "),t("h1",{attrs:{id:"第4章-触发器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第4章-触发器"}},[s._v("#")]),s._v(" 第4章 触发器")]),s._v(" "),t("h2",{attrs:{id:"_1-触发器概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-触发器概述"}},[s._v("#")]),s._v(" "),t("strong",[s._v("1.")]),s._v(" "),t("strong",[s._v("触发器概述")])]),s._v(" "),t("p",[s._v("MySQL从"),t("code",[s._v("5.0.2")]),s._v("版本开始支持触发器。MySQL的触发器和存储过程一样，都是嵌入到MySQL服务器的一段程序。")]),s._v(" "),t("p",[s._v("触发器是由"),t("code",[s._v("事件来触发")]),s._v("某个操作，这些事件包括"),t("code",[s._v("INSERT")]),s._v("、"),t("code",[s._v("UPDATE")]),s._v("、"),t("code",[s._v("DELETE")]),s._v("事件。所谓事件就是指用户的动作或者触发某项行为。如果定义了触发程序，当数据库执行这些语句时候，就相当于事件发生了，就会"),t("code",[s._v("自动")]),s._v("激发触发器执行相应的操作。")]),s._v(" "),t("p",[s._v("当对数据表中的数据执行插入、更新和删除操作，需要自动执行一些数据库逻辑时，可以使用触发器来实现。")]),s._v(" "),t("h2",{attrs:{id:"_2-触发器的创建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-触发器的创建"}},[s._v("#")]),s._v(" "),t("strong",[s._v("2.")]),s._v(" "),t("strong",[s._v("触发器的创建")])]),s._v(" "),t("h3",{attrs:{id:"_2-1-创建触发器语法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-创建触发器语法"}},[s._v("#")]),s._v(" "),t("strong",[s._v("2.1")]),s._v(" "),t("strong",[s._v("创建触发器语法")])]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("CREATE TRIGGER 触发器名称 \n{BEFORE|AFTER} {INSERT|UPDATE|DELETE} ON 表名 \nFOR EACH ROW \n触发器执行的语句块;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("说明：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("表名")]),s._v("：表示触发器监控的对象。")]),s._v(" "),t("li",[t("code",[s._v("BEFORE|AFTER")]),s._v("：表示触发的时间。BEFORE 表示在事件之前触发；AFTER 表示在事件之后触发。")]),s._v(" "),t("li",[t("code",[s._v("INSERT|UPDATE|DELETE")]),s._v("：表示触发的事件。\n"),t("ul",[t("li",[s._v("INSERT 表示插入记录时触发；")]),s._v(" "),t("li",[s._v("UPDATE 表示更新记录时触发；")]),s._v(" "),t("li",[s._v("DELETE 表示删除记录时触发。")])])])]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("DELIMITER // \nCREATE TRIGGER before_insert \nBEFORE INSERT ON test_trigger \nFOR EACH ROW \nBEGIN\n\tINSERT INTO test_trigger_log (t_log) \n\tVALUES('before_insert'); \nEND // \nDELIMITER ;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h2",{attrs:{id:"_3-查看、删除触发器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-查看、删除触发器"}},[s._v("#")]),s._v(" "),t("strong",[s._v("3.")]),s._v(" "),t("strong",[s._v("查看、删除触发器")])]),s._v(" "),t("h3",{attrs:{id:"_3-1-查看触发器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-查看触发器"}},[s._v("#")]),s._v(" "),t("strong",[s._v("3.1")]),s._v(" "),t("strong",[s._v("查看触发器")])]),s._v(" "),t("p",[s._v("方式1：查看当前数据库的所有触发器的定义")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("SHOW TRIGGERS\\G\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("方式2：查看当前数据库中某个触发器的定义")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("SHOW CREATE TRIGGER 触发器名\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("方式3：从系统库information_schema的TRIGGERS表中查询“salary_check_trigger”触发器的信息。")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("SELECT * FROM information_schema.TRIGGERS;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_3-2-删除触发器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-删除触发器"}},[s._v("#")]),s._v(" "),t("strong",[s._v("3.2")]),s._v(" "),t("strong",[s._v("删除触发器")])]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("DROP TRIGGER IF EXISTS 触发器名称;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"_4-触发器的优缺点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-触发器的优缺点"}},[s._v("#")]),s._v(" "),t("strong",[s._v("4.")]),s._v(" "),t("strong",[s._v("触发器的优缺点")])]),s._v(" "),t("h3",{attrs:{id:"_4-1-优点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-优点"}},[s._v("#")]),s._v(" "),t("strong",[s._v("4.1")]),s._v(" "),t("strong",[s._v("优点")])]),s._v(" "),t("p",[t("strong",[s._v("1、触发器可以确保数据的完整性")]),s._v("。")]),s._v(" "),t("p",[t("strong",[s._v("2、触发器可以帮助我们记录操作日志。")])]),s._v(" "),t("p",[t("strong",[s._v("3、触发器还可以用在操作数据前，对数据进行合法性检查。")])]),s._v(" "),t("h3",{attrs:{id:"_4-2-缺点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-缺点"}},[s._v("#")]),s._v(" "),t("strong",[s._v("4.2")]),s._v(" "),t("strong",[s._v("缺点")])]),s._v(" "),t("p",[t("strong",[s._v("1、触发器最大的一个问题就是可读性差。")])]),s._v(" "),t("p",[s._v("比如触发器中的数据插入操作多了一个字段，系统提示错误。可是，如果你不了解这个触发器，很可能会认为是更新语句本身的问题，或者是表的结构出了问题。")]),s._v(" "),t("p",[t("strong",[s._v("2、相关数据的变更，可能会导致触发器出错。")])]),s._v(" "),t("p",[s._v("特别是数据表结构的变更，都可能会导致触发器出错，进而影响数据操作的正常运行。这些都会由于触发器本身的隐蔽性，影响到应用中错误原因排查的效率。")]),s._v(" "),t("h3",{attrs:{id:"_4-3-注意点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-注意点"}},[s._v("#")]),s._v(" "),t("strong",[s._v("4.3")]),s._v(" "),t("strong",[s._v("注意点")])]),s._v(" "),t("p",[s._v("注意，如果在子表中定义了外键约束，并且外键指定了ON UPDATE/DELETE CASCADE/SET NULL子句，此时修改父表被引用的键值或删除父表被引用的记录行时，也会引起子表的修改和删除操作，此时基于子表的UPDATE和DELETE语句定义的触发器并不会被激活。")])])}),[],!1,null,null,null);a.default=_.exports}}]);