<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>动态代理详解 | Coder&#39;Gm 博客</title>
    <meta name="generator" content="VuePress 1.9.2">
    <link rel="icon" href="/img/icon/note2.png">
    <meta name="description" content="当你的能力支撑不了你的野心的时候，该努力了！！">
    <meta name="keywords" content="Java 全栈知识体系, java体系, java知识体系, java框架,java详解,java学习路线,java spring, java面试, 知识体系, java技术体系, java编程, java编程指南,java开发体系, java开发,java教程,java,java数据结构, 算法, 开发基础">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.a214389c.css" as="style"><link rel="preload" href="/assets/js/app.44e0923e.js" as="script"><link rel="preload" href="/assets/js/2.4a42c91c.js" as="script"><link rel="preload" href="/assets/js/26.054194a4.js" as="script"><link rel="prefetch" href="/assets/js/10.6658714f.js"><link rel="prefetch" href="/assets/js/100.fe3f39f7.js"><link rel="prefetch" href="/assets/js/101.d5ed3265.js"><link rel="prefetch" href="/assets/js/102.e768d81f.js"><link rel="prefetch" href="/assets/js/103.5535decf.js"><link rel="prefetch" href="/assets/js/11.856f3e3b.js"><link rel="prefetch" href="/assets/js/12.113736c0.js"><link rel="prefetch" href="/assets/js/13.9c439c56.js"><link rel="prefetch" href="/assets/js/14.394ab678.js"><link rel="prefetch" href="/assets/js/15.42d5a0c1.js"><link rel="prefetch" href="/assets/js/16.70d9bc18.js"><link rel="prefetch" href="/assets/js/17.ee4dc88a.js"><link rel="prefetch" href="/assets/js/18.e895a1b3.js"><link rel="prefetch" href="/assets/js/19.bc852c28.js"><link rel="prefetch" href="/assets/js/20.ba3e82a7.js"><link rel="prefetch" href="/assets/js/21.62e9db3b.js"><link rel="prefetch" href="/assets/js/22.cf165019.js"><link rel="prefetch" href="/assets/js/23.1bb9d2ab.js"><link rel="prefetch" href="/assets/js/24.69003ae4.js"><link rel="prefetch" href="/assets/js/25.5ac5fe93.js"><link rel="prefetch" href="/assets/js/27.b411ecdb.js"><link rel="prefetch" href="/assets/js/28.147c4123.js"><link rel="prefetch" href="/assets/js/29.6104efa6.js"><link rel="prefetch" href="/assets/js/3.100b0cf3.js"><link rel="prefetch" href="/assets/js/30.197cf614.js"><link rel="prefetch" href="/assets/js/31.c11c4e4b.js"><link rel="prefetch" href="/assets/js/32.5a90f912.js"><link rel="prefetch" href="/assets/js/33.e3239d33.js"><link rel="prefetch" href="/assets/js/34.e5d60e2a.js"><link rel="prefetch" href="/assets/js/35.ac3a35fa.js"><link rel="prefetch" href="/assets/js/36.88afe5ff.js"><link rel="prefetch" href="/assets/js/37.e6d77bda.js"><link rel="prefetch" href="/assets/js/38.860aa95b.js"><link rel="prefetch" href="/assets/js/39.ff782303.js"><link rel="prefetch" href="/assets/js/4.76e5fb0d.js"><link rel="prefetch" href="/assets/js/40.b0965bf4.js"><link rel="prefetch" href="/assets/js/41.f3fc54f3.js"><link rel="prefetch" href="/assets/js/42.c0751c0f.js"><link rel="prefetch" href="/assets/js/43.8bf64311.js"><link rel="prefetch" href="/assets/js/44.6754651c.js"><link rel="prefetch" href="/assets/js/45.b16895ec.js"><link rel="prefetch" href="/assets/js/46.7226b679.js"><link rel="prefetch" href="/assets/js/47.bc142da5.js"><link rel="prefetch" href="/assets/js/48.32b41242.js"><link rel="prefetch" href="/assets/js/49.292eb956.js"><link rel="prefetch" href="/assets/js/5.51cab261.js"><link rel="prefetch" href="/assets/js/50.079daeec.js"><link rel="prefetch" href="/assets/js/51.d8fb6190.js"><link rel="prefetch" href="/assets/js/52.f1a80eb0.js"><link rel="prefetch" href="/assets/js/53.bfc87ec7.js"><link rel="prefetch" href="/assets/js/54.0d5b8f7b.js"><link rel="prefetch" href="/assets/js/55.031bdd5c.js"><link rel="prefetch" href="/assets/js/56.51a9f261.js"><link rel="prefetch" href="/assets/js/57.7badb0db.js"><link rel="prefetch" href="/assets/js/58.11e7c84b.js"><link rel="prefetch" href="/assets/js/59.09ea85f8.js"><link rel="prefetch" href="/assets/js/6.1217ecf0.js"><link rel="prefetch" href="/assets/js/60.f49dff36.js"><link rel="prefetch" href="/assets/js/61.fc20fc9d.js"><link rel="prefetch" href="/assets/js/62.733e3477.js"><link rel="prefetch" href="/assets/js/63.4bfe99a2.js"><link rel="prefetch" href="/assets/js/64.8227fa59.js"><link rel="prefetch" href="/assets/js/65.9338d8cf.js"><link rel="prefetch" href="/assets/js/66.35d63c81.js"><link rel="prefetch" href="/assets/js/67.0224d223.js"><link rel="prefetch" href="/assets/js/68.bee1f22f.js"><link rel="prefetch" href="/assets/js/69.08704d94.js"><link rel="prefetch" href="/assets/js/7.dc50503c.js"><link rel="prefetch" href="/assets/js/70.3b5276a1.js"><link rel="prefetch" href="/assets/js/71.7d766a0b.js"><link rel="prefetch" href="/assets/js/72.f66ed860.js"><link rel="prefetch" href="/assets/js/73.a0002ad9.js"><link rel="prefetch" href="/assets/js/74.c0599b56.js"><link rel="prefetch" href="/assets/js/75.1ca91be9.js"><link rel="prefetch" href="/assets/js/76.17f9d853.js"><link rel="prefetch" href="/assets/js/77.e563741a.js"><link rel="prefetch" href="/assets/js/78.5cb837e1.js"><link rel="prefetch" href="/assets/js/79.599ee9fe.js"><link rel="prefetch" href="/assets/js/8.7e968594.js"><link rel="prefetch" href="/assets/js/80.614e5db3.js"><link rel="prefetch" href="/assets/js/81.256c8bba.js"><link rel="prefetch" href="/assets/js/82.bc28a824.js"><link rel="prefetch" href="/assets/js/83.31f9acee.js"><link rel="prefetch" href="/assets/js/84.65af7ccd.js"><link rel="prefetch" href="/assets/js/85.5f8c614f.js"><link rel="prefetch" href="/assets/js/86.02957e14.js"><link rel="prefetch" href="/assets/js/87.69e40dad.js"><link rel="prefetch" href="/assets/js/88.6b53f094.js"><link rel="prefetch" href="/assets/js/89.d79d52f3.js"><link rel="prefetch" href="/assets/js/9.67eaa601.js"><link rel="prefetch" href="/assets/js/90.ec563f30.js"><link rel="prefetch" href="/assets/js/91.af3f3b1c.js"><link rel="prefetch" href="/assets/js/92.a38cb0ed.js"><link rel="prefetch" href="/assets/js/93.b5aecfec.js"><link rel="prefetch" href="/assets/js/94.ef55686b.js"><link rel="prefetch" href="/assets/js/95.e294b0e5.js"><link rel="prefetch" href="/assets/js/96.6cc86402.js"><link rel="prefetch" href="/assets/js/97.2ddc667e.js"><link rel="prefetch" href="/assets/js/98.b8cf46f9.js"><link rel="prefetch" href="/assets/js/99.aab7dc10.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a214389c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/icon/note2.png" alt="Coder'Gm 博客" class="logo"> <span class="site-name can-hide">Coder'Gm 博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/9931eb/" class="nav-link">面向对象</a></li><li class="dropdown-subitem"><a href="/pages/74fec2/" class="nav-link">数据类型</a></li><li class="dropdown-subitem"><a href="/pages/5bde1a/" class="nav-link">变量类型</a></li><li class="dropdown-subitem"><a href="/pages/28535a/" class="nav-link">控制结构</a></li><li class="dropdown-subitem"><a href="/pages/4074f5/" class="nav-link">超类</a></li><li class="dropdown-subitem"><a href="/pages/db85a8/" class="nav-link">Scanner</a></li><li class="dropdown-subitem"><a href="/pages/341e84/" class="nav-link">反射</a></li><li class="dropdown-subitem"><a href="/pages/7ec08c/" class="nav-link">Serializable(序列化)</a></li><li class="dropdown-subitem"><a href="/pages/fbe16d/" aria-current="page" class="nav-link router-link-exact-active router-link-active">动态代理</a></li><li class="dropdown-subitem"><a href="/pages/78e39b/" class="nav-link">Enum</a></li><li class="dropdown-subitem"><a href="/pages/0d7979/" class="nav-link">IO流</a></li><li class="dropdown-subitem"><a href="/pages/192add/" class="nav-link">Lambda</a></li><li class="dropdown-subitem"><a href="/pages/d2addf/" class="nav-link">Math</a></li><li class="dropdown-subitem"><a href="/pages/0cdbed/" class="nav-link">Random</a></li><li class="dropdown-subitem"><a href="/pages/b722b1/" class="nav-link">UUID</a></li><li class="dropdown-subitem"><a href="/pages/0f7ad8/" class="nav-link">泛型</a></li><li class="dropdown-subitem"><a href="/pages/148cd7/" class="nav-link">网络通信</a></li><li class="dropdown-subitem"><a href="/pages/f46dcf/" class="nav-link">异常和处理</a></li><li class="dropdown-subitem"><a href="/pages/0e008e/" class="nav-link">正则表达式</a></li><li class="dropdown-subitem"><a href="/pages/f42b16/" class="nav-link">Java注解</a></li><li class="dropdown-subitem"><a href="/pages/dac65d/" class="nav-link">JDBC</a></li></ul></li><li class="dropdown-item"><h4>并发与线程</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/394d30/" class="nav-link">并发编程核心概念</a></li><li class="dropdown-subitem"><a href="/pages/61ba09/" class="nav-link">JUC-2</a></li></ul></li><li class="dropdown-item"><h4>JVM相关</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">JUC-1</a></li><li class="dropdown-subitem"><a href="/pages/61ba09/" class="nav-link">JUC-2</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring" class="dropdown-title"><!----> <span class="title" style="display:;">Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Framework</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/28e3d0/" class="nav-link">基础1</a></li></ul></li><li class="dropdown-item"><h4>Spring Boot</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">JUC-1</a></li><li class="dropdown-subitem"><a href="/pages/61ba09/" class="nav-link">JUC-2</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="SpringCloud" class="dropdown-title"><!----> <span class="title" style="display:;">SpringCloud</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Nacos 注册中心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/9f8459/" class="nav-link">Nacos基本架构和概念</a></li><li class="dropdown-subitem"><a href="/pages/5a44e3/" class="nav-link">Nacos服务注册与发现</a></li><li class="dropdown-subitem"><a href="/pages/20ff14/" class="nav-link">Config服务配置中心</a></li><li class="dropdown-subitem"><a href="/pages/f84a0c/" class="nav-link">Nacos安装部署 </a></li></ul></li><li class="dropdown-item"><h4>Gateway 微服务网关</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/e87c7c/" class="nav-link">Gateway核心概念</a></li><li class="dropdown-subitem"><a href="/pages/6b0fb9/" class="nav-link">Gateway路由</a></li><li class="dropdown-subitem"><a href="/pages/1a393f/" class="nav-link">Gateway断言</a></li><li class="dropdown-subitem"><a href="/pages/60ff28/" class="nav-link">Gateway过滤器</a></li><li class="dropdown-subitem"><a href="/pages/8fc690/" class="nav-link">Alibaba问题汇总</a></li><li class="dropdown-subitem"><a href="/pages/39605b/" class="nav-link">创建Gateway模块</a></li></ul></li><li class="dropdown-item"><h4>微服务通信</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c6a1f4/" class="nav-link">微服务间通信</a></li></ul></li><li class="dropdown-item"><h4>Seata 分布式事务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/d37c45/" class="nav-link">Seata分布式事务解决方案</a></li></ul></li><li class="dropdown-item"><h4>微服务容错</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/470cd5/" class="nav-link">Netflix Hystrix实现微服务容错</a></li><li class="dropdown-subitem"><a href="/pages/fbe16d/404" class="nav-link">Sentinel微服务容错</a></li></ul></li><li class="dropdown-item"><h4>Sleuth + Zipkin 日志追踪</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/f082ce/" class="nav-link">Sleuth + Zipkin分布式日志追踪</a></li></ul></li><li class="dropdown-item"><h4>授权、鉴权中心微服务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/5c5a46/" class="nav-link">构建授权、鉴权中心微服务</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><!----> <span class="title" style="display:;">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Cloud Alibaba</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/3b393a/" class="nav-link">JVM-1</a></li><li class="dropdown-subitem"><a href="/pages/f50dfc/" class="nav-link">JVM-3</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title" style="display:;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>MySQL</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/cded12/" class="nav-link">基础篇</a></li><li class="dropdown-subitem"><a href="/pages/49bb95/" class="nav-link">高级篇</a></li><li class="dropdown-subitem"><a href="/pages/59225b/" class="nav-link">工具</a></li></ul></li><li class="dropdown-item"><h4>Oracle</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">Oracle知识点</a></li></ul></li><li class="dropdown-item"><h4>Redis</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">Redis知识点</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架|中间件" class="dropdown-title"><!----> <span class="title" style="display:;">框架|中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Framework</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/28e3d0/" class="nav-link">基础1</a></li></ul></li><li class="dropdown-item"><h4>Spring Boot</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">JUC-1</a></li><li class="dropdown-subitem"><a href="/pages/61ba09/" class="nav-link">JUC-2</a></li></ul></li><li class="dropdown-item"><h4>Spring Cloud Alibaba</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/3b393a/" class="nav-link">JVM-1</a></li><li class="dropdown-subitem"><a href="/pages/f50dfc/" class="nav-link">JVM-3</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具|部署" class="dropdown-title"><!----> <span class="title" style="display:;">工具|部署</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Docker</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a793d4/" class="nav-link">软件安装篇</a></li><li class="dropdown-subitem"><a href="/pages/f3f84f/" class="nav-link">服务部署篇</a></li></ul></li><li class="dropdown-item"><h4>Git</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">Git知识点</a></li></ul></li><li class="dropdown-item"><h4>Linux</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/bb176d/" class="nav-link">阿里云</a></li></ul></li><li class="dropdown-item"><h4>Idea</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/7eb19a/" class="nav-link">Idea常用插件Top16</a></li><li class="dropdown-subitem"><a href="/pages/55726e/" class="nav-link">Idea设置软换行</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/pages/891539/" class="nav-link">关于我</a></div> <a href="https://github.com/coder-gm" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/9931eb/" class="nav-link">面向对象</a></li><li class="dropdown-subitem"><a href="/pages/74fec2/" class="nav-link">数据类型</a></li><li class="dropdown-subitem"><a href="/pages/5bde1a/" class="nav-link">变量类型</a></li><li class="dropdown-subitem"><a href="/pages/28535a/" class="nav-link">控制结构</a></li><li class="dropdown-subitem"><a href="/pages/4074f5/" class="nav-link">超类</a></li><li class="dropdown-subitem"><a href="/pages/db85a8/" class="nav-link">Scanner</a></li><li class="dropdown-subitem"><a href="/pages/341e84/" class="nav-link">反射</a></li><li class="dropdown-subitem"><a href="/pages/7ec08c/" class="nav-link">Serializable(序列化)</a></li><li class="dropdown-subitem"><a href="/pages/fbe16d/" aria-current="page" class="nav-link router-link-exact-active router-link-active">动态代理</a></li><li class="dropdown-subitem"><a href="/pages/78e39b/" class="nav-link">Enum</a></li><li class="dropdown-subitem"><a href="/pages/0d7979/" class="nav-link">IO流</a></li><li class="dropdown-subitem"><a href="/pages/192add/" class="nav-link">Lambda</a></li><li class="dropdown-subitem"><a href="/pages/d2addf/" class="nav-link">Math</a></li><li class="dropdown-subitem"><a href="/pages/0cdbed/" class="nav-link">Random</a></li><li class="dropdown-subitem"><a href="/pages/b722b1/" class="nav-link">UUID</a></li><li class="dropdown-subitem"><a href="/pages/0f7ad8/" class="nav-link">泛型</a></li><li class="dropdown-subitem"><a href="/pages/148cd7/" class="nav-link">网络通信</a></li><li class="dropdown-subitem"><a href="/pages/f46dcf/" class="nav-link">异常和处理</a></li><li class="dropdown-subitem"><a href="/pages/0e008e/" class="nav-link">正则表达式</a></li><li class="dropdown-subitem"><a href="/pages/f42b16/" class="nav-link">Java注解</a></li><li class="dropdown-subitem"><a href="/pages/dac65d/" class="nav-link">JDBC</a></li></ul></li><li class="dropdown-item"><h4>并发与线程</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/394d30/" class="nav-link">并发编程核心概念</a></li><li class="dropdown-subitem"><a href="/pages/61ba09/" class="nav-link">JUC-2</a></li></ul></li><li class="dropdown-item"><h4>JVM相关</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">JUC-1</a></li><li class="dropdown-subitem"><a href="/pages/61ba09/" class="nav-link">JUC-2</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring" class="dropdown-title"><!----> <span class="title" style="display:;">Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Framework</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/28e3d0/" class="nav-link">基础1</a></li></ul></li><li class="dropdown-item"><h4>Spring Boot</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">JUC-1</a></li><li class="dropdown-subitem"><a href="/pages/61ba09/" class="nav-link">JUC-2</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="SpringCloud" class="dropdown-title"><!----> <span class="title" style="display:;">SpringCloud</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Nacos 注册中心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/9f8459/" class="nav-link">Nacos基本架构和概念</a></li><li class="dropdown-subitem"><a href="/pages/5a44e3/" class="nav-link">Nacos服务注册与发现</a></li><li class="dropdown-subitem"><a href="/pages/20ff14/" class="nav-link">Config服务配置中心</a></li><li class="dropdown-subitem"><a href="/pages/f84a0c/" class="nav-link">Nacos安装部署 </a></li></ul></li><li class="dropdown-item"><h4>Gateway 微服务网关</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/e87c7c/" class="nav-link">Gateway核心概念</a></li><li class="dropdown-subitem"><a href="/pages/6b0fb9/" class="nav-link">Gateway路由</a></li><li class="dropdown-subitem"><a href="/pages/1a393f/" class="nav-link">Gateway断言</a></li><li class="dropdown-subitem"><a href="/pages/60ff28/" class="nav-link">Gateway过滤器</a></li><li class="dropdown-subitem"><a href="/pages/8fc690/" class="nav-link">Alibaba问题汇总</a></li><li class="dropdown-subitem"><a href="/pages/39605b/" class="nav-link">创建Gateway模块</a></li></ul></li><li class="dropdown-item"><h4>微服务通信</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c6a1f4/" class="nav-link">微服务间通信</a></li></ul></li><li class="dropdown-item"><h4>Seata 分布式事务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/d37c45/" class="nav-link">Seata分布式事务解决方案</a></li></ul></li><li class="dropdown-item"><h4>微服务容错</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/470cd5/" class="nav-link">Netflix Hystrix实现微服务容错</a></li><li class="dropdown-subitem"><a href="/pages/fbe16d/404" class="nav-link">Sentinel微服务容错</a></li></ul></li><li class="dropdown-item"><h4>Sleuth + Zipkin 日志追踪</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/f082ce/" class="nav-link">Sleuth + Zipkin分布式日志追踪</a></li></ul></li><li class="dropdown-item"><h4>授权、鉴权中心微服务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/5c5a46/" class="nav-link">构建授权、鉴权中心微服务</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><!----> <span class="title" style="display:;">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Cloud Alibaba</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/3b393a/" class="nav-link">JVM-1</a></li><li class="dropdown-subitem"><a href="/pages/f50dfc/" class="nav-link">JVM-3</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title" style="display:;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>MySQL</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/cded12/" class="nav-link">基础篇</a></li><li class="dropdown-subitem"><a href="/pages/49bb95/" class="nav-link">高级篇</a></li><li class="dropdown-subitem"><a href="/pages/59225b/" class="nav-link">工具</a></li></ul></li><li class="dropdown-item"><h4>Oracle</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">Oracle知识点</a></li></ul></li><li class="dropdown-item"><h4>Redis</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">Redis知识点</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架|中间件" class="dropdown-title"><!----> <span class="title" style="display:;">框架|中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Framework</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/28e3d0/" class="nav-link">基础1</a></li></ul></li><li class="dropdown-item"><h4>Spring Boot</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">JUC-1</a></li><li class="dropdown-subitem"><a href="/pages/61ba09/" class="nav-link">JUC-2</a></li></ul></li><li class="dropdown-item"><h4>Spring Cloud Alibaba</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/3b393a/" class="nav-link">JVM-1</a></li><li class="dropdown-subitem"><a href="/pages/f50dfc/" class="nav-link">JVM-3</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具|部署" class="dropdown-title"><!----> <span class="title" style="display:;">工具|部署</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Docker</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a793d4/" class="nav-link">软件安装篇</a></li><li class="dropdown-subitem"><a href="/pages/f3f84f/" class="nav-link">服务部署篇</a></li></ul></li><li class="dropdown-item"><h4>Git</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">Git知识点</a></li></ul></li><li class="dropdown-item"><h4>Linux</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/bb176d/" class="nav-link">阿里云</a></li></ul></li><li class="dropdown-item"><h4>Idea</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/7eb19a/" class="nav-link">Idea常用插件Top16</a></li><li class="dropdown-subitem"><a href="/pages/55726e/" class="nav-link">Idea设置软换行</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/pages/891539/" class="nav-link">关于我</a></div> <a href="https://github.com/coder-gm" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Java基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>OOP (面向对象)</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>数据类型</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>变量类型</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>控制结构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>超类</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Scanner (获取用户输入)</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>反射</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Serializable (序列化)</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>动态代理</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/fbe16d/" aria-current="page" class="active sidebar-link">动态代理详解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/fbe16d/#方法详细信息" class="sidebar-link">方法详细信息</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/fbe16d/#获取代理类class对象" class="sidebar-link">获取代理类Class对象</a></li><li class="sidebar-sub-header level4"><a href="/pages/fbe16d/#getproxyclass" class="sidebar-link">getProxyClass</a></li><li class="sidebar-sub-header level3"><a href="/pages/fbe16d/#创建接口实现类的代理对象" class="sidebar-link">创建接口实现类的代理对象</a></li><li class="sidebar-sub-header level4"><a href="/pages/fbe16d/#newproxyinstance" class="sidebar-link">newProxyInstance</a></li><li class="sidebar-sub-header level3"><a href="/pages/fbe16d/#isproxyclass" class="sidebar-link">isProxyClass</a></li><li class="sidebar-sub-header level3"><a href="/pages/fbe16d/#getinvocationhandler" class="sidebar-link">getInvocationHandler</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/fbe16d/#代码综合示例" class="sidebar-link">代码综合示例</a></li><li class="sidebar-sub-header level2"><a href="/pages/fbe16d/#什么是cglib" class="sidebar-link">什么是CGLIB</a></li><li class="sidebar-sub-header level2"><a href="/pages/fbe16d/#为什么使用cglib" class="sidebar-link">为什么使用CGLIB</a></li><li class="sidebar-sub-header level2"><a href="/pages/fbe16d/#cglib组成结构" class="sidebar-link">CGLIB组成结构</a></li><li class="sidebar-sub-header level2"><a href="/pages/fbe16d/#cglib-maven引用" class="sidebar-link">CGLIB Maven引用</a></li><li class="sidebar-sub-header level2"><a href="/pages/fbe16d/#代码示例" class="sidebar-link">代码示例</a></li><li class="sidebar-sub-header level2"><a href="/pages/fbe16d/#api" class="sidebar-link">API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/fbe16d/#enhancer" class="sidebar-link">Enhancer</a></li><li class="sidebar-sub-header level3"><a href="/pages/fbe16d/#immutablebean" class="sidebar-link">ImmutableBean</a></li><li class="sidebar-sub-header level3"><a href="/pages/fbe16d/#beangenerator" class="sidebar-link">BeanGenerator</a></li><li class="sidebar-sub-header level3"><a href="/pages/fbe16d/#beancopier" class="sidebar-link">BeanCopier</a></li><li class="sidebar-sub-header level3"><a href="/pages/fbe16d/#bulkbean" class="sidebar-link">BulkBean</a></li><li class="sidebar-sub-header level3"><a href="/pages/fbe16d/#beanmap" class="sidebar-link">BeanMap</a></li><li class="sidebar-sub-header level3"><a href="/pages/fbe16d/#keyfactory" class="sidebar-link">keyFactory</a></li><li class="sidebar-sub-header level3"><a href="/pages/fbe16d/#mixin-混合" class="sidebar-link">Mixin(混合)</a></li><li class="sidebar-sub-header level3"><a href="/pages/fbe16d/#stringswitcher" class="sidebar-link">StringSwitcher</a></li><li class="sidebar-sub-header level3"><a href="/pages/fbe16d/#interfacemaker" class="sidebar-link">InterfaceMaker</a></li><li class="sidebar-sub-header level3"><a href="/pages/fbe16d/#methoddelegate" class="sidebar-link">MethodDelegate</a></li><li class="sidebar-sub-header level3"><a href="/pages/fbe16d/#multicastdelegate" class="sidebar-link">MulticastDelegate</a></li><li class="sidebar-sub-header level3"><a href="/pages/fbe16d/#constructordelegate" class="sidebar-link">ConstructorDelegate</a></li><li class="sidebar-sub-header level3"><a href="/pages/fbe16d/#parallelsorter-并行排序器" class="sidebar-link">ParallelSorter(并行排序器)</a></li><li class="sidebar-sub-header level3"><a href="/pages/fbe16d/#fastclass" class="sidebar-link">FastClass</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/fbe16d/#注意" class="sidebar-link">注意</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Enum (枚举类)</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>IO流</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Lambda表达式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Math (数字运算)</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Random (随机数)</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>UUID</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>泛型</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>网络通信</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>异常和处理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>正则表达式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>注解</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>JDBC</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>并发与线程(JUC)</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JVM相关</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>Java</span></li><li data-v-06225672><span data-v-06225672>Java基础</span></li><li data-v-06225672><span data-v-06225672>动态代理</span></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="http://coder-note.cn" target="_blank" title="作者" class="beLink" data-v-06225672>Coder'Gm</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-01-08</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">动态代理详解<!----></h1> <div class="page-slot page-slot-top">
  <div class="wwads-cn wwads-horizontal page-ad" data-id="136" style="width:100%;max-height:80px;min-height:auto;"></div>
  <style>
    .page-ad img{
      width:80px!important;
    }
    .wwads-horizontal .wwads-content{
      display: flex;
      align-items: center;
    }
    .wwads-horizontal .wwads-text, .wwads-content .wwads-text{
      line-height:1;
      flex: 1;
      height: 100%;
      display: flex;
      align-items: center;
    }
    .wwads-horizontal .wwads-poweredby, .wwads-vertical .wwads-poweredby{display: none;!important;}
  </style>
  </div> <div class="theme-vdoing-content content__default"><h1 id="解释"><a href="#解释" class="header-anchor">#</a> 解释</h1> <p>**代理的目的:**为其他对象提供一种代理以控制对这个对象的访问，也可以在代理方法前后加入一些其他逻辑。
JDK提供了实现动态代理接口的类Proxy，目前仅支持interface代理。</p> <p>动态代理可以理解为，本来应该自己做的事情，却交给别人代为处理，这个过程就叫做动态代理。</p> <h1 id="使用场景"><a href="#使用场景" class="header-anchor">#</a> 使用场景</h1> <p>动态代理被广为人知的使用场景是 Spring 中的面向切面编程（AOP）。例如，依赖注入 @Autowired 和事务注解 @Transactional 等，都是利用动态代理实现的。动态代理还可以封装一些 RPC 调用，也可以通过代理实现一个全局拦截器等。</p> <p><strong>动态代理和反射的关系</strong></p> <p>JDK 原生提供的动态代理就是通过反射实现的，但动态代理的实现方式还可以是 ASM（一个短小精悍的字节码操作框架）、cglib（基于 ASM）等，并不局限于反射。</p> <h1 id="proxy-jdk-原生动态代理"><a href="#proxy-jdk-原生动态代理" class="header-anchor">#</a> Proxy (JDK 原生动态代理)</h1> <ul><li><code>Proxy</code>提供了创建动态代理类和实例的静态方法，它也是由这些方法创建的所有动态代理类的超类。</li></ul> <h2 id="方法详细信息"><a href="#方法详细信息" class="header-anchor">#</a> 方法详细信息</h2> <h3 id="获取代理类class对象"><a href="#获取代理类class对象" class="header-anchor">#</a> 获取代理类Class对象</h3> <h4 id="getproxyclass"><a href="#getproxyclass" class="header-anchor">#</a> getProxyClass</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>public static Class&lt;?&gt; getProxyClass(ClassLoader loader,Class&lt;?&gt;... interfaces)
                              throws IllegalArgumentException
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>给定类加载器和接口数组的代理类的<code>java.lang.Class</code>对象。代理类将由指定的类加载器定义，并将实现所有提供的接口。如果任何给定的接口是非公开的，则代理类将是非公开的。如果类加载器已经定义了接口相同置换的代理类，那么将返回现有的代理类;否则，这些接口的代理类将被动态生成并由类加载器定义。</p> <p>对可能传递给<code>Proxy.getProxyClass</code>的参数有几个<code>Proxy.getProxyClass</code>  ：</p> <ul><li><p><code>interfaces</code>数组中的所有<code>类</code>对象都必须表示接口，而不是类或原始类型。</p></li> <li><p><code>interfaces</code>数组中没有两个元素可能是指相同的<code>类</code>对象。</p></li> <li><p>所有的接口类型必须通过指定的类加载器的名称可见。</p> <p>换句话说，对于类加载器<code>cl</code>和每个接口<code>i</code> ，以下表达式必须为真：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  Class.forName(i.getName(), false, cl) == i 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>所有非公共接口必须在同一个包中; 否则代理类将不可能实现所有接口，而不管其中定义了什么包。</p></li> <li><p>对于具有相同签名的指定接口的任何成员方法集合：</p> <ul><li>如果任何方法的返回类型是原始类型或void，则所有方法必须具有相同的返回类型。</li> <li>否则，其中一个方法必须具有一个返回类型，该类型可以分配给其余方法的所有返回类型。</li></ul></li> <li><p>生成的代理类不能超过虚拟机对类施加的任何限制。  例如，VM可以将类可以实现的接口数量限制为65535; 在这种情况下，  <code>interfaces</code>阵列的大小不得超过65535。</p></li></ul> <p>如果任何这些限制被违反，  <code>Proxy.getProxyClass</code>将抛出一个<code>IllegalArgumentException</code>  。 如果<code>interfaces</code>数组参数或其任何元素为<code>null</code>  ，则将抛出一个<code>NullPointerException</code> 。</p> <p>请注意，指定的代理接口的顺序是重要的：具有相同组合的接口但不同顺序的代理类的两个请求将导致两个不同的代理类。</p> <ul><li><p>参数</p> <p><code>loader</code> - 类加载器来定义代理类</p> <p><code>interfaces</code> - 要实现的代理类的接口列表</p></li> <li><p>结果</p> <p>在指定的类加载器中定义并实现指定接口的代理类</p></li> <li><p>异常</p> <p><code>IllegalArgumentException</code>  - 如果对可能传递给 <code>getProxyClass</code>的参数的任何 <code>getProxyClass</code>被违反</p> <p><code>SecurityException</code> -  如果存在安全管理员<em>s</em> ，并且满足以下任何条件：  给定的<code>loader</code>是<code>null</code>  ，并且调用者的类加载器不是<code>null</code> ，并且调用<a href="/java/lang/SecurityManager.html#checkPermission-java.security.Permission-"><code>s.checkPermission</code></a>与<code>RuntimePermission(&quot;getClassLoader&quot;)</code>权限被拒绝访问。  对于每个代理接口， <code>intf</code>  ，呼叫者的类加载器是不一样的或类加载器的一个祖先<code>intf</code>和调用<a href="/java/lang/SecurityManager.html#checkPackageAccess-java.lang.String-"><code>s.checkPackageAccess()</code></a>拒绝访问<code>intf</code>  。</p> <p><code>NullPointerException</code>  - 如果 <code>interfaces</code>数组参数或其任何元素是 <code>null</code></p></li></ul> <p><strong>代码示例:</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>com<span class="token punctuation">.</span>test<span class="token punctuation">.</span>java<span class="token punctuation">.</span>base<span class="token punctuation">.</span>dynamicproxy</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 代理接口
 *
 * @Description
 * @Author Guang Ming Zhang
 * @Date 2021/5/13 15:14
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Subject</span> <span class="token punctuation">{</span>

    <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token class-name">String</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>com<span class="token punctuation">.</span>test<span class="token punctuation">.</span>java<span class="token punctuation">.</span>base<span class="token punctuation">.</span>dynamicproxy</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 接口实现类
 *
 * @Description
 * @Author Guang Ming Zhang
 * @Date 2021/5/13 15:15
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RealSubject</span> <span class="token keyword">implements</span> <span class="token class-name">Subject</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token class-name">String</span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我是动态代理传过来的参数:&quot;</span> <span class="token operator">+</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>com<span class="token punctuation">.</span>test<span class="token punctuation">.</span>java<span class="token punctuation">.</span>base<span class="token punctuation">.</span>dynamicproxy</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Constructor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationHandler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Proxy</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Description
 * @Author Guang Ming Zhang
 * @Date 2021/5/13 15:10
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProxyInvocationHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{</span>

    <span class="token comment">// 代理目标对象</span>
    <span class="token keyword">private</span> <span class="token class-name">T</span> realSubject<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ProxyInvocationHandler</span><span class="token punctuation">(</span><span class="token class-name">T</span> realSubject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>realSubject <span class="token operator">=</span> realSubject<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token comment">//在转调具体目标对象之前，可以执行一些功能处理</span>

        <span class="token comment">//转调具体目标对象的方法</span>
        <span class="token class-name">Object</span> result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>realSubject<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//在转调具体目标对象之后，可以执行一些功能处理</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建目标对象</span>
        <span class="token keyword">final</span> <span class="token class-name">RealSubject</span> realSubject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RealSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//获取Class对象的类装载器</span>
        <span class="token class-name">ClassLoader</span> classLoader <span class="token operator">=</span> realSubject<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//获得类实现的所有接口信息</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> interfaces <span class="token operator">=</span> realSubject<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token class-name">Subject</span> proxySubject <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">/*
         * 方式1：先创建ProxyClass，然后得到Constructor创建代理实例
         */</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> proxyClass <span class="token operator">=</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">getProxyClass</span><span class="token punctuation">(</span>classLoader<span class="token punctuation">,</span> interfaces<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> constructor <span class="token operator">=</span> proxyClass<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token class-name">InvocationHandler</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ProxyInvocationHandler</span> proxyInvocationHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProxyInvocationHandler</span><span class="token punctuation">(</span>realSubject<span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxySubject <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Subject</span><span class="token punctuation">)</span> constructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span>proxyInvocationHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxySubject<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">&quot;hello proxy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/*
         * 方式2：直接使用Proxy.newProxyInstance创建代理实例
         */</span>
        proxySubject <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Subject</span><span class="token punctuation">)</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>classLoader<span class="token punctuation">,</span> interfaces<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ProxyInvocationHandler</span><span class="token punctuation">(</span>realSubject<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxySubject<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">&quot;hello proxy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br></div></div><h3 id="创建接口实现类的代理对象"><a href="#创建接口实现类的代理对象" class="header-anchor">#</a> 创建接口实现类的代理对象</h3> <h4 id="newproxyinstance"><a href="#newproxyinstance" class="header-anchor">#</a> newProxyInstance</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">newProxyInstance</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span> loader<span class="token punctuation">,</span>
                                      <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> interfaces<span class="token punctuation">,</span>
                                      <span class="token class-name">InvocationHandler</span> h<span class="token punctuation">)</span>
                               <span class="token keyword">throws</span> <span class="token class-name">IllegalArgumentException</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>返回指定接口的代理类的实例，该接口将方法调用分派给指定的调用处理程序。</p> <p><code>Proxy.newProxyInstance</code>因为与<code>IllegalArgumentException</code>相同的原因而<code>Proxy.getProxyClass</code>  。</p> <ul><li><p>参数</p> <p><code>loader</code> - 类加载器来定义代理类   (<strong>类加载器</strong>)</p> <p><code>interfaces</code> - 代理类实现的接口列表    (<strong>增强方法所在类,这个类实现的所有接口</strong>)</p> <p><code>h</code> - 调度方法调用的调用处理函数    (<strong>实现这个接口InvocationHandler,创建代理对象,写增强方法</strong>)</p></li> <li><p>结果</p> <p>具有由指定的类加载器定义并实现指定接口的代理类的指定调用处理程序的代理实例</p></li> <li><p>异常</p> <p><code>IllegalArgumentException</code>  - 如果对可能传递给 <code>getProxyClass</code>有任何 <code>getProxyClass</code>被违反</p> <p><code>SecurityException</code>  -如果安全管理器*，S*存在任何下列条件得到满足：  给定的<code>loader</code>是<code>null</code>  ，并且调用者的类加载器不是<code>null</code> ，并且调用<a href="/java/lang/SecurityManager.html#checkPermission-java.security.Permission-"><code>s.checkPermission</code></a>与<code>RuntimePermission(&quot;getClassLoader&quot;)</code>权限拒绝访问;  对于每个代理接口， <code>intf</code>  ，呼叫者的类加载器是不一样的或类加载器的祖先<code>intf</code>和调用<a href="/java/lang/SecurityManager.html#checkPackageAccess-java.lang.String-"><code>s.checkPackageAccess()</code></a>拒绝访问<code>intf</code>  ;  任何给定的代理接口的是非公和呼叫者类是不在同一<a href="/java/lang/Package.html">runtime package</a>作为非公共接口和调用<a href="/java/lang/SecurityManager.html#checkPermission-java.security.Permission-"><code>s.checkPermission</code></a>与<code>ReflectPermission(&quot;newProxyInPackage.{package name}&quot;)</code>权限拒绝访问。</p> <p><code>NullPointerException</code>  - 如果 <code>interfaces</code>数组参数或其任何元素是 <code>null</code> ，或者如果调用处理程序  <code>h</code>是 <code>null</code></p></li></ul> <p><strong>代码示例:</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>spring5<span class="token punctuation">.</span>demo</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Description
 * @Author Guang Ming Zhang
 * @Date 2021/6/17 15:35
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Subject</span> <span class="token punctuation">{</span>

    <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">String</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>spring5<span class="token punctuation">.</span>demo</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Description
 * @Author Guang Ming Zhang
 * @Date 2021/6/17 15:35
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RealSubject</span>  <span class="token keyword">implements</span> <span class="token class-name">Subject</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">String</span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我是动态代理传过来的参数:&quot;</span> <span class="token operator">+</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>spring5<span class="token punctuation">.</span>demo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Description
 * @Author Guang Ming Zhang
 * @Date 2021/6/17 15:36
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProxyTest</span> <span class="token punctuation">{</span>


    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Subject</span> proxySubject <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Subject</span><span class="token punctuation">)</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">RealSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//类加载器</span>
                <span class="token keyword">new</span> <span class="token class-name">RealSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//增强方法所在类,这个类实现的所有接口</span>
                <span class="token keyword">new</span> <span class="token class-name">InvocationHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//实现这个接口InvocationHandler,创建代理对象,写增强方法</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
                        <span class="token comment">//在转调具体目标对象之前，可以执行一些功能处理</span>

                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;方法名称:&quot;</span> <span class="token operator">+</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;方法入参:&quot;</span> <span class="token operator">+</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;方法之前执行.......&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token comment">//转调具体目标对象的方法</span>
                        <span class="token class-name">Object</span> result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RealSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>


                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;方法之后执行.......&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token comment">//在转调具体目标对象之后，可以执行一些功能处理</span>
                        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxySubject<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;hello proxy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h3 id="isproxyclass"><a href="#isproxyclass" class="header-anchor">#</a> isProxyClass</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>public static boolean isProxyClass(Class&lt;?&gt; cl)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果且仅当使用<code>getProxyClass</code>方法或<code>newProxyInstance</code>方法将指定的类动态生成为代理类时，则返回true。</p> <p>这种方法的可靠性对于使用它来做出安全决策的能力很重要，所以它的实现不应该只是测试所讨论的类是否扩展了<code>Proxy</code>  。</p> <ul><li><p>参数</p> <p><code>cl</code> - 要测试的班级</p></li> <li><p>结果</p> <p><code>true</code>如果该类是代理类， <code>false</code> false</p></li> <li><p>异常</p> <p><code>NullPointerException</code>  - 如果 <code>cl</code>是 <code>null</code></p></li></ul> <p><strong>代码示例:</strong></p> <h3 id="getinvocationhandler"><a href="#getinvocationhandler" class="header-anchor">#</a> getInvocationHandler</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>public static InvocationHandler getInvocationHandler(Object proxy)
                                              throws IllegalArgumentException
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>返回指定代理实例的调用处理程序。</p> <ul><li><p>参数</p> <p><code>proxy</code> - 用于返回调用处理程序的代理实例</p></li> <li><p>结果</p> <p>代理实例的调用处理程序</p></li> <li><p>异常</p> <p><code>IllegalArgumentException</code>  - 如果参数不是代理实例</p> <p><code>SecurityException</code>  -如果安全管理器 <em>，S</em>存在，并且调用者的类加载器是不一样或类加载器的调用处理程序和调用的祖先 <a href="/java/lang/SecurityManager.html#checkPackageAccess-java.lang.String-"><code>s.checkPackageAccess()</code></a>拒绝访问到调用处理程序的类。</p></li></ul> <p><strong>代码示例:</strong></p> <h2 id="代码综合示例"><a href="#代码综合示例" class="header-anchor">#</a> 代码综合示例</h2> <p>注意： <strong>JDK Proxy 只能代理实现接口的类（即使是 extends 继承类也是不可以代理的）</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>com<span class="token punctuation">.</span>test<span class="token punctuation">.</span>java<span class="token punctuation">.</span>base<span class="token punctuation">.</span>dynamicproxy</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Description
 * @Author guangming
 * @Date 2021/5/13 14:44
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>

    <span class="token keyword">void</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>com<span class="token punctuation">.</span>test<span class="token punctuation">.</span>java<span class="token punctuation">.</span>base<span class="token punctuation">.</span>dynamicproxy</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Description
 * @Author guangming
 * @Date 2021/5/13 14:44
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token keyword">implements</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;The dog is eating&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>com<span class="token punctuation">.</span>test<span class="token punctuation">.</span>java<span class="token punctuation">.</span>base<span class="token punctuation">.</span>dynamicproxy</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Description
 * @Author guangming
 * @Date 2021/5/13 14:44
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token keyword">implements</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;The cat is eating&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>com<span class="token punctuation">.</span>test<span class="token punctuation">.</span>java<span class="token punctuation">.</span>base<span class="token punctuation">.</span>dynamicproxy</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationHandler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Proxy</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * JDK 代理类
 *
 * @Description
 * @Author Guang Ming Zhang
 * @Date 2021/5/13 14:47
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AnimalProxy</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{</span>
    <span class="token comment">// 代理对象</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> target<span class="token punctuation">;</span>


    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token class-name">Object</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">;</span>
        <span class="token comment">// 取得代理对象</span>
        <span class="token keyword">return</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;调用前&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//方法调用</span>
        <span class="token class-name">Object</span> result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;调用后&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// JDK 动态代理调用</span>
        <span class="token class-name">AnimalProxy</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnimalProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Animal</span> dogProxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Animal</span><span class="token punctuation">)</span> proxy<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dogProxy<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h1 id="cglib-动态代理"><a href="#cglib-动态代理" class="header-anchor">#</a> CGLIB 动态代理</h1> <h2 id="什么是cglib"><a href="#什么是cglib" class="header-anchor">#</a> 什么是CGLIB</h2> <p>CGLIB是一个强大的、高性能的代码生成库。其被广泛应用于AOP框架（Spring、dynaop）中，用以提供方法拦截操作。Hibernate作为一个比较受欢迎的ORM框架，同样使用CGLIB来代理单端（多对一和一对一）关联（延迟提取集合使用的另一种机制）。CGLIB作为一个开源项目，其代码托管在github，地址为：https://github.com/cglib/cglib</p> <h2 id="为什么使用cglib"><a href="#为什么使用cglib" class="header-anchor">#</a> 为什么使用CGLIB</h2> <p>CGLIB代理主要通过对字节码的操作，为对象引入间接级别，以控制对象的访问。我们知道Java中有一个动态代理也是做这个事情的，那我们为什么不直接使用Java动态代理，而要使用CGLIB呢？</p> <p>答案是CGLIB相比于JDK动态代理更加强大，JDK动态代理虽然简单易用，但是其有一个致命缺陷是，只能对接口进行代理。如果要代理的类为一个普通类、没有接口，那么Java动态代理就没法使用了。关于Java动态代理，可以参者这里<a href="http://blog.csdn.net/danchu/article/details/70146985" target="_blank" rel="noopener noreferrer">Java动态代理分析<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="cglib组成结构"><a href="#cglib组成结构" class="header-anchor">#</a> CGLIB组成结构</h2> <p><img src="/assets/img/jnbNov2005-1.7eb24dca.png" alt="image"></p> <p>CGLIB底层使用了ASM（一个短小精悍的字节码操作框架）来操作字节码生成新的类。除了CGLIB库外，脚本语言（如Groovy何BeanShell）也使用ASM生成字节码。ASM使用类似SAX的解析器来实现高性能。我们不鼓励直接使用ASM，因为它需要对Java字节码的格式足够的了解</p> <p>注意：<strong>cglib 底层是通过子类继承被代理对象的方式实现动态代理的，因此代理类不能是最终类（final），否则就会报错 java.lang.IllegalArgumentException: Cannot subclass final class xxx。</strong></p> <h2 id="cglib-maven引用"><a href="#cglib-maven引用" class="header-anchor">#</a> CGLIB Maven引用</h2> <p>要是用 cglib 实现要添加对 cglib 的引用，如果是 maven 项目的话，直接添加以下代码：</p> <div class="language-maven line-numbers-mode"><pre class="language-text"><code>&lt;dependency&gt;
    &lt;groupId&gt;cglib&lt;/groupId&gt;
    &lt;artifactId&gt;cglib&lt;/artifactId&gt;
    &lt;version&gt;3.2.12&lt;/version&gt;
&lt;/dependency&gt;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="代码示例"><a href="#代码示例" class="header-anchor">#</a> 代码示例</h2> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>com<span class="token punctuation">.</span>test<span class="token punctuation">.</span>java<span class="token punctuation">.</span>base<span class="token punctuation">.</span>dynamicproxy</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span></span><span class="token class-name">Enhancer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span></span><span class="token class-name">MethodInterceptor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span></span><span class="token class-name">MethodProxy</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Description
 * @Author Guang Ming Zhang
 * @Date 2021/5/13 15:44
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SampleClass</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;方法执行中.....hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Enhancer</span> enhancer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Enhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        enhancer<span class="token punctuation">.</span><span class="token function">setSuperclass</span><span class="token punctuation">(</span><span class="token class-name">SampleClass</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        enhancer<span class="token punctuation">.</span><span class="token function">setCallback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MethodInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> <span class="token class-name">MethodProxy</span> proxy<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;执行方法前.....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Object</span> result <span class="token operator">=</span> proxy<span class="token punctuation">.</span><span class="token function">invokeSuper</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;执行方法后.....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> result<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SampleClass</span> sample <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SampleClass</span><span class="token punctuation">)</span> enhancer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sample<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//出参:</span>

执行方法前<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
方法执行中<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>hello world
执行方法后<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="api"><a href="#api" class="header-anchor">#</a> API</h2> <h3 id="enhancer"><a href="#enhancer" class="header-anchor">#</a> Enhancer</h3> <p>Enhancer可能是CGLIB中最常用的一个类，和Java1.3动态代理中引入的Proxy类差不多(如果对Proxy不懂，可以参考<a href="http://blog.csdn.net/danchu/article/details/70146985" target="_blank" rel="noopener noreferrer">这里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)。和Proxy不同的是，Enhancer既能够代理普通的class，也能够代理接口。Enhancer创建一个被代理对象的子类并且拦截所有的方法调用（包括从Object中继承的toString和hashCode方法）。Enhancer不能够拦截final方法，例如Object.getClass()方法，这是由于Java final方法语义决定的。基于同样的道理，Enhancer也不能对fianl类进行代理操作。这也是Hibernate为什么不能持久化final class的原因。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class SampleClass {
    public String test(String input){
        return &quot;hello world&quot;;
    }
}
   1234512345
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>下面我们将以这个类作为主要的测试类，来测试调用各种方法</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>@Test
public void testFixedValue(){
    Enhancer enhancer = new Enhancer();
    enhancer.setSuperclass(SampleClass.class);
    enhancer.setCallback(new FixedValue() {
        @Override
        public Object loadObject() throws Exception {
            return &quot;Hello cglib&quot;;
        }
    });
    SampleClass proxy = (SampleClass) enhancer.create();
    System.out.println(proxy.test(null)); //拦截test，输出Hello cglib
    System.out.println(proxy.toString()); 
    System.out.println(proxy.getClass());
    System.out.println(proxy.hashCode());
}
   1234567891011121314151612345678910111213141516
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>程序的输出为：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Hello cglib
Hello cglib
class com.zeus.cglib.SampleClass$$EnhancerByCGLIB$$e3ea9b7

java.lang.ClassCastException: java.lang.String cannot be cast to java.lang.Number

    at com.zeus.cglib.SampleClass$$EnhancerByCGLIB$$e3ea9b7.hashCode(&lt;generated&gt;)
    ...
   1234567812345678
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>上述代码中，FixedValue用来对所有拦截的方法返回相同的值，从输出我们可以看出来，Enhancer对非final方法test()、toString()、hashCode()进行了拦截，没有对getClass进行拦截。由于hashCode()方法需要返回一个Number，但是我们返回的是一个String，这解释了上面的程序中为什么会抛出异常。</p> <p>Enhancer.setSuperclass用来设置父类型，从toString方法可以看出，使用CGLIB生成的类为被代理类的一个子类，形如：SampleClass<script type="math/tex" id="MathJax-Element-1"></script>EnhancerByCGLIB<script type="math/tex" id="MathJax-Element-2"></script>e3ea9b7</p> <p>Enhancer.create(Object…)方法是用来创建增强对象的，其提供了很多不同参数的方法用来匹配被增强类的不同构造方法。（虽然类的构造放法只是Java字节码层面的函数，但是Enhancer却不能对其进行操作。Enhancer同样不能操作static或者final类）。我们也可以先使用Enhancer.createClass()来创建字节码(.class)，然后用字节码动态的生成增强后的对象。</p> <p>可以使用一个InvocationHandler(如果对InvocationHandler不懂，可以参考<a href="http://blog.csdn.net/danchu/article/details/70146985" target="_blank" rel="noopener noreferrer">这里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)作为回调，使用invoke方法来替换直接访问类的方法，但是你必须注意死循环。因为invoke中调用的任何原代理类方法，均会重新代理到invoke方法中。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public void testInvocationHandler() throws Exception{
    Enhancer enhancer = new Enhancer();
    enhancer.setSuperclass(SampleClass.class);
    enhancer.setCallback(new InvocationHandler() {
        @Override
        public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
            if(method.getDeclaringClass() != Object.class &amp;&amp; method.getReturnType() == String.class){
                return &quot;hello cglib&quot;;
            }else{
                throw new RuntimeException(&quot;Do not know what to do&quot;);
            }
        }
    });
    SampleClass proxy = (SampleClass) enhancer.create();
    Assert.assertEquals(&quot;hello cglib&quot;, proxy.test(null));
    Assert.assertNotEquals(&quot;Hello cglib&quot;, proxy.toString());
}
   12345678910111213141516171234567891011121314151617
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>为了避免这种死循环，我们可以使用MethodInterceptor，MethodInterceptor的例子在前面的hello world中已经介绍过了，这里就不浪费时间了。</p> <p>有些时候我们可能只想对特定的方法进行拦截，对其他的方法直接放行，不做任何操作，使用Enhancer处理这种需求同样很简单,只需要一个CallbackFilter即可：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>@Test
public void testCallbackFilter() throws Exception{
    Enhancer enhancer = new Enhancer();
    CallbackHelper callbackHelper = new CallbackHelper(SampleClass.class, new Class[0]) {
        @Override
        protected Object getCallback(Method method) {
            if(method.getDeclaringClass() != Object.class &amp;&amp; method.getReturnType() == String.class){
                return new FixedValue() {
                    @Override
                    public Object loadObject() throws Exception {
                        return &quot;Hello cglib&quot;;
                    }
                };
            }else{
                return NoOp.INSTANCE;
            }
        }
    };
    enhancer.setSuperclass(SampleClass.class);
    enhancer.setCallbackFilter(callbackHelper);
    enhancer.setCallbacks(callbackHelper.getCallbacks());
    SampleClass proxy = (SampleClass) enhancer.create();
    Assert.assertEquals(&quot;Hello cglib&quot;, proxy.test(null));
    Assert.assertNotEquals(&quot;Hello cglib&quot;,proxy.toString());
    System.out.println(proxy.hashCode());
}
   12345678910111213141516171819202122232425261234567891011121314151617181920212223242526
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="immutablebean"><a href="#immutablebean" class="header-anchor">#</a> ImmutableBean</h3> <p>通过名字就可以知道，不可变的Bean。ImmutableBean允许创建一个原来对象的包装类，这个包装类是不可变的，任何改变底层对象的包装类操作都会抛出IllegalStateException。但是我们可以通过直接操作底层对象来改变包装类对象。这有点类似于Guava中的不可变视图</p> <p>为了对ImmutableBean进行测试，这里需要再引入一个bean</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class SampleBean {
    private String value;

    public SampleBean() {
    }

    public SampleBean(String value) {
        this.value = value;
    }
    public String getValue() {
        return value;
    }

    public void setValue(String value) {
        this.value = value;
    }
}
   12345678910111213141516171234567891011121314151617
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>然后编写测试类如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>@Test(expected = IllegalStateException.class)
public void testImmutableBean() throws Exception{
    SampleBean bean = new SampleBean();
    bean.setValue(&quot;Hello world&quot;);
    SampleBean immutableBean = (SampleBean) ImmutableBean.create(bean); //创建不可变类
    Assert.assertEquals(&quot;Hello world&quot;,immutableBean.getValue()); 
    bean.setValue(&quot;Hello world, again&quot;); //可以通过底层对象来进行修改
    Assert.assertEquals(&quot;Hello world, again&quot;, immutableBean.getValue());
    immutableBean.setValue(&quot;Hello cglib&quot;); //直接修改将throw exception
}
   1234567891012345678910
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="beangenerator"><a href="#beangenerator" class="header-anchor">#</a> BeanGenerator</h3> <p>cglib提供的一个操作bean的工具，使用它能够在运行时动态的创建一个bean。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>@Test
public void testBeanGenerator() throws Exception{
    BeanGenerator beanGenerator = new BeanGenerator();
    beanGenerator.addProperty(&quot;value&quot;,String.class);
    Object myBean = beanGenerator.create();
    Method setter = myBean.getClass().getMethod(&quot;setValue&quot;,String.class);
    setter.invoke(myBean,&quot;Hello cglib&quot;);

    Method getter = myBean.getClass().getMethod(&quot;getValue&quot;);
    Assert.assertEquals(&quot;Hello cglib&quot;,getter.invoke(myBean));
}
   12345678910111234567891011
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>在上面的代码中，我们使用cglib动态的创建了一个和SampleBean相同的Bean对象，包含一个属性value以及getter、setter方法</p> <h3 id="beancopier"><a href="#beancopier" class="header-anchor">#</a> BeanCopier</h3> <p>cglib提供的能够从一个bean复制到另一个bean中，而且其还提供了一个转换器，用来在转换的时候对bean的属性进行操作。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class OtherSampleBean {
    private String value;

    public String getValue() {
        return value;
    }

    public void setValue(String value) {
        this.value = value;
    }
}

@Test
public void testBeanCopier() throws Exception{
    BeanCopier copier = BeanCopier.create(SampleBean.class, OtherSampleBean.class, false);//设置为true，则使用converter
    SampleBean myBean = new SampleBean();
    myBean.setValue(&quot;Hello cglib&quot;);
    OtherSampleBean otherBean = new OtherSampleBean();
    copier.copy(myBean, otherBean, null); //设置为true，则传入converter指明怎么进行转换
   assertEquals(&quot;Hello cglib&quot;, otherBean.getValue());
}
   123456789101112131415161718192021123456789101112131415161718192021
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="bulkbean"><a href="#bulkbean" class="header-anchor">#</a> BulkBean</h3> <p>相比于BeanCopier，BulkBean将copy的动作拆分为getPropertyValues和setPropertyValues两个方法，允许自定义处理属性</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>@Test
public void testBulkBean() throws Exception{
    BulkBean bulkBean = BulkBean.create(SampleBean.class,
            new String[]{&quot;getValue&quot;},
            new String[]{&quot;setValue&quot;},
            new Class[]{String.class});
    SampleBean bean = new SampleBean();
    bean.setValue(&quot;Hello world&quot;);
    Object[] propertyValues = bulkBean.getPropertyValues(bean);
    assertEquals(1, bulkBean.getPropertyValues(bean).length);
    assertEquals(&quot;Hello world&quot;, bulkBean.getPropertyValues(bean)[0]);
    bulkBean.setPropertyValues(bean,new Object[]{&quot;Hello cglib&quot;});
    assertEquals(&quot;Hello cglib&quot;, bean.getValue());
}
   12345678910111213141234567891011121314
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>使用注意：
\1. 避免每次进行BulkBean.create创建对象，一般将其声明为static的
\2. 应用场景：针对特定属性的get,set操作，一般适用通过xml配置注入和注出的属性，运行时才确定处理的Source,Target类，只需要关注属性名即可。</p> <h3 id="beanmap"><a href="#beanmap" class="header-anchor">#</a> BeanMap</h3> <p>BeanMap类实现了Java Map，将一个bean对象中的所有属性转换为一个String-to-Obejct的Java Map</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>@Test
public void testBeanMap() throws Exception{
    BeanGenerator generator = new BeanGenerator();
    generator.addProperty(&quot;username&quot;,String.class);
    generator.addProperty(&quot;password&quot;,String.class);
    Object bean = generator.create();
    Method setUserName = bean.getClass().getMethod(&quot;setUsername&quot;, String.class);
    Method setPassword = bean.getClass().getMethod(&quot;setPassword&quot;, String.class);
    setUserName.invoke(bean, &quot;admin&quot;);
    setPassword.invoke(bean,&quot;password&quot;);
    BeanMap map = BeanMap.create(bean);
    Assert.assertEquals(&quot;admin&quot;, map.get(&quot;username&quot;));
    Assert.assertEquals(&quot;password&quot;, map.get(&quot;password&quot;));
}
   12345678910111213141234567891011121314
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>我们使用BeanGenerator生成了一个含有两个属性的Java Bean，对其进行赋值操作后，生成了一个BeanMap对象，通过获取值来进行验证</p> <h3 id="keyfactory"><a href="#keyfactory" class="header-anchor">#</a> keyFactory</h3> <p>keyFactory类用来动态生成接口的实例，接口需要只包含一个newInstance方法，返回一个Object。keyFactory为构造出来的实例动态生成了Object.equals和Object.hashCode方法，能够确保相同的参数构造出的实例为单例的。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public interface SampleKeyFactory {
    Object newInstance(String first, int second);
}
   123123
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>我们首先构造一个满足条件的接口，然后进行测试</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>@Test
public void testKeyFactory() throws Exception{
    SampleKeyFactory keyFactory = (SampleKeyFactory) KeyFactory.create(SampleKeyFactory.class);
    Object key = keyFactory.newInstance(&quot;foo&quot;, 42);
    Object key1 = keyFactory.newInstance(&quot;foo&quot;, 42);
    Assert.assertEquals(key,key1);//测试参数相同，结果是否相等
}
   12345671234567
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="mixin-混合"><a href="#mixin-混合" class="header-anchor">#</a> Mixin(混合)</h3> <p>Mixin能够让我们将多个对象整合到一个对象中去，前提是这些对象必须是接口的实现。可能这样说比较晦涩，以代码为例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class MixinInterfaceTest {
    interface Interface1{
        String first();
    }
    interface Interface2{
        String second();
    }

    class Class1 implements Interface1{
        @Override
        public String first() {
            return &quot;first&quot;;
        }
    }

    class Class2 implements Interface2{
        @Override
        public String second() {
            return &quot;second&quot;;
        }
    }

    interface MixinInterface extends Interface1, Interface2{

    }

    @Test
    public void testMixin() throws Exception{
        Mixin mixin = Mixin.create(new Class[]{Interface1.class, Interface2.class,
                        MixinInterface.class}, new Object[]{new Class1(),new Class2()});
        MixinInterface mixinDelegate = (MixinInterface) mixin;
        assertEquals(&quot;first&quot;, mixinDelegate.first());
        assertEquals(&quot;second&quot;, mixinDelegate.second());
    }
}
   12345678910111213141516171819202122232425262728293031323334351234567891011121314151617181920212223242526272829303132333435
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>Mixin类比较尴尬，因为他要求Minix的类（例如MixinInterface）实现一些接口。既然被Minix的类已经实现了相应的接口，那么我就直接可以通过纯Java的方式实现，没有必要使用Minix类。</p> <h3 id="stringswitcher"><a href="#stringswitcher" class="header-anchor">#</a> StringSwitcher</h3> <p>用来模拟一个String到int类型的Map类型。如果在Java7以后的版本中，类似一个switch语句。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>@Test
public void testStringSwitcher() throws Exception{
    String[] strings = new String[]{&quot;one&quot;, &quot;two&quot;};
    int[] values = new int[]{10,20};
    StringSwitcher stringSwitcher = StringSwitcher.create(strings,values,true);
    assertEquals(10, stringSwitcher.intValue(&quot;one&quot;));
    assertEquals(20, stringSwitcher.intValue(&quot;two&quot;));
    assertEquals(-1, stringSwitcher.intValue(&quot;three&quot;));
}
   123456789123456789
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="interfacemaker"><a href="#interfacemaker" class="header-anchor">#</a> InterfaceMaker</h3> <p>正如名字所言，Interface Maker用来创建一个新的Interface</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>@Test
public void testInterfaceMarker() throws Exception{
    Signature signature = new Signature(&quot;foo&quot;, Type.DOUBLE_TYPE, new Type[]{Type.INT_TYPE});
    InterfaceMaker interfaceMaker = new InterfaceMaker();
    interfaceMaker.add(signature, new Type[0]);
    Class iface = interfaceMaker.create();
    assertEquals(1, iface.getMethods().length);
    assertEquals(&quot;foo&quot;, iface.getMethods()[0].getName());
    assertEquals(double.class, iface.getMethods()[0].getReturnType());
}
   1234567891012345678910
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>上述的Interface Maker创建的接口中只含有一个方法，签名为double foo(int)。Interface Maker与上面介绍的其他类不同，它依赖ASM中的Type类型。由于接口仅仅只用做在编译时期进行类型检查，因此在一个运行的应用中动态的创建接口没有什么作用。但是InterfaceMaker可以用来自动生成代码，为以后的开发做准备。</p> <h3 id="methoddelegate"><a href="#methoddelegate" class="header-anchor">#</a> MethodDelegate</h3> <p>MethodDelegate主要用来对方法进行代理</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>interface BeanDelegate{
    String getValueFromDelegate();
}

@Test
public void testMethodDelegate()  throws Exception{
    SampleBean bean = new SampleBean();
    bean.setValue(&quot;Hello cglib&quot;);
    BeanDelegate delegate = (BeanDelegate) MethodDelegate.create(bean,&quot;getValue&quot;, BeanDelegate.class);
    assertEquals(&quot;Hello cglib&quot;, delegate.getValueFromDelegate());
}
   12345678910111234567891011
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>关于Method.create的参数说明：
\1. 第二个参数为即将被代理的方法
\2. 第一个参数必须是一个无参数构造的bean。因此MethodDelegate.create并不是你想象的那么有用
\3. 第三个参数为只含有一个方法的接口。当这个接口中的方法被调用的时候，将会调用第一个参数所指向bean的第二个参数方法</p> <p>缺点：
\1. 为每一个代理类创建了一个新的类，这样可能会占用大量的永久代堆内存
\2. 你不能代理需要参数的方法
\3. 如果你定义的接口中的方法需要参数，那么代理将不会工作，并且也不会抛出异常；如果你的接口中方法需要其他的返回类型，那么将抛出IllegalArgumentException</p> <h3 id="multicastdelegate"><a href="#multicastdelegate" class="header-anchor">#</a> MulticastDelegate</h3> <ol><li>多重代理和方法代理差不多，都是将代理类方法的调用委托给被代理类。使用前提是需要一个接口，以及一个类实现了该接口</li> <li>通过这种interface的继承关系，我们能够将接口上方法的调用分散给各个实现类上面去。</li> <li>多重代理的缺点是接口只能含有一个方法，如果被代理的方法拥有返回值，那么调用代理类的返回值为最后一个添加的被代理类的方法返回值</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>public interface DelegatationProvider {
    void setValue(String value);
}

public class SimpleMulticastBean implements DelegatationProvider {
    private String value;
    @Override
    public void setValue(String value) {
        this.value = value;
    }

    public String getValue() {
        return value;
    }
}

@Test
public void testMulticastDelegate() throws Exception{
    MulticastDelegate multicastDelegate = MulticastDelegate.create(DelegatationProvider.class);
    SimpleMulticastBean first = new SimpleMulticastBean();
    SimpleMulticastBean second = new SimpleMulticastBean();
    multicastDelegate = multicastDelegate.add(first);
    multicastDelegate  = multicastDelegate.add(second);

    DelegatationProvider provider = (DelegatationProvider) multicastDelegate;
    provider.setValue(&quot;Hello world&quot;);

    assertEquals(&quot;Hello world&quot;, first.getValue());
    assertEquals(&quot;Hello world&quot;, second.getValue());
}
   123456789101112131415161718192021222324252627282930123456789101112131415161718192021222324252627282930
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h3 id="constructordelegate"><a href="#constructordelegate" class="header-anchor">#</a> ConstructorDelegate</h3> <p>为了对构造函数进行代理，我们需要一个接口，这个接口只含有一个Object newInstance(…)方法，用来调用相应的构造函数</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>interface SampleBeanConstructorDelegate{
    Object newInstance(String value);
}

/**
 * 对构造函数进行代理
 * @throws Exception
 */
@Test
public void testConstructorDelegate() throws Exception{
    SampleBeanConstructorDelegate constructorDelegate = (SampleBeanConstructorDelegate) ConstructorDelegate.create(
            SampleBean.class, SampleBeanConstructorDelegate.class);
    SampleBean bean = (SampleBean) constructorDelegate.newInstance(&quot;Hello world&quot;);
    assertTrue(SampleBean.class.isAssignableFrom(bean.getClass()));
    System.out.println(bean.getValue());
}
   1234567891011121314151612345678910111213141516
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="parallelsorter-并行排序器"><a href="#parallelsorter-并行排序器" class="header-anchor">#</a> ParallelSorter(并行排序器)</h3> <p>能够对多个数组同时进行排序，目前实现的算法有归并排序和快速排序</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>@Test
public void testParallelSorter() throws Exception{
    Integer[][] value = {
            {4, 3, 9, 0},
            {2, 1, 6, 0}
    };
    ParallelSorter.create(value).mergeSort(0);
    for(Integer[] row : value){
        int former = -1;
        for(int val : row){
            assertTrue(former &lt; val);
            former = val;
        }
    }
}
   123456789101112131415123456789101112131415
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="fastclass"><a href="#fastclass" class="header-anchor">#</a> FastClass</h3> <p>顾明思义，FastClass就是对Class对象进行特定的处理，比如通过数组保存method引用，因此FastClass引出了一个index下标的新概念，比如getIndex(String name, Class[] parameterTypes)就是以前的获取method的方法。通过数组存储method,constructor等class信息，从而将原先的反射调用，转化为class.index的直接调用，从而体现所谓的FastClass。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>@Test
public void testFastClass() throws Exception{
    FastClass fastClass = FastClass.create(SampleBean.class);
    FastMethod fastMethod = fastClass.getMethod(&quot;getValue&quot;,new Class[0]);
    SampleBean bean = new SampleBean();
    bean.setValue(&quot;Hello world&quot;);
    assertEquals(&quot;Hello world&quot;,fastMethod.invoke(bean, new Object[0]));
}
   1234567812345678
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="注意"><a href="#注意" class="header-anchor">#</a> 注意</h2> <p>由于CGLIB的大部分类是直接对Java字节码进行操作，这样生成的类会在Java的永久堆中。如果动态代理操作过多，容易造成永久堆满，触发OutOfMemory异常。</p> <h1 id="cglib和java动态代理的区别"><a href="#cglib和java动态代理的区别" class="header-anchor">#</a> CGLIB和Java动态代理的区别</h1> <ol><li>Java动态代理只能够对接口进行代理，不能对普通的类进行代理（因为所有生成的代理类的父类为Proxy，Java类继承机制不允许多重继承）；CGLIB能够代理普通类；</li> <li>Java动态代理使用Java原生的反射API进行操作，在生成类上比较高效；CGLIB使用ASM框架直接对字节码进行操作，在类的执行过程中比较高效</li></ol> <h1 id="面试笔试题"><a href="#面试笔试题" class="header-anchor">#</a> 面试笔试题</h1> <p><strong>1.动态代理解决了什么问题？</strong></p> <p>答：首先它是一个代理机制，代理可以看作是对调用目标的一个包装，这样我们对目标代码的调用不是直接发生的，而是通过代理完成，通过代理可以让调用者与实现者之间解耦。比如进行 RPC 调用，通过代理，可以提供更加友善的界面；还可以通过代理，做一个全局的拦截器。</p> <p><strong>2.动态代理和反射的关系是什么？</strong></p> <p>答：反射可以用来实现动态代理，但动态代理还有其他的实现方式，比如 ASM（一个短小精悍的字节码操作框架）、cglib 等。</p> <p><strong>3.以下描述错误的是？</strong></p> <p>A：cglib 的性能更高
B：Spring 中有使用 cglib 来实现动态代理
C：Spring 中有使用 JDK 原生的动态代理
D：JDK 原生动态代理性能更高</p> <p>答：D</p> <p>题目解析：Spring 动态代理的实现方式有两种：cglib 和 JDK 原生动态代理。</p> <p><strong>4.请补全以下代码？</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">MyReflect</span> <span class="token punctuation">{</span>
    <span class="token comment">// 私有方法</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">privateMd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Private Method&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">ReflectTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">,</span> <span class="token class-name">NoSuchMethodException</span><span class="token punctuation">,</span> <span class="token class-name">InvocationTargetException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalAccessException</span><span class="token punctuation">,</span> <span class="token class-name">InstantiationException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Class</span> myClass <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;MyReflect&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> object <span class="token operator">=</span> myClass<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 补充此行代码</span>
        method<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>答：<code>Method method = myClass.getDeclaredMethod(&quot;privateMd&quot;);</code></p> <p>题目解析：此题主要考的是私有方法的获取，私有方法的获取并不是通过 getMethod() 方式，而是通过 getDeclaredMethod() 获取的。</p> <p><strong>5.cglib 可以代理任何类这句话对吗？为什么？</strong></p> <p>答：不完全对，因为 cglib 只能代理可以有子类的普通类，对于像最终类（final），cglib 是不能实现动态代理的，因为 cglib 的底层是通过继承代理类的子类来实现动态代理的，所以不能被继承类无法使用 cglib。</p> <p><strong>6.JDK 原生动态代理和 cglib 有什么区别？</strong></p> <p>答：JDK 原生动态代理和 cglib 区别如下：</p> <ul><li>JDK 原生动态代理是基于接口实现的，不需要添加任何依赖，可以平滑的支持 JDK 版本的升级；</li> <li>cglib 不需要实现接口，可以直接代理普通类，需要添加依赖包，性能更高。</li></ul> <p><strong>7.为什么 JDK 原生的动态代理必须要通过接口来完成？</strong></p> <p>答：这是由于 JDK 原生设计的原因，动态代理的实现方法 newProxyInstance() 的源码如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>/**
 * ......
 * @param   loader the class loader to define the proxy class
 * @param   interfaces the list of interfaces for the proxy class to implement
 * ......
 */ 
@CallerSensitive
public static Object newProxyInstance(ClassLoader loader,
                                      Class&lt;?&gt;[] interfaces,
                                      InvocationHandler h)
    throws IllegalArgumentException
{
// 省略其他代码
12345678910111213
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>可以看到，前两个参数的声明：</p> <ul><li>loader：为类加载器，也就是 target.getClass().getClassLoader()</li> <li>interfaces：接口代理类的接口实现列表</li></ul> <p>因此，要使用 JDK 原生的动态只能通过实现接口来完成。</p></div></div>  <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/06/04, 00:57:28</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/7ec08c/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Serializable 详解</div></a> <a href="/pages/78e39b/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Enum详解</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/7ec08c/" class="prev">Serializable 详解</a></span> <span class="next"><a href="/pages/78e39b/">Enum详解</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:zgming@aliyun.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/coder-gm" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2017-2022
    <span>苏ICP备2022003313号-1</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.44e0923e.js" defer></script><script src="/assets/js/2.4a42c91c.js" defer></script><script src="/assets/js/26.054194a4.js" defer></script>
  </body>
</html>
