<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Seata分布式事务解决方案 | Coder&#39;Gm 博客</title>
    <meta name="generator" content="VuePress 1.9.2">
    <link rel="icon" href="/img/icon/note2.png">
    <meta name="description" content="当你的能力支撑不了你的野心的时候，该努力了！！">
    <meta name="keywords" content="Java 全栈知识体系, java体系, java知识体系, java框架,java详解,java学习路线,java spring, java面试, 知识体系, java技术体系, java编程, java编程指南,java开发体系, java开发,java教程,java,java数据结构, 算法, 开发基础">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.a214389c.css" as="style"><link rel="preload" href="/assets/js/app.44e0923e.js" as="script"><link rel="preload" href="/assets/js/2.4a42c91c.js" as="script"><link rel="preload" href="/assets/js/5.51cab261.js" as="script"><link rel="prefetch" href="/assets/js/10.6658714f.js"><link rel="prefetch" href="/assets/js/100.fe3f39f7.js"><link rel="prefetch" href="/assets/js/101.d5ed3265.js"><link rel="prefetch" href="/assets/js/102.e768d81f.js"><link rel="prefetch" href="/assets/js/103.5535decf.js"><link rel="prefetch" href="/assets/js/11.856f3e3b.js"><link rel="prefetch" href="/assets/js/12.113736c0.js"><link rel="prefetch" href="/assets/js/13.9c439c56.js"><link rel="prefetch" href="/assets/js/14.394ab678.js"><link rel="prefetch" href="/assets/js/15.42d5a0c1.js"><link rel="prefetch" href="/assets/js/16.70d9bc18.js"><link rel="prefetch" href="/assets/js/17.ee4dc88a.js"><link rel="prefetch" href="/assets/js/18.e895a1b3.js"><link rel="prefetch" href="/assets/js/19.bc852c28.js"><link rel="prefetch" href="/assets/js/20.ba3e82a7.js"><link rel="prefetch" href="/assets/js/21.62e9db3b.js"><link rel="prefetch" href="/assets/js/22.cf165019.js"><link rel="prefetch" href="/assets/js/23.1bb9d2ab.js"><link rel="prefetch" href="/assets/js/24.69003ae4.js"><link rel="prefetch" href="/assets/js/25.5ac5fe93.js"><link rel="prefetch" href="/assets/js/26.054194a4.js"><link rel="prefetch" href="/assets/js/27.b411ecdb.js"><link rel="prefetch" href="/assets/js/28.147c4123.js"><link rel="prefetch" href="/assets/js/29.6104efa6.js"><link rel="prefetch" href="/assets/js/3.100b0cf3.js"><link rel="prefetch" href="/assets/js/30.197cf614.js"><link rel="prefetch" href="/assets/js/31.c11c4e4b.js"><link rel="prefetch" href="/assets/js/32.5a90f912.js"><link rel="prefetch" href="/assets/js/33.e3239d33.js"><link rel="prefetch" href="/assets/js/34.e5d60e2a.js"><link rel="prefetch" href="/assets/js/35.ac3a35fa.js"><link rel="prefetch" href="/assets/js/36.88afe5ff.js"><link rel="prefetch" href="/assets/js/37.e6d77bda.js"><link rel="prefetch" href="/assets/js/38.860aa95b.js"><link rel="prefetch" href="/assets/js/39.ff782303.js"><link rel="prefetch" href="/assets/js/4.76e5fb0d.js"><link rel="prefetch" href="/assets/js/40.b0965bf4.js"><link rel="prefetch" href="/assets/js/41.f3fc54f3.js"><link rel="prefetch" href="/assets/js/42.c0751c0f.js"><link rel="prefetch" href="/assets/js/43.8bf64311.js"><link rel="prefetch" href="/assets/js/44.6754651c.js"><link rel="prefetch" href="/assets/js/45.b16895ec.js"><link rel="prefetch" href="/assets/js/46.7226b679.js"><link rel="prefetch" href="/assets/js/47.bc142da5.js"><link rel="prefetch" href="/assets/js/48.32b41242.js"><link rel="prefetch" href="/assets/js/49.292eb956.js"><link rel="prefetch" href="/assets/js/50.079daeec.js"><link rel="prefetch" href="/assets/js/51.d8fb6190.js"><link rel="prefetch" href="/assets/js/52.f1a80eb0.js"><link rel="prefetch" href="/assets/js/53.bfc87ec7.js"><link rel="prefetch" href="/assets/js/54.0d5b8f7b.js"><link rel="prefetch" href="/assets/js/55.031bdd5c.js"><link rel="prefetch" href="/assets/js/56.51a9f261.js"><link rel="prefetch" href="/assets/js/57.7badb0db.js"><link rel="prefetch" href="/assets/js/58.11e7c84b.js"><link rel="prefetch" href="/assets/js/59.09ea85f8.js"><link rel="prefetch" href="/assets/js/6.1217ecf0.js"><link rel="prefetch" href="/assets/js/60.f49dff36.js"><link rel="prefetch" href="/assets/js/61.fc20fc9d.js"><link rel="prefetch" href="/assets/js/62.733e3477.js"><link rel="prefetch" href="/assets/js/63.4bfe99a2.js"><link rel="prefetch" href="/assets/js/64.8227fa59.js"><link rel="prefetch" href="/assets/js/65.9338d8cf.js"><link rel="prefetch" href="/assets/js/66.35d63c81.js"><link rel="prefetch" href="/assets/js/67.0224d223.js"><link rel="prefetch" href="/assets/js/68.bee1f22f.js"><link rel="prefetch" href="/assets/js/69.08704d94.js"><link rel="prefetch" href="/assets/js/7.dc50503c.js"><link rel="prefetch" href="/assets/js/70.3b5276a1.js"><link rel="prefetch" href="/assets/js/71.7d766a0b.js"><link rel="prefetch" href="/assets/js/72.f66ed860.js"><link rel="prefetch" href="/assets/js/73.a0002ad9.js"><link rel="prefetch" href="/assets/js/74.c0599b56.js"><link rel="prefetch" href="/assets/js/75.1ca91be9.js"><link rel="prefetch" href="/assets/js/76.17f9d853.js"><link rel="prefetch" href="/assets/js/77.e563741a.js"><link rel="prefetch" href="/assets/js/78.5cb837e1.js"><link rel="prefetch" href="/assets/js/79.599ee9fe.js"><link rel="prefetch" href="/assets/js/8.7e968594.js"><link rel="prefetch" href="/assets/js/80.614e5db3.js"><link rel="prefetch" href="/assets/js/81.256c8bba.js"><link rel="prefetch" href="/assets/js/82.bc28a824.js"><link rel="prefetch" href="/assets/js/83.31f9acee.js"><link rel="prefetch" href="/assets/js/84.65af7ccd.js"><link rel="prefetch" href="/assets/js/85.5f8c614f.js"><link rel="prefetch" href="/assets/js/86.02957e14.js"><link rel="prefetch" href="/assets/js/87.69e40dad.js"><link rel="prefetch" href="/assets/js/88.6b53f094.js"><link rel="prefetch" href="/assets/js/89.d79d52f3.js"><link rel="prefetch" href="/assets/js/9.67eaa601.js"><link rel="prefetch" href="/assets/js/90.ec563f30.js"><link rel="prefetch" href="/assets/js/91.af3f3b1c.js"><link rel="prefetch" href="/assets/js/92.a38cb0ed.js"><link rel="prefetch" href="/assets/js/93.b5aecfec.js"><link rel="prefetch" href="/assets/js/94.ef55686b.js"><link rel="prefetch" href="/assets/js/95.e294b0e5.js"><link rel="prefetch" href="/assets/js/96.6cc86402.js"><link rel="prefetch" href="/assets/js/97.2ddc667e.js"><link rel="prefetch" href="/assets/js/98.b8cf46f9.js"><link rel="prefetch" href="/assets/js/99.aab7dc10.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a214389c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/icon/note2.png" alt="Coder'Gm 博客" class="logo"> <span class="site-name can-hide">Coder'Gm 博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/9931eb/" class="nav-link">面向对象</a></li><li class="dropdown-subitem"><a href="/pages/74fec2/" class="nav-link">数据类型</a></li><li class="dropdown-subitem"><a href="/pages/5bde1a/" class="nav-link">变量类型</a></li><li class="dropdown-subitem"><a href="/pages/28535a/" class="nav-link">控制结构</a></li><li class="dropdown-subitem"><a href="/pages/4074f5/" class="nav-link">超类</a></li><li class="dropdown-subitem"><a href="/pages/db85a8/" class="nav-link">Scanner</a></li><li class="dropdown-subitem"><a href="/pages/341e84/" class="nav-link">反射</a></li><li class="dropdown-subitem"><a href="/pages/7ec08c/" class="nav-link">Serializable(序列化)</a></li><li class="dropdown-subitem"><a href="/pages/fbe16d/" class="nav-link">动态代理</a></li><li class="dropdown-subitem"><a href="/pages/78e39b/" class="nav-link">Enum</a></li><li class="dropdown-subitem"><a href="/pages/0d7979/" class="nav-link">IO流</a></li><li class="dropdown-subitem"><a href="/pages/192add/" class="nav-link">Lambda</a></li><li class="dropdown-subitem"><a href="/pages/d2addf/" class="nav-link">Math</a></li><li class="dropdown-subitem"><a href="/pages/0cdbed/" class="nav-link">Random</a></li><li class="dropdown-subitem"><a href="/pages/b722b1/" class="nav-link">UUID</a></li><li class="dropdown-subitem"><a href="/pages/0f7ad8/" class="nav-link">泛型</a></li><li class="dropdown-subitem"><a href="/pages/148cd7/" class="nav-link">网络通信</a></li><li class="dropdown-subitem"><a href="/pages/f46dcf/" class="nav-link">异常和处理</a></li><li class="dropdown-subitem"><a href="/pages/0e008e/" class="nav-link">正则表达式</a></li><li class="dropdown-subitem"><a href="/pages/f42b16/" class="nav-link">Java注解</a></li><li class="dropdown-subitem"><a href="/pages/dac65d/" class="nav-link">JDBC</a></li></ul></li><li class="dropdown-item"><h4>并发与线程</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/394d30/" class="nav-link">并发编程核心概念</a></li><li class="dropdown-subitem"><a href="/pages/61ba09/" class="nav-link">JUC-2</a></li></ul></li><li class="dropdown-item"><h4>JVM相关</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">JUC-1</a></li><li class="dropdown-subitem"><a href="/pages/61ba09/" class="nav-link">JUC-2</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring" class="dropdown-title"><!----> <span class="title" style="display:;">Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Framework</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/28e3d0/" class="nav-link">基础1</a></li></ul></li><li class="dropdown-item"><h4>Spring Boot</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">JUC-1</a></li><li class="dropdown-subitem"><a href="/pages/61ba09/" class="nav-link">JUC-2</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="SpringCloud" class="dropdown-title"><!----> <span class="title" style="display:;">SpringCloud</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Nacos 注册中心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/9f8459/" class="nav-link">Nacos基本架构和概念</a></li><li class="dropdown-subitem"><a href="/pages/5a44e3/" class="nav-link">Nacos服务注册与发现</a></li><li class="dropdown-subitem"><a href="/pages/20ff14/" class="nav-link">Config服务配置中心</a></li><li class="dropdown-subitem"><a href="/pages/f84a0c/" class="nav-link">Nacos安装部署 </a></li></ul></li><li class="dropdown-item"><h4>Gateway 微服务网关</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/e87c7c/" class="nav-link">Gateway核心概念</a></li><li class="dropdown-subitem"><a href="/pages/6b0fb9/" class="nav-link">Gateway路由</a></li><li class="dropdown-subitem"><a href="/pages/1a393f/" class="nav-link">Gateway断言</a></li><li class="dropdown-subitem"><a href="/pages/60ff28/" class="nav-link">Gateway过滤器</a></li><li class="dropdown-subitem"><a href="/pages/8fc690/" class="nav-link">Alibaba问题汇总</a></li><li class="dropdown-subitem"><a href="/pages/39605b/" class="nav-link">创建Gateway模块</a></li></ul></li><li class="dropdown-item"><h4>微服务通信</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c6a1f4/" class="nav-link">微服务间通信</a></li></ul></li><li class="dropdown-item"><h4>Seata 分布式事务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/d37c45/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Seata分布式事务解决方案</a></li></ul></li><li class="dropdown-item"><h4>微服务容错</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/470cd5/" class="nav-link">Netflix Hystrix实现微服务容错</a></li><li class="dropdown-subitem"><a href="/pages/d37c45/404" class="nav-link">Sentinel微服务容错</a></li></ul></li><li class="dropdown-item"><h4>Sleuth + Zipkin 日志追踪</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/f082ce/" class="nav-link">Sleuth + Zipkin分布式日志追踪</a></li></ul></li><li class="dropdown-item"><h4>授权、鉴权中心微服务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/5c5a46/" class="nav-link">构建授权、鉴权中心微服务</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><!----> <span class="title" style="display:;">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Cloud Alibaba</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/3b393a/" class="nav-link">JVM-1</a></li><li class="dropdown-subitem"><a href="/pages/f50dfc/" class="nav-link">JVM-3</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title" style="display:;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>MySQL</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/cded12/" class="nav-link">基础篇</a></li><li class="dropdown-subitem"><a href="/pages/49bb95/" class="nav-link">高级篇</a></li><li class="dropdown-subitem"><a href="/pages/59225b/" class="nav-link">工具</a></li></ul></li><li class="dropdown-item"><h4>Oracle</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">Oracle知识点</a></li></ul></li><li class="dropdown-item"><h4>Redis</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">Redis知识点</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架|中间件" class="dropdown-title"><!----> <span class="title" style="display:;">框架|中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Framework</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/28e3d0/" class="nav-link">基础1</a></li></ul></li><li class="dropdown-item"><h4>Spring Boot</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">JUC-1</a></li><li class="dropdown-subitem"><a href="/pages/61ba09/" class="nav-link">JUC-2</a></li></ul></li><li class="dropdown-item"><h4>Spring Cloud Alibaba</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/3b393a/" class="nav-link">JVM-1</a></li><li class="dropdown-subitem"><a href="/pages/f50dfc/" class="nav-link">JVM-3</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具|部署" class="dropdown-title"><!----> <span class="title" style="display:;">工具|部署</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Docker</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a793d4/" class="nav-link">软件安装篇</a></li><li class="dropdown-subitem"><a href="/pages/f3f84f/" class="nav-link">服务部署篇</a></li></ul></li><li class="dropdown-item"><h4>Git</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">Git知识点</a></li></ul></li><li class="dropdown-item"><h4>Linux</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/bb176d/" class="nav-link">阿里云</a></li></ul></li><li class="dropdown-item"><h4>Idea</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/7eb19a/" class="nav-link">Idea常用插件Top16</a></li><li class="dropdown-subitem"><a href="/pages/55726e/" class="nav-link">Idea设置软换行</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/pages/891539/" class="nav-link">关于我</a></div> <a href="https://github.com/coder-gm" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/9931eb/" class="nav-link">面向对象</a></li><li class="dropdown-subitem"><a href="/pages/74fec2/" class="nav-link">数据类型</a></li><li class="dropdown-subitem"><a href="/pages/5bde1a/" class="nav-link">变量类型</a></li><li class="dropdown-subitem"><a href="/pages/28535a/" class="nav-link">控制结构</a></li><li class="dropdown-subitem"><a href="/pages/4074f5/" class="nav-link">超类</a></li><li class="dropdown-subitem"><a href="/pages/db85a8/" class="nav-link">Scanner</a></li><li class="dropdown-subitem"><a href="/pages/341e84/" class="nav-link">反射</a></li><li class="dropdown-subitem"><a href="/pages/7ec08c/" class="nav-link">Serializable(序列化)</a></li><li class="dropdown-subitem"><a href="/pages/fbe16d/" class="nav-link">动态代理</a></li><li class="dropdown-subitem"><a href="/pages/78e39b/" class="nav-link">Enum</a></li><li class="dropdown-subitem"><a href="/pages/0d7979/" class="nav-link">IO流</a></li><li class="dropdown-subitem"><a href="/pages/192add/" class="nav-link">Lambda</a></li><li class="dropdown-subitem"><a href="/pages/d2addf/" class="nav-link">Math</a></li><li class="dropdown-subitem"><a href="/pages/0cdbed/" class="nav-link">Random</a></li><li class="dropdown-subitem"><a href="/pages/b722b1/" class="nav-link">UUID</a></li><li class="dropdown-subitem"><a href="/pages/0f7ad8/" class="nav-link">泛型</a></li><li class="dropdown-subitem"><a href="/pages/148cd7/" class="nav-link">网络通信</a></li><li class="dropdown-subitem"><a href="/pages/f46dcf/" class="nav-link">异常和处理</a></li><li class="dropdown-subitem"><a href="/pages/0e008e/" class="nav-link">正则表达式</a></li><li class="dropdown-subitem"><a href="/pages/f42b16/" class="nav-link">Java注解</a></li><li class="dropdown-subitem"><a href="/pages/dac65d/" class="nav-link">JDBC</a></li></ul></li><li class="dropdown-item"><h4>并发与线程</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/394d30/" class="nav-link">并发编程核心概念</a></li><li class="dropdown-subitem"><a href="/pages/61ba09/" class="nav-link">JUC-2</a></li></ul></li><li class="dropdown-item"><h4>JVM相关</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">JUC-1</a></li><li class="dropdown-subitem"><a href="/pages/61ba09/" class="nav-link">JUC-2</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring" class="dropdown-title"><!----> <span class="title" style="display:;">Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Framework</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/28e3d0/" class="nav-link">基础1</a></li></ul></li><li class="dropdown-item"><h4>Spring Boot</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">JUC-1</a></li><li class="dropdown-subitem"><a href="/pages/61ba09/" class="nav-link">JUC-2</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="SpringCloud" class="dropdown-title"><!----> <span class="title" style="display:;">SpringCloud</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Nacos 注册中心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/9f8459/" class="nav-link">Nacos基本架构和概念</a></li><li class="dropdown-subitem"><a href="/pages/5a44e3/" class="nav-link">Nacos服务注册与发现</a></li><li class="dropdown-subitem"><a href="/pages/20ff14/" class="nav-link">Config服务配置中心</a></li><li class="dropdown-subitem"><a href="/pages/f84a0c/" class="nav-link">Nacos安装部署 </a></li></ul></li><li class="dropdown-item"><h4>Gateway 微服务网关</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/e87c7c/" class="nav-link">Gateway核心概念</a></li><li class="dropdown-subitem"><a href="/pages/6b0fb9/" class="nav-link">Gateway路由</a></li><li class="dropdown-subitem"><a href="/pages/1a393f/" class="nav-link">Gateway断言</a></li><li class="dropdown-subitem"><a href="/pages/60ff28/" class="nav-link">Gateway过滤器</a></li><li class="dropdown-subitem"><a href="/pages/8fc690/" class="nav-link">Alibaba问题汇总</a></li><li class="dropdown-subitem"><a href="/pages/39605b/" class="nav-link">创建Gateway模块</a></li></ul></li><li class="dropdown-item"><h4>微服务通信</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c6a1f4/" class="nav-link">微服务间通信</a></li></ul></li><li class="dropdown-item"><h4>Seata 分布式事务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/d37c45/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Seata分布式事务解决方案</a></li></ul></li><li class="dropdown-item"><h4>微服务容错</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/470cd5/" class="nav-link">Netflix Hystrix实现微服务容错</a></li><li class="dropdown-subitem"><a href="/pages/d37c45/404" class="nav-link">Sentinel微服务容错</a></li></ul></li><li class="dropdown-item"><h4>Sleuth + Zipkin 日志追踪</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/f082ce/" class="nav-link">Sleuth + Zipkin分布式日志追踪</a></li></ul></li><li class="dropdown-item"><h4>授权、鉴权中心微服务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/5c5a46/" class="nav-link">构建授权、鉴权中心微服务</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><!----> <span class="title" style="display:;">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Cloud Alibaba</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/3b393a/" class="nav-link">JVM-1</a></li><li class="dropdown-subitem"><a href="/pages/f50dfc/" class="nav-link">JVM-3</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title" style="display:;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>MySQL</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/cded12/" class="nav-link">基础篇</a></li><li class="dropdown-subitem"><a href="/pages/49bb95/" class="nav-link">高级篇</a></li><li class="dropdown-subitem"><a href="/pages/59225b/" class="nav-link">工具</a></li></ul></li><li class="dropdown-item"><h4>Oracle</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">Oracle知识点</a></li></ul></li><li class="dropdown-item"><h4>Redis</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">Redis知识点</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架|中间件" class="dropdown-title"><!----> <span class="title" style="display:;">框架|中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Framework</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/28e3d0/" class="nav-link">基础1</a></li></ul></li><li class="dropdown-item"><h4>Spring Boot</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">JUC-1</a></li><li class="dropdown-subitem"><a href="/pages/61ba09/" class="nav-link">JUC-2</a></li></ul></li><li class="dropdown-item"><h4>Spring Cloud Alibaba</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/3b393a/" class="nav-link">JVM-1</a></li><li class="dropdown-subitem"><a href="/pages/f50dfc/" class="nav-link">JVM-3</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具|部署" class="dropdown-title"><!----> <span class="title" style="display:;">工具|部署</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Docker</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a793d4/" class="nav-link">软件安装篇</a></li><li class="dropdown-subitem"><a href="/pages/f3f84f/" class="nav-link">服务部署篇</a></li></ul></li><li class="dropdown-item"><h4>Git</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">Git知识点</a></li></ul></li><li class="dropdown-item"><h4>Linux</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/bb176d/" class="nav-link">阿里云</a></li></ul></li><li class="dropdown-item"><h4>Idea</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/7eb19a/" class="nav-link">Idea常用插件Top16</a></li><li class="dropdown-subitem"><a href="/pages/55726e/" class="nav-link">Idea设置软换行</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/pages/891539/" class="nav-link">关于我</a></div> <a href="https://github.com/coder-gm" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nacos注册中心</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Gateway微服务网关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>微服务通信</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Seata分布式事务</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/d37c45/" aria-current="page" class="active sidebar-link">Seata分布式事务解决方案</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/d37c45/#搭建单机seata-server" class="sidebar-link">搭建单机Seata Server</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/d37c45/#文件方式存储事务日志" class="sidebar-link">文件方式存储事务日志</a></li><li class="sidebar-sub-header level3"><a href="/pages/d37c45/#数据库方式存储事务日志" class="sidebar-link">数据库方式存储事务日志</a></li><li class="sidebar-sub-header level5"><a href="/pages/d37c45/#步骤1-修改file-conf文件" class="sidebar-link">步骤1：修改file.conf文件</a></li><li class="sidebar-sub-header level5"><a href="/pages/d37c45/#步骤2-创建seata数据表" class="sidebar-link">步骤2：创建seata数据表</a></li><li class="sidebar-sub-header level5"><a href="/pages/d37c45/#步骤3-启动命令" class="sidebar-link">步骤3：启动命令</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/d37c45/#搭建集群seata-server-高可用模式" class="sidebar-link">搭建集群Seata Server（高可用模式）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/d37c45/#步骤1-修改file-conf文件-2" class="sidebar-link">步骤1：修改file.conf文件</a></li><li class="sidebar-sub-header level3"><a href="/pages/d37c45/#步骤2-创建seata数据表-2" class="sidebar-link">步骤2：创建seata数据表</a></li><li class="sidebar-sub-header level3"><a href="/pages/d37c45/#步骤3-修改registry-conf文件" class="sidebar-link">步骤3：修改registry.conf文件</a></li><li class="sidebar-sub-header level3"><a href="/pages/d37c45/#步骤3-启动命令-2" class="sidebar-link">步骤3：启动命令</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/d37c45/#附录-sql脚本" class="sidebar-link">附录：SQL脚本</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>微服务容错</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Sleuth+Zipkin日志追踪</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>授权、鉴权中心微服务</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>SpringCloudAlibaba</span></li><li data-v-06225672><span data-v-06225672>Seata分布式事务</span></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="http://coder-note.cn" target="_blank" title="作者" class="beLink" data-v-06225672>Coder'Gm</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-01-08</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Seata分布式事务解决方案<!----></h1> <div class="page-slot page-slot-top">
  <div class="wwads-cn wwads-horizontal page-ad" data-id="136" style="width:100%;max-height:80px;min-height:auto;"></div>
  <style>
    .page-ad img{
      width:80px!important;
    }
    .wwads-horizontal .wwads-content{
      display: flex;
      align-items: center;
    }
    .wwads-horizontal .wwads-text, .wwads-content .wwads-text{
      line-height:1;
      flex: 1;
      height: 100%;
      display: flex;
      align-items: center;
    }
    .wwads-horizontal .wwads-poweredby, .wwads-vertical .wwads-poweredby{display: none;!important;}
  </style>
  </div> <div class="theme-vdoing-content content__default"><h1 id="第1章-分布式事务理论及解决方案概览"><a href="#第1章-分布式事务理论及解决方案概览" class="header-anchor">#</a> 第1章：分布式事务理论及解决方案概览</h1> <h3 id="什么是分布式事务"><a href="#什么是分布式事务" class="header-anchor">#</a> 什么是分布式事务</h3> <p>分布式事务是来源于微服务的（或类似的场景），服务之间存在着调用，且整个调用链路上存在，多处（分布在不同的微服务上）写数据表的行为，那么，分布式事务就要保证这些操作要么全部成功，要么全部失败</p> <p><img src="/assets/img/image-20211220184947219.cf08030d.png" alt="image-20211220184947219"></p> <h3 id="分布式事务可能追求的一致性条件不同-业务特性"><a href="#分布式事务可能追求的一致性条件不同-业务特性" class="header-anchor">#</a> 分布式事务可能追求的一致性条件不同（业务特性）</h3> <ul><li>**强一致性：**任何一致性读都能读到某个数据的最近一次写的数据（要求最高）</li> <li>**弱一致性：**数据更新后，如果能容忍后续的访问只能访问到部分或者全部访问不到，则是弱一致性（绝大多数的业务场景都不允许）</li> <li>**最终一致性：**不保证在任意时刻数据都是完整的（状态一致），但是，随时间的推移（会有个度量），数据总是会达到一致的状态</li></ul> <h3 id="最常用的分布式事务解决方案"><a href="#最常用的分布式事务解决方案" class="header-anchor">#</a> 最常用的分布式事务解决方案</h3> <h4 id="两阶段提交"><a href="#两阶段提交" class="header-anchor">#</a> 两阶段提交</h4> <p><strong>两阶段指的是分两步提交</strong>：存在一个中央协调器负责协调各个分支事务（<strong>强一致性策略</strong>）</p> <p><img src="/assets/img/image-20211220185803936.f0228b21.png" alt="image-20211220185803936"></p> <p><strong>缺陷：</strong></p> <ol><li>需要引入外部依赖中央协调器，并且会存在单点故障的风险</li> <li>当参与事务者占用公共资源的情况，其中一个占用公共资源，其他事务参与者只能阻塞等待资源释放</li></ol> <h4 id="本地消息表"><a href="#本地消息表" class="header-anchor">#</a> 本地消息表</h4> <p>该方案的核心是将需要分布式处理的任务通过消息日志的方式来异步执行（<strong>最终一致性策略</strong>）</p> <img src="/assets/img/image-20211220190458212.81fdb0e1.png" alt="image-20211220190458212" style="zoom:67%;"> <h1 id="第2章-分布式事物解决方案seata-at-模式解决"><a href="#第2章-分布式事物解决方案seata-at-模式解决" class="header-anchor">#</a> 第2章：分布式事物解决方案Seata AT 模式解决</h1> <h3 id="什么是seata"><a href="#什么是seata" class="header-anchor">#</a> 什么是Seata</h3> <p>Seata是一款开源的分布式解决方案，致力于在微服务架构下提供高性能和简单易用的分布式事物服务，官网：http://seata.io/zh-cn/</p> <h3 id="seata的过程模型"><a href="#seata的过程模型" class="header-anchor">#</a> Seata的过程模型</h3> <img src="/assets/img/image-20211220191555374.d4b22961.png" alt="image-20211220191555374" style="zoom:67%;"> <h3 id="seata的事务模式"><a href="#seata的事务模式" class="header-anchor">#</a> Seata的事务模式</h3> <p><img src="/assets/img/image-20211220191752414.a3f856ac.png" alt="image-20211220191752414"></p> <h3 id="seata-at模式的工作机制"><a href="#seata-at模式的工作机制" class="header-anchor">#</a> Seata AT模式的工作机制</h3> <p>AT对业务代码完全无侵入性，使用非常简单，改造成本低；我们只需要关注自己的业务SQL，Seata会通过分析我们业务SQL，反向生成回滚数据，在成功的时候会删除这些回滚数据，失败的时候会根据回滚数据实现回滚</p> <p><img src="/assets/img/image-20211220192513697.fb68e3c5.png" alt="image-20211220192513697"></p> <p><strong>Seata AT 模式工作示例：</strong></p> <p>两个全局事物tx1和tx2，分别对a表的m字段进行更新操作，m的初始值1000</p> <p><img src="/assets/img/image-20211220192902452.6822a233.png" alt="image-20211220192902452"></p> <p>如果tx1的二阶段全局回滚，则tx1需要重新获取该数据的本地锁，进行反向补偿的更新操作，实现分支的回滚</p> <p><img src="/assets/img/image-20211220193216087.d2cd7b51.png" alt="image-20211220193216087"></p> <h1 id="第3章-seata-server单机与高可用模式搭建"><a href="#第3章-seata-server单机与高可用模式搭建" class="header-anchor">#</a> 第3章：Seata Server单机与高可用模式搭建</h1> <h3 id="下载seata-server"><a href="#下载seata-server" class="header-anchor">#</a> 下载Seata Server</h3> <p>Seata 下载地址（解压即可）：https://seata.io/zh-cn/blog/download.html</p> <p><img src="/assets/img/image-20211220210634286.a81c61c3.png" alt="image-20211220210634286"></p> <h3 id="seata-server-目录结构讲解"><a href="#seata-server-目录结构讲解" class="header-anchor">#</a> Seata Server 目录结构讲解</h3> <p><img src="/assets/img/image-20211220210924304.2816c790.png" alt="image-20211220210924304"></p> <ul><li>seata-server.bat：是windows下启动的文件</li> <li>seata-server.sh：是mac和linux下启动的文件</li> <li>file.conf：指定数据存储的配置文件，事务日志相关的数据（Seata支持以文件，DB，Redis的数据格式）</li> <li>registry.conf：指定注册中心/配置中心的配置文件 （Seata支持的注册模式：文件，Naocs，易沃克，Redis等等）</li></ul> <h2 id="搭建单机seata-server"><a href="#搭建单机seata-server" class="header-anchor">#</a> 搭建单机Seata Server</h2> <h3 id="文件方式存储事务日志"><a href="#文件方式存储事务日志" class="header-anchor">#</a> 文件方式存储事务日志</h3> <p>使用默认配置搭建单机Seata Server （默认文件存储事务日志），文件方式不足点涉及到的IO是非常大的，集群的时候，文件不能在多个服务器间共享</p> <p>启动命令：</p> <div class="language-bat line-numbers-mode"><pre class="language-text"><code>nohup bin/seata-server.sh -h 127.0.0.1 -p 8091 -m file &amp;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>-h：指定在注册中心注册的IP；不指定时获取当前的IP，外部访问部署在云环境和容器中的server建议指定</p> <p>-p：端口号；默认端口号是8091</p> <p>-m：事务日志存储方式，支持file、db、redis，默认为file</p> <p><img src="/assets/img/image-20211220212424478.488bb7ba.png" alt="image-20211220212424478"></p> <h3 id="数据库方式存储事务日志"><a href="#数据库方式存储事务日志" class="header-anchor">#</a> 数据库方式存储事务日志</h3> <h5 id="步骤1-修改file-conf文件"><a href="#步骤1-修改file-conf文件" class="header-anchor">#</a> 步骤1：修改file.conf文件</h5> <p><img src="/assets/img/image-20211220220436411.536d307c.png" alt="image-20211220220436411"></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>## transaction log store<span class="token punctuation">,</span> only used in seata-server
store <span class="token punctuation">{</span>
  ## store mode<span class="token operator">:</span> file、db、redis
  mode = <span class="token string">&quot;db&quot;</span>
  ## rsa decryption public key
  publicKey = <span class="token string">&quot;&quot;</span>
  ## file store property
  file <span class="token punctuation">{</span>
    ## store location dir
    dir = <span class="token string">&quot;sessionStore&quot;</span>
    # branch session size <span class="token punctuation">,</span> if exceeded first try compress lockkey<span class="token punctuation">,</span> still exceeded throws exceptions
    maxBranchSessionSize = <span class="token number">16384</span>
    # globe session size <span class="token punctuation">,</span> if exceeded throws exceptions
    maxGlobalSessionSize = <span class="token number">512</span>
    # file buffer size <span class="token punctuation">,</span> if exceeded allocate new buffer
    fileWriteBufferCacheSize = <span class="token number">16384</span>
    # when recover batch read size
    sessionReloadReadSize = <span class="token number">100</span>
    # async<span class="token punctuation">,</span> sync
    flushDiskMode = async
  <span class="token punctuation">}</span>

  ## database store property
  db <span class="token punctuation">{</span>
    ## the implement of javax.sql.DataSource<span class="token punctuation">,</span> such as DruidDataSource(druid)/BasicDataSource(dbcp)/HikariDataSource(hikari) etc.
    datasource = <span class="token string">&quot;druid&quot;</span>
    ## mysql/oracle/postgresql/h2/oceanbase etc.
    dbType = <span class="token string">&quot;mysql&quot;</span>
    driverClassName = <span class="token string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>
    ## if using mysql to store the data<span class="token punctuation">,</span> recommend add rewriteBatchedStatements=<span class="token boolean">true</span> in jdbc connection param
    url = <span class="token string">&quot;jdbc:mysql://127.0.0.1:3306/seata?rewriteBatchedStatements=true&amp;useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf8&amp;allowMultiQueries=true&amp;serverTimezone=GMT%2B8&quot;</span>
    user = <span class="token string">&quot;root&quot;</span>
    password = <span class="token string">&quot;Gm859230&quot;</span>
    minConn = <span class="token number">5</span>
    maxConn = <span class="token number">100</span>
	##存储全局锁的表
    globalTable = <span class="token string">&quot;global_table&quot;</span>
	##存储本地分支的事务信息
    branchTable = <span class="token string">&quot;branch_table&quot;</span>
	##存储全局锁和本地锁的事务信息
    lockTable = <span class="token string">&quot;lock_table&quot;</span>
    queryLimit = <span class="token number">100</span>
    maxWait = <span class="token number">5000</span>
  <span class="token punctuation">}</span>

  ## redis store property
  redis <span class="token punctuation">{</span>
    ## redis mode<span class="token operator">:</span> single、sentinel
    mode = <span class="token string">&quot;single&quot;</span>
    ## single mode property
    single <span class="token punctuation">{</span>
      host = <span class="token string">&quot;127.0.0.1&quot;</span>
      port = <span class="token string">&quot;6379&quot;</span>
    <span class="token punctuation">}</span>
    ## sentinel mode property
    sentinel <span class="token punctuation">{</span>
      masterName = <span class="token string">&quot;&quot;</span>
      ## such as <span class="token string">&quot;10.28.235.65:26379,10.28.235.65:26380,10.28.235.65:26381&quot;</span>
      sentinelHosts = <span class="token string">&quot;&quot;</span>
    <span class="token punctuation">}</span>
    password = <span class="token string">&quot;&quot;</span>
    database = <span class="token string">&quot;0&quot;</span>
    minConn = <span class="token number">1</span>
    maxConn = <span class="token number">10</span>
    maxTotal = <span class="token number">100</span>
    queryLimit = <span class="token number">100</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br></div></div><h5 id="步骤2-创建seata数据表"><a href="#步骤2-创建seata数据表" class="header-anchor">#</a> 步骤2：创建seata数据表</h5> <p><img src="data:image/png;base64,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" alt="image-20211220220518809"></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- the table to store GlobalSession data</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>global_table<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>global_table<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span> <span class="token keyword">TINYINT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>application_id<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>transaction_service_group<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>transaction_name<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>timeout<span class="token punctuation">`</span></span> <span class="token keyword">INT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>begin_time<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>application_data<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span> <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span> <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_gmt_modified_status<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_transaction_id<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">-- the table to store BranchSession data</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>branch_table<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>branch_table<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>resource_group_id<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>resource_id<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>lock_key<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>branch_type<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span> <span class="token keyword">TINYINT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>client_id<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>application_data<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span> <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span> <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_xid<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">-- the table to store lock data</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>lock_table<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>lock_table<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>row_key<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">96</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span> LONG <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span> LONG<span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>resource_id<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>pk<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span> <span class="token keyword">DATETIME</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span> <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>row_key<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><h5 id="步骤3-启动命令"><a href="#步骤3-启动命令" class="header-anchor">#</a> 步骤3：启动命令</h5> <div class="language-bat line-numbers-mode"><pre class="language-text"><code>nohup bin/seata-server.sh -h 127.0.0.1 -p 8091 -m db -n 1 &amp;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>-h：指定在注册中心注册的IP；不指定时获取当前的IP，外部访问部署在云环境和容器中的server建议指定</p> <p>-p：端口号；默认端口号是8091</p> <p>-m：事务日志存储方式，支持file、db、redis，默认为file</p> <p>-n：用于指定sata-server节点ID；如 1、2、3....;默认为1</p> <p><strong>注意：需要在MySQL中创建库和表</strong></p> <h2 id="搭建集群seata-server-高可用模式"><a href="#搭建集群seata-server-高可用模式" class="header-anchor">#</a> 搭建集群Seata Server（高可用模式）</h2> <p>高可用模式除了存储方式使用DB之外，还需要注册到注册中心</p> <h3 id="步骤1-修改file-conf文件-2"><a href="#步骤1-修改file-conf文件-2" class="header-anchor">#</a> 步骤1：修改file.conf文件</h3> <p><img src="/assets/img/image-20211220220436411.536d307c.png" alt="image-20211220220436411"></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>## transaction log store<span class="token punctuation">,</span> only used in seata-server
store <span class="token punctuation">{</span>
  ## store mode<span class="token operator">:</span> file、db、redis
  mode = <span class="token string">&quot;db&quot;</span>
  ## rsa decryption public key
  publicKey = <span class="token string">&quot;&quot;</span>
  ## file store property
  file <span class="token punctuation">{</span>
    ## store location dir
    dir = <span class="token string">&quot;sessionStore&quot;</span>
    # branch session size <span class="token punctuation">,</span> if exceeded first try compress lockkey<span class="token punctuation">,</span> still exceeded throws exceptions
    maxBranchSessionSize = <span class="token number">16384</span>
    # globe session size <span class="token punctuation">,</span> if exceeded throws exceptions
    maxGlobalSessionSize = <span class="token number">512</span>
    # file buffer size <span class="token punctuation">,</span> if exceeded allocate new buffer
    fileWriteBufferCacheSize = <span class="token number">16384</span>
    # when recover batch read size
    sessionReloadReadSize = <span class="token number">100</span>
    # async<span class="token punctuation">,</span> sync
    flushDiskMode = async
  <span class="token punctuation">}</span>

  ## database store property
  db <span class="token punctuation">{</span>
    ## the implement of javax.sql.DataSource<span class="token punctuation">,</span> such as DruidDataSource(druid)/BasicDataSource(dbcp)/HikariDataSource(hikari) etc.
    datasource = <span class="token string">&quot;druid&quot;</span>
    ## mysql/oracle/postgresql/h2/oceanbase etc.
    dbType = <span class="token string">&quot;mysql&quot;</span>
    driverClassName = <span class="token string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>
    ## if using mysql to store the data<span class="token punctuation">,</span> recommend add rewriteBatchedStatements=<span class="token boolean">true</span> in jdbc connection param
    url = <span class="token string">&quot;jdbc:mysql://127.0.0.1:3306/seata?rewriteBatchedStatements=true&amp;useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf8&amp;allowMultiQueries=true&amp;serverTimezone=GMT%2B8&quot;</span>
    user = <span class="token string">&quot;root&quot;</span>
    password = <span class="token string">&quot;Gm859230&quot;</span>
    minConn = <span class="token number">5</span>
    maxConn = <span class="token number">100</span>
	##存储全局锁的表
    globalTable = <span class="token string">&quot;global_table&quot;</span>
	##存储本地分支的事务信息
    branchTable = <span class="token string">&quot;branch_table&quot;</span>
	##存储全局锁和本地锁的事务信息
    lockTable = <span class="token string">&quot;lock_table&quot;</span>
    queryLimit = <span class="token number">100</span>
    maxWait = <span class="token number">5000</span>
  <span class="token punctuation">}</span>

  ## redis store property
  redis <span class="token punctuation">{</span>
    ## redis mode<span class="token operator">:</span> single、sentinel
    mode = <span class="token string">&quot;single&quot;</span>
    ## single mode property
    single <span class="token punctuation">{</span>
      host = <span class="token string">&quot;127.0.0.1&quot;</span>
      port = <span class="token string">&quot;6379&quot;</span>
    <span class="token punctuation">}</span>
    ## sentinel mode property
    sentinel <span class="token punctuation">{</span>
      masterName = <span class="token string">&quot;&quot;</span>
      ## such as <span class="token string">&quot;10.28.235.65:26379,10.28.235.65:26380,10.28.235.65:26381&quot;</span>
      sentinelHosts = <span class="token string">&quot;&quot;</span>
    <span class="token punctuation">}</span>
    password = <span class="token string">&quot;&quot;</span>
    database = <span class="token string">&quot;0&quot;</span>
    minConn = <span class="token number">1</span>
    maxConn = <span class="token number">10</span>
    maxTotal = <span class="token number">100</span>
    queryLimit = <span class="token number">100</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br></div></div><h3 id="步骤2-创建seata数据表-2"><a href="#步骤2-创建seata数据表-2" class="header-anchor">#</a> 步骤2：创建seata数据表</h3> <p><img src="data:image/png;base64,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" alt="image-20211220220518809"></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- the table to store GlobalSession data</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>global_table<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>global_table<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span> <span class="token keyword">TINYINT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>application_id<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>transaction_service_group<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>transaction_name<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>timeout<span class="token punctuation">`</span></span> <span class="token keyword">INT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>begin_time<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>application_data<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span> <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span> <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_gmt_modified_status<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_transaction_id<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">-- the table to store BranchSession data</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>branch_table<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>branch_table<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>resource_group_id<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>resource_id<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>lock_key<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>branch_type<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span> <span class="token keyword">TINYINT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>client_id<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>application_data<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span> <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span> <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_xid<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">-- the table to store lock data</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>lock_table<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>lock_table<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>row_key<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">96</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span> LONG <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span> LONG<span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>resource_id<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>pk<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span> <span class="token keyword">DATETIME</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span> <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>row_key<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><h3 id="步骤3-修改registry-conf文件"><a href="#步骤3-修改registry-conf文件" class="header-anchor">#</a> 步骤3：修改registry.conf文件</h3> <p><img src="/assets/img/image-20211220231402468.955e3ada.png" alt="image-20211220231402468"></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>registry <span class="token punctuation">{</span>
  # file 、nacos 、eureka、redis、zk、consul、etcd3、sofa
  type = <span class="token string">&quot;nacos&quot;</span>

  nacos <span class="token punctuation">{</span>
    application = <span class="token string">&quot;seata-server&quot;</span>
    serverAddr = <span class="token string">&quot;47.103.64.174:8848,47.103.64.174:8848&quot;</span>
    group = <span class="token string">&quot;SEATA_GROUP&quot;</span>
    namespace = <span class="token string">&quot;53dc28d0-21c8-46fd-be52-b206940b7f0d&quot;</span>
    cluster = <span class="token string">&quot;default&quot;</span>
    username = <span class="token string">&quot;&quot;</span>
    password = <span class="token string">&quot;&quot;</span>
  <span class="token punctuation">}</span>
  eureka <span class="token punctuation">{</span>
    serviceUrl = <span class="token string">&quot;http://localhost:8761/eureka&quot;</span>
    application = <span class="token string">&quot;default&quot;</span>
    weight = <span class="token string">&quot;1&quot;</span>
  <span class="token punctuation">}</span>
  redis <span class="token punctuation">{</span>
    serverAddr = <span class="token string">&quot;localhost:6379&quot;</span>
    db = <span class="token number">0</span>
    password = <span class="token string">&quot;&quot;</span>
    cluster = <span class="token string">&quot;default&quot;</span>
    timeout = <span class="token number">0</span>
  <span class="token punctuation">}</span>
  zk <span class="token punctuation">{</span>
    cluster = <span class="token string">&quot;default&quot;</span>
    serverAddr = <span class="token string">&quot;127.0.0.1:2181&quot;</span>
    sessionTimeout = <span class="token number">6000</span>
    connectTimeout = <span class="token number">2000</span>
    username = <span class="token string">&quot;&quot;</span>
    password = <span class="token string">&quot;&quot;</span>
  <span class="token punctuation">}</span>
  consul <span class="token punctuation">{</span>
    cluster = <span class="token string">&quot;default&quot;</span>
    serverAddr = <span class="token string">&quot;127.0.0.1:8500&quot;</span>
    aclToken = <span class="token string">&quot;&quot;</span>
  <span class="token punctuation">}</span>
  etcd3 <span class="token punctuation">{</span>
    cluster = <span class="token string">&quot;default&quot;</span>
    serverAddr = <span class="token string">&quot;http://localhost:2379&quot;</span>
  <span class="token punctuation">}</span>
  sofa <span class="token punctuation">{</span>
    serverAddr = <span class="token string">&quot;127.0.0.1:9603&quot;</span>
    application = <span class="token string">&quot;default&quot;</span>
    region = <span class="token string">&quot;DEFAULT_ZONE&quot;</span>
    datacenter = <span class="token string">&quot;DefaultDataCenter&quot;</span>
    cluster = <span class="token string">&quot;default&quot;</span>
    group = <span class="token string">&quot;SEATA_GROUP&quot;</span>
    addressWaitTime = <span class="token string">&quot;3000&quot;</span>
  <span class="token punctuation">}</span>
  file <span class="token punctuation">{</span>
    name = <span class="token string">&quot;file.conf&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

config <span class="token punctuation">{</span>
  # file、nacos 、apollo、zk、consul、etcd3
  type = <span class="token string">&quot;file&quot;</span>

  nacos <span class="token punctuation">{</span>
    serverAddr = <span class="token string">&quot;127.0.0.1:8848&quot;</span>
    namespace = <span class="token string">&quot;&quot;</span>
    group = <span class="token string">&quot;SEATA_GROUP&quot;</span>
    username = <span class="token string">&quot;&quot;</span>
    password = <span class="token string">&quot;&quot;</span>
    dataId = <span class="token string">&quot;seataServer.properties&quot;</span>
  <span class="token punctuation">}</span>
  consul <span class="token punctuation">{</span>
    serverAddr = <span class="token string">&quot;127.0.0.1:8500&quot;</span>
    aclToken = <span class="token string">&quot;&quot;</span>
  <span class="token punctuation">}</span>
  apollo <span class="token punctuation">{</span>
    appId = <span class="token string">&quot;seata-server&quot;</span>
    ## apolloConfigService will cover apolloMeta
    apolloMeta = <span class="token string">&quot;http://192.168.1.204:8801&quot;</span>
    apolloConfigService = <span class="token string">&quot;http://192.168.1.204:8080&quot;</span>
    namespace = <span class="token string">&quot;application&quot;</span>
    apolloAccesskeySecret = <span class="token string">&quot;&quot;</span>
    cluster = <span class="token string">&quot;seata&quot;</span>
  <span class="token punctuation">}</span>
  zk <span class="token punctuation">{</span>
    serverAddr = <span class="token string">&quot;127.0.0.1:2181&quot;</span>
    sessionTimeout = <span class="token number">6000</span>
    connectTimeout = <span class="token number">2000</span>
    username = <span class="token string">&quot;&quot;</span>
    password = <span class="token string">&quot;&quot;</span>
    nodePath = <span class="token string">&quot;/seata/seata.properties&quot;</span>
  <span class="token punctuation">}</span>
  etcd3 <span class="token punctuation">{</span>
    serverAddr = <span class="token string">&quot;http://localhost:2379&quot;</span>
  <span class="token punctuation">}</span>
  file <span class="token punctuation">{</span>
    name = <span class="token string">&quot;file.conf&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br></div></div><h3 id="步骤3-启动命令-2"><a href="#步骤3-启动命令-2" class="header-anchor">#</a> 步骤3：启动命令</h3> <div class="language-bat line-numbers-mode"><pre class="language-text"><code>nohup bin/seata-server.sh -h 127.0.0.1 -p 8091 -m db -n 1 &amp;
nohup bin/seata-server.sh -h 127.0.0.1 -p 8092 -m db -n 2 &amp;
nohup bin/seata-server.sh -h 127.0.0.1 -p 8093 -m db -n 3 &amp;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="/assets/img/image-20211220231308953.5a673897.png" alt="image-20211220231308953"></p> <h2 id="附录-sql脚本"><a href="#附录-sql脚本" class="header-anchor">#</a> 附录：SQL脚本</h2> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- -------------------------------- The script used when storeMode is 'db' --------------------------------</span>
<span class="token comment">-- the table to store GlobalSession data</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>global_table<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span>                       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span>            <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span>                    <span class="token keyword">TINYINT</span>      <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>application_id<span class="token punctuation">`</span></span>            <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_service_group<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_name<span class="token punctuation">`</span></span>          <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>timeout<span class="token punctuation">`</span></span>                   <span class="token keyword">INT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>begin_time<span class="token punctuation">`</span></span>                <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>application_data<span class="token punctuation">`</span></span>          <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span>                <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span>              <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_gmt_modified_status<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_transaction_id<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span>
  <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8<span class="token punctuation">;</span>

<span class="token comment">-- the table to store BranchSession data</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>branch_table<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span>         <span class="token keyword">BIGINT</span>       <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span>               <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span>    <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>resource_group_id<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>resource_id<span class="token punctuation">`</span></span>       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>branch_type<span class="token punctuation">`</span></span>       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span>            <span class="token keyword">TINYINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>client_id<span class="token punctuation">`</span></span>         <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>application_data<span class="token punctuation">`</span></span>  <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span>        <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span>      <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_xid<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span>
  <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8<span class="token punctuation">;</span>

<span class="token comment">-- the table to store lock data</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>lock_table<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>row_key<span class="token punctuation">`</span></span>        <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span>            <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">96</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span>      <span class="token keyword">BIGINT</span>       <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>resource_id<span class="token punctuation">`</span></span>    <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span>     <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>pk<span class="token punctuation">`</span></span>             <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span>     <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span>   <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>row_key<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_branch_id<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span>
  <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8<span class="token punctuation">;</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div></div></div>  <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/06/04, 18:24:43</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/c6a1f4/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">微服务间通信</div></a> <a href="/pages/470cd5/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Netflix Hystrix 实现微服务容错</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/c6a1f4/" class="prev">微服务间通信</a></span> <span class="next"><a href="/pages/470cd5/">Netflix Hystrix 实现微服务容错</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:zgming@aliyun.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/coder-gm" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2017-2022
    <span>苏ICP备2022003313号-1</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.44e0923e.js" defer></script><script src="/assets/js/2.4a42c91c.js" defer></script><script src="/assets/js/5.51cab261.js" defer></script>
  </body>
</html>
