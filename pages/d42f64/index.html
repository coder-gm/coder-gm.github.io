<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>日志与备份篇 | Coder&#39;Gm 博客</title>
    <meta name="generator" content="VuePress 1.9.2">
    <link rel="icon" href="/img/icon/note2.png">
    <meta name="description" content="当你的能力支撑不了你的野心的时候，该努力了！！">
    <meta name="keywords" content="Java 全栈知识体系, java体系, java知识体系, java框架,java详解,java学习路线,java spring, java面试, 知识体系, java技术体系, java编程, java编程指南,java开发体系, java开发,java教程,java,java数据结构, 算法, 开发基础">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.a214389c.css" as="style"><link rel="preload" href="/assets/js/app.44e0923e.js" as="script"><link rel="preload" href="/assets/js/2.4a42c91c.js" as="script"><link rel="preload" href="/assets/js/93.b5aecfec.js" as="script"><link rel="prefetch" href="/assets/js/10.6658714f.js"><link rel="prefetch" href="/assets/js/100.fe3f39f7.js"><link rel="prefetch" href="/assets/js/101.d5ed3265.js"><link rel="prefetch" href="/assets/js/102.e768d81f.js"><link rel="prefetch" href="/assets/js/103.5535decf.js"><link rel="prefetch" href="/assets/js/11.856f3e3b.js"><link rel="prefetch" href="/assets/js/12.113736c0.js"><link rel="prefetch" href="/assets/js/13.9c439c56.js"><link rel="prefetch" href="/assets/js/14.394ab678.js"><link rel="prefetch" href="/assets/js/15.42d5a0c1.js"><link rel="prefetch" href="/assets/js/16.70d9bc18.js"><link rel="prefetch" href="/assets/js/17.ee4dc88a.js"><link rel="prefetch" href="/assets/js/18.e895a1b3.js"><link rel="prefetch" href="/assets/js/19.bc852c28.js"><link rel="prefetch" href="/assets/js/20.ba3e82a7.js"><link rel="prefetch" href="/assets/js/21.62e9db3b.js"><link rel="prefetch" href="/assets/js/22.cf165019.js"><link rel="prefetch" href="/assets/js/23.1bb9d2ab.js"><link rel="prefetch" href="/assets/js/24.69003ae4.js"><link rel="prefetch" href="/assets/js/25.5ac5fe93.js"><link rel="prefetch" href="/assets/js/26.054194a4.js"><link rel="prefetch" href="/assets/js/27.b411ecdb.js"><link rel="prefetch" href="/assets/js/28.147c4123.js"><link rel="prefetch" href="/assets/js/29.6104efa6.js"><link rel="prefetch" href="/assets/js/3.100b0cf3.js"><link rel="prefetch" href="/assets/js/30.197cf614.js"><link rel="prefetch" href="/assets/js/31.c11c4e4b.js"><link rel="prefetch" href="/assets/js/32.5a90f912.js"><link rel="prefetch" href="/assets/js/33.e3239d33.js"><link rel="prefetch" href="/assets/js/34.e5d60e2a.js"><link rel="prefetch" href="/assets/js/35.ac3a35fa.js"><link rel="prefetch" href="/assets/js/36.88afe5ff.js"><link rel="prefetch" href="/assets/js/37.e6d77bda.js"><link rel="prefetch" href="/assets/js/38.860aa95b.js"><link rel="prefetch" href="/assets/js/39.ff782303.js"><link rel="prefetch" href="/assets/js/4.76e5fb0d.js"><link rel="prefetch" href="/assets/js/40.b0965bf4.js"><link rel="prefetch" href="/assets/js/41.f3fc54f3.js"><link rel="prefetch" href="/assets/js/42.c0751c0f.js"><link rel="prefetch" href="/assets/js/43.8bf64311.js"><link rel="prefetch" href="/assets/js/44.6754651c.js"><link rel="prefetch" href="/assets/js/45.b16895ec.js"><link rel="prefetch" href="/assets/js/46.7226b679.js"><link rel="prefetch" href="/assets/js/47.bc142da5.js"><link rel="prefetch" href="/assets/js/48.32b41242.js"><link rel="prefetch" href="/assets/js/49.292eb956.js"><link rel="prefetch" href="/assets/js/5.51cab261.js"><link rel="prefetch" href="/assets/js/50.079daeec.js"><link rel="prefetch" href="/assets/js/51.d8fb6190.js"><link rel="prefetch" href="/assets/js/52.f1a80eb0.js"><link rel="prefetch" href="/assets/js/53.bfc87ec7.js"><link rel="prefetch" href="/assets/js/54.0d5b8f7b.js"><link rel="prefetch" href="/assets/js/55.031bdd5c.js"><link rel="prefetch" href="/assets/js/56.51a9f261.js"><link rel="prefetch" href="/assets/js/57.7badb0db.js"><link rel="prefetch" href="/assets/js/58.11e7c84b.js"><link rel="prefetch" href="/assets/js/59.09ea85f8.js"><link rel="prefetch" href="/assets/js/6.1217ecf0.js"><link rel="prefetch" href="/assets/js/60.f49dff36.js"><link rel="prefetch" href="/assets/js/61.fc20fc9d.js"><link rel="prefetch" href="/assets/js/62.733e3477.js"><link rel="prefetch" href="/assets/js/63.4bfe99a2.js"><link rel="prefetch" href="/assets/js/64.8227fa59.js"><link rel="prefetch" href="/assets/js/65.9338d8cf.js"><link rel="prefetch" href="/assets/js/66.35d63c81.js"><link rel="prefetch" href="/assets/js/67.0224d223.js"><link rel="prefetch" href="/assets/js/68.bee1f22f.js"><link rel="prefetch" href="/assets/js/69.08704d94.js"><link rel="prefetch" href="/assets/js/7.dc50503c.js"><link rel="prefetch" href="/assets/js/70.3b5276a1.js"><link rel="prefetch" href="/assets/js/71.7d766a0b.js"><link rel="prefetch" href="/assets/js/72.f66ed860.js"><link rel="prefetch" href="/assets/js/73.a0002ad9.js"><link rel="prefetch" href="/assets/js/74.c0599b56.js"><link rel="prefetch" href="/assets/js/75.1ca91be9.js"><link rel="prefetch" href="/assets/js/76.17f9d853.js"><link rel="prefetch" href="/assets/js/77.e563741a.js"><link rel="prefetch" href="/assets/js/78.5cb837e1.js"><link rel="prefetch" href="/assets/js/79.599ee9fe.js"><link rel="prefetch" href="/assets/js/8.7e968594.js"><link rel="prefetch" href="/assets/js/80.614e5db3.js"><link rel="prefetch" href="/assets/js/81.256c8bba.js"><link rel="prefetch" href="/assets/js/82.bc28a824.js"><link rel="prefetch" href="/assets/js/83.31f9acee.js"><link rel="prefetch" href="/assets/js/84.65af7ccd.js"><link rel="prefetch" href="/assets/js/85.5f8c614f.js"><link rel="prefetch" href="/assets/js/86.02957e14.js"><link rel="prefetch" href="/assets/js/87.69e40dad.js"><link rel="prefetch" href="/assets/js/88.6b53f094.js"><link rel="prefetch" href="/assets/js/89.d79d52f3.js"><link rel="prefetch" href="/assets/js/9.67eaa601.js"><link rel="prefetch" href="/assets/js/90.ec563f30.js"><link rel="prefetch" href="/assets/js/91.af3f3b1c.js"><link rel="prefetch" href="/assets/js/92.a38cb0ed.js"><link rel="prefetch" href="/assets/js/94.ef55686b.js"><link rel="prefetch" href="/assets/js/95.e294b0e5.js"><link rel="prefetch" href="/assets/js/96.6cc86402.js"><link rel="prefetch" href="/assets/js/97.2ddc667e.js"><link rel="prefetch" href="/assets/js/98.b8cf46f9.js"><link rel="prefetch" href="/assets/js/99.aab7dc10.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a214389c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/icon/note2.png" alt="Coder'Gm 博客" class="logo"> <span class="site-name can-hide">Coder'Gm 博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/9931eb/" class="nav-link">面向对象</a></li><li class="dropdown-subitem"><a href="/pages/74fec2/" class="nav-link">数据类型</a></li><li class="dropdown-subitem"><a href="/pages/5bde1a/" class="nav-link">变量类型</a></li><li class="dropdown-subitem"><a href="/pages/28535a/" class="nav-link">控制结构</a></li><li class="dropdown-subitem"><a href="/pages/4074f5/" class="nav-link">超类</a></li><li class="dropdown-subitem"><a href="/pages/db85a8/" class="nav-link">Scanner</a></li><li class="dropdown-subitem"><a href="/pages/341e84/" class="nav-link">反射</a></li><li class="dropdown-subitem"><a href="/pages/7ec08c/" class="nav-link">Serializable(序列化)</a></li><li class="dropdown-subitem"><a href="/pages/fbe16d/" class="nav-link">动态代理</a></li><li class="dropdown-subitem"><a href="/pages/78e39b/" class="nav-link">Enum</a></li><li class="dropdown-subitem"><a href="/pages/0d7979/" class="nav-link">IO流</a></li><li class="dropdown-subitem"><a href="/pages/192add/" class="nav-link">Lambda</a></li><li class="dropdown-subitem"><a href="/pages/d2addf/" class="nav-link">Math</a></li><li class="dropdown-subitem"><a href="/pages/0cdbed/" class="nav-link">Random</a></li><li class="dropdown-subitem"><a href="/pages/b722b1/" class="nav-link">UUID</a></li><li class="dropdown-subitem"><a href="/pages/0f7ad8/" class="nav-link">泛型</a></li><li class="dropdown-subitem"><a href="/pages/148cd7/" class="nav-link">网络通信</a></li><li class="dropdown-subitem"><a href="/pages/f46dcf/" class="nav-link">异常和处理</a></li><li class="dropdown-subitem"><a href="/pages/0e008e/" class="nav-link">正则表达式</a></li><li class="dropdown-subitem"><a href="/pages/f42b16/" class="nav-link">Java注解</a></li><li class="dropdown-subitem"><a href="/pages/dac65d/" class="nav-link">JDBC</a></li></ul></li><li class="dropdown-item"><h4>并发与线程</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/394d30/" class="nav-link">并发编程核心概念</a></li><li class="dropdown-subitem"><a href="/pages/61ba09/" class="nav-link">JUC-2</a></li></ul></li><li class="dropdown-item"><h4>JVM相关</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">JUC-1</a></li><li class="dropdown-subitem"><a href="/pages/61ba09/" class="nav-link">JUC-2</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring" class="dropdown-title"><!----> <span class="title" style="display:;">Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Framework</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/28e3d0/" class="nav-link">基础1</a></li></ul></li><li class="dropdown-item"><h4>Spring Boot</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">JUC-1</a></li><li class="dropdown-subitem"><a href="/pages/61ba09/" class="nav-link">JUC-2</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="SpringCloud" class="dropdown-title"><!----> <span class="title" style="display:;">SpringCloud</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Nacos 注册中心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/9f8459/" class="nav-link">Nacos基本架构和概念</a></li><li class="dropdown-subitem"><a href="/pages/5a44e3/" class="nav-link">Nacos服务注册与发现</a></li><li class="dropdown-subitem"><a href="/pages/20ff14/" class="nav-link">Config服务配置中心</a></li><li class="dropdown-subitem"><a href="/pages/f84a0c/" class="nav-link">Nacos安装部署 </a></li></ul></li><li class="dropdown-item"><h4>Gateway 微服务网关</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/e87c7c/" class="nav-link">Gateway核心概念</a></li><li class="dropdown-subitem"><a href="/pages/6b0fb9/" class="nav-link">Gateway路由</a></li><li class="dropdown-subitem"><a href="/pages/1a393f/" class="nav-link">Gateway断言</a></li><li class="dropdown-subitem"><a href="/pages/60ff28/" class="nav-link">Gateway过滤器</a></li><li class="dropdown-subitem"><a href="/pages/8fc690/" class="nav-link">Alibaba问题汇总</a></li><li class="dropdown-subitem"><a href="/pages/39605b/" class="nav-link">创建Gateway模块</a></li></ul></li><li class="dropdown-item"><h4>微服务通信</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c6a1f4/" class="nav-link">微服务间通信</a></li></ul></li><li class="dropdown-item"><h4>Seata 分布式事务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/d37c45/" class="nav-link">Seata分布式事务解决方案</a></li></ul></li><li class="dropdown-item"><h4>微服务容错</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/470cd5/" class="nav-link">Netflix Hystrix实现微服务容错</a></li><li class="dropdown-subitem"><a href="/pages/d42f64/404" class="nav-link">Sentinel微服务容错</a></li></ul></li><li class="dropdown-item"><h4>Sleuth + Zipkin 日志追踪</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/f082ce/" class="nav-link">Sleuth + Zipkin分布式日志追踪</a></li></ul></li><li class="dropdown-item"><h4>授权、鉴权中心微服务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/5c5a46/" class="nav-link">构建授权、鉴权中心微服务</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><!----> <span class="title" style="display:;">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Cloud Alibaba</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/3b393a/" class="nav-link">JVM-1</a></li><li class="dropdown-subitem"><a href="/pages/f50dfc/" class="nav-link">JVM-3</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title" style="display:;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>MySQL</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/cded12/" class="nav-link">基础篇</a></li><li class="dropdown-subitem"><a href="/pages/49bb95/" class="nav-link">高级篇</a></li><li class="dropdown-subitem"><a href="/pages/59225b/" class="nav-link">工具</a></li></ul></li><li class="dropdown-item"><h4>Oracle</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">Oracle知识点</a></li></ul></li><li class="dropdown-item"><h4>Redis</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">Redis知识点</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架|中间件" class="dropdown-title"><!----> <span class="title" style="display:;">框架|中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Framework</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/28e3d0/" class="nav-link">基础1</a></li></ul></li><li class="dropdown-item"><h4>Spring Boot</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">JUC-1</a></li><li class="dropdown-subitem"><a href="/pages/61ba09/" class="nav-link">JUC-2</a></li></ul></li><li class="dropdown-item"><h4>Spring Cloud Alibaba</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/3b393a/" class="nav-link">JVM-1</a></li><li class="dropdown-subitem"><a href="/pages/f50dfc/" class="nav-link">JVM-3</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具|部署" class="dropdown-title"><!----> <span class="title" style="display:;">工具|部署</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Docker</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a793d4/" class="nav-link">软件安装篇</a></li><li class="dropdown-subitem"><a href="/pages/f3f84f/" class="nav-link">服务部署篇</a></li></ul></li><li class="dropdown-item"><h4>Git</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">Git知识点</a></li></ul></li><li class="dropdown-item"><h4>Linux</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/bb176d/" class="nav-link">阿里云</a></li></ul></li><li class="dropdown-item"><h4>Idea</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/7eb19a/" class="nav-link">Idea常用插件Top16</a></li><li class="dropdown-subitem"><a href="/pages/55726e/" class="nav-link">Idea设置软换行</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/pages/891539/" class="nav-link">关于我</a></div> <a href="https://github.com/coder-gm" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/9931eb/" class="nav-link">面向对象</a></li><li class="dropdown-subitem"><a href="/pages/74fec2/" class="nav-link">数据类型</a></li><li class="dropdown-subitem"><a href="/pages/5bde1a/" class="nav-link">变量类型</a></li><li class="dropdown-subitem"><a href="/pages/28535a/" class="nav-link">控制结构</a></li><li class="dropdown-subitem"><a href="/pages/4074f5/" class="nav-link">超类</a></li><li class="dropdown-subitem"><a href="/pages/db85a8/" class="nav-link">Scanner</a></li><li class="dropdown-subitem"><a href="/pages/341e84/" class="nav-link">反射</a></li><li class="dropdown-subitem"><a href="/pages/7ec08c/" class="nav-link">Serializable(序列化)</a></li><li class="dropdown-subitem"><a href="/pages/fbe16d/" class="nav-link">动态代理</a></li><li class="dropdown-subitem"><a href="/pages/78e39b/" class="nav-link">Enum</a></li><li class="dropdown-subitem"><a href="/pages/0d7979/" class="nav-link">IO流</a></li><li class="dropdown-subitem"><a href="/pages/192add/" class="nav-link">Lambda</a></li><li class="dropdown-subitem"><a href="/pages/d2addf/" class="nav-link">Math</a></li><li class="dropdown-subitem"><a href="/pages/0cdbed/" class="nav-link">Random</a></li><li class="dropdown-subitem"><a href="/pages/b722b1/" class="nav-link">UUID</a></li><li class="dropdown-subitem"><a href="/pages/0f7ad8/" class="nav-link">泛型</a></li><li class="dropdown-subitem"><a href="/pages/148cd7/" class="nav-link">网络通信</a></li><li class="dropdown-subitem"><a href="/pages/f46dcf/" class="nav-link">异常和处理</a></li><li class="dropdown-subitem"><a href="/pages/0e008e/" class="nav-link">正则表达式</a></li><li class="dropdown-subitem"><a href="/pages/f42b16/" class="nav-link">Java注解</a></li><li class="dropdown-subitem"><a href="/pages/dac65d/" class="nav-link">JDBC</a></li></ul></li><li class="dropdown-item"><h4>并发与线程</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/394d30/" class="nav-link">并发编程核心概念</a></li><li class="dropdown-subitem"><a href="/pages/61ba09/" class="nav-link">JUC-2</a></li></ul></li><li class="dropdown-item"><h4>JVM相关</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">JUC-1</a></li><li class="dropdown-subitem"><a href="/pages/61ba09/" class="nav-link">JUC-2</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring" class="dropdown-title"><!----> <span class="title" style="display:;">Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Framework</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/28e3d0/" class="nav-link">基础1</a></li></ul></li><li class="dropdown-item"><h4>Spring Boot</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">JUC-1</a></li><li class="dropdown-subitem"><a href="/pages/61ba09/" class="nav-link">JUC-2</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="SpringCloud" class="dropdown-title"><!----> <span class="title" style="display:;">SpringCloud</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Nacos 注册中心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/9f8459/" class="nav-link">Nacos基本架构和概念</a></li><li class="dropdown-subitem"><a href="/pages/5a44e3/" class="nav-link">Nacos服务注册与发现</a></li><li class="dropdown-subitem"><a href="/pages/20ff14/" class="nav-link">Config服务配置中心</a></li><li class="dropdown-subitem"><a href="/pages/f84a0c/" class="nav-link">Nacos安装部署 </a></li></ul></li><li class="dropdown-item"><h4>Gateway 微服务网关</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/e87c7c/" class="nav-link">Gateway核心概念</a></li><li class="dropdown-subitem"><a href="/pages/6b0fb9/" class="nav-link">Gateway路由</a></li><li class="dropdown-subitem"><a href="/pages/1a393f/" class="nav-link">Gateway断言</a></li><li class="dropdown-subitem"><a href="/pages/60ff28/" class="nav-link">Gateway过滤器</a></li><li class="dropdown-subitem"><a href="/pages/8fc690/" class="nav-link">Alibaba问题汇总</a></li><li class="dropdown-subitem"><a href="/pages/39605b/" class="nav-link">创建Gateway模块</a></li></ul></li><li class="dropdown-item"><h4>微服务通信</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c6a1f4/" class="nav-link">微服务间通信</a></li></ul></li><li class="dropdown-item"><h4>Seata 分布式事务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/d37c45/" class="nav-link">Seata分布式事务解决方案</a></li></ul></li><li class="dropdown-item"><h4>微服务容错</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/470cd5/" class="nav-link">Netflix Hystrix实现微服务容错</a></li><li class="dropdown-subitem"><a href="/pages/d42f64/404" class="nav-link">Sentinel微服务容错</a></li></ul></li><li class="dropdown-item"><h4>Sleuth + Zipkin 日志追踪</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/f082ce/" class="nav-link">Sleuth + Zipkin分布式日志追踪</a></li></ul></li><li class="dropdown-item"><h4>授权、鉴权中心微服务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/5c5a46/" class="nav-link">构建授权、鉴权中心微服务</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><!----> <span class="title" style="display:;">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Cloud Alibaba</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/3b393a/" class="nav-link">JVM-1</a></li><li class="dropdown-subitem"><a href="/pages/f50dfc/" class="nav-link">JVM-3</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title" style="display:;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>MySQL</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/cded12/" class="nav-link">基础篇</a></li><li class="dropdown-subitem"><a href="/pages/49bb95/" class="nav-link">高级篇</a></li><li class="dropdown-subitem"><a href="/pages/59225b/" class="nav-link">工具</a></li></ul></li><li class="dropdown-item"><h4>Oracle</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">Oracle知识点</a></li></ul></li><li class="dropdown-item"><h4>Redis</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">Redis知识点</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架|中间件" class="dropdown-title"><!----> <span class="title" style="display:;">框架|中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring Framework</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/28e3d0/" class="nav-link">基础1</a></li></ul></li><li class="dropdown-item"><h4>Spring Boot</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">JUC-1</a></li><li class="dropdown-subitem"><a href="/pages/61ba09/" class="nav-link">JUC-2</a></li></ul></li><li class="dropdown-item"><h4>Spring Cloud Alibaba</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/3b393a/" class="nav-link">JVM-1</a></li><li class="dropdown-subitem"><a href="/pages/f50dfc/" class="nav-link">JVM-3</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具|部署" class="dropdown-title"><!----> <span class="title" style="display:;">工具|部署</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Docker</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a793d4/" class="nav-link">软件安装篇</a></li><li class="dropdown-subitem"><a href="/pages/f3f84f/" class="nav-link">服务部署篇</a></li></ul></li><li class="dropdown-item"><h4>Git</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/c5c8fc/" class="nav-link">Git知识点</a></li></ul></li><li class="dropdown-item"><h4>Linux</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/bb176d/" class="nav-link">阿里云</a></li></ul></li><li class="dropdown-item"><h4>Idea</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/7eb19a/" class="nav-link">Idea常用插件Top16</a></li><li class="dropdown-subitem"><a href="/pages/55726e/" class="nav-link">Idea设置软换行</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/pages/891539/" class="nav-link">关于我</a></div> <a href="https://github.com/coder-gm" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>MySQL</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>基础篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>高级篇</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/49bb95/" class="sidebar-link">MySQL架构篇</a></li><li><a href="/pages/fc5ac0/" class="sidebar-link">索引及调优篇</a></li><li><a href="/pages/711e05/" class="sidebar-link">事务篇</a></li><li><a href="/pages/d42f64/" aria-current="page" class="active sidebar-link">日志与备份篇</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/d42f64/#_1-什么是mvcc" class="sidebar-link">1. 什么是MVCC</a></li><li class="sidebar-sub-header level2"><a href="/pages/d42f64/#_2-快照读与当前读" class="sidebar-link">2. 快照读与当前读</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_2-1-快照读" class="sidebar-link">2.1 快照读</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_2-2-当前读" class="sidebar-link">2.2 当前读</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/d42f64/#_3-复习" class="sidebar-link">3. 复习</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_3-1-再谈隔离级别" class="sidebar-link">3.1 再谈隔离级别</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_3-2-隐藏字段、undo-log版本链" class="sidebar-link">3.2 隐藏字段、Undo Log版本链</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/d42f64/#_4-mvcc实现原理之readview" class="sidebar-link">4. MVCC实现原理之ReadView</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_4-1-什么是readview" class="sidebar-link">4.1 什么是ReadView</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_4-2-设计思路" class="sidebar-link">4.2 设计思路</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_4-3-readview的规则" class="sidebar-link">4.3 ReadView的规则</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_4-4-mvcc整体操作流程" class="sidebar-link">4.4 MVCC整体操作流程</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/d42f64/#_5-举例说明" class="sidebar-link">5. 举例说明</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_5-1-read-committed隔离级别下" class="sidebar-link">5.1 READ COMMITTED隔离级别下</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_5-2-repeatable-read隔离级别下" class="sidebar-link">5.2 REPEATABLE READ隔离级别下</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_5-3-如何解决幻读" class="sidebar-link">5.3 如何解决幻读</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/d42f64/#_6-总结" class="sidebar-link">6. 总结</a></li><li class="sidebar-sub-header level2"><a href="/pages/d42f64/#_1-mysql支持的日志" class="sidebar-link">1. MySQL支持的日志</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_1-1-日志类型" class="sidebar-link">1.1 日志类型</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_1-2-日志的弊端" class="sidebar-link">1.2 日志的弊端</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/d42f64/#_2-通用查询日志-general-query-log" class="sidebar-link">2. 通用查询日志(general query log)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_2-1-查看当前状态" class="sidebar-link">2.1 查看当前状态</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_2-2-启动日志" class="sidebar-link">2.2 启动日志</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_2-3-停止日志" class="sidebar-link">2.3 停止日志</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/d42f64/#_3-错误日志-error-log" class="sidebar-link">3.错误日志(error log)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_3-1-启动日志" class="sidebar-link">3.1 启动日志</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_3-2-查看日志" class="sidebar-link">3.2 查看日志</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_3-3-删除-刷新日志" class="sidebar-link">3.3 删除\刷新日志</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/d42f64/#_4-二进制日志-bin-log" class="sidebar-link">4. 二进制日志(bin log)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_4-1-查看默认情况" class="sidebar-link">4.1 查看默认情况</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_4-2-日志参数设置" class="sidebar-link">4.2 日志参数设置</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_4-3-查看日志" class="sidebar-link">4.3 查看日志</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_4-4-使用日志恢复数据" class="sidebar-link">4.4 使用日志恢复数据</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_4-5-删除二进制日志" class="sidebar-link">4.5 删除二进制日志</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/d42f64/#_5-再谈二进制日志-binlog" class="sidebar-link">5. 再谈二进制日志(binlog)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_5-1-写入机制" class="sidebar-link">5.1 写入机制</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_5-2-binlog与redolog对比" class="sidebar-link">5.2 binlog与redolog对比</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_5-3-两阶段提交" class="sidebar-link">5.3 两阶段提交</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/d42f64/#_6-中继日志-relay-log" class="sidebar-link">6. 中继日志(relay log)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_6-1-介绍" class="sidebar-link">6.1 介绍</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_6-2-恢复的典型错误" class="sidebar-link">6.2 恢复的典型错误</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/d42f64/#_1-主从复制概述" class="sidebar-link">1. 主从复制概述</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_1-1-如何提升数据库并发能力" class="sidebar-link">1.1 如何提升数据库并发能力</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_1-2-主从复制的作用" class="sidebar-link">1.2 主从复制的作用</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/d42f64/#_2-主从复制的原理" class="sidebar-link">2. 主从复制的原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_2-1-原理剖析" class="sidebar-link">2.1 原理剖析</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_2-2-复制的基本原则" class="sidebar-link">2.2 复制的基本原则</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/d42f64/#_3-同步数据一致性问题" class="sidebar-link">3. 同步数据一致性问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_3-1-理解主从延迟问题" class="sidebar-link">3.1 理解主从延迟问题</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_3-2-主从延迟问题原因" class="sidebar-link">3.2 主从延迟问题原因</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_3-3-如何减少主从延迟" class="sidebar-link">3.3 如何减少主从延迟</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_3-4-如何解决一致性问题" class="sidebar-link">3.4 如何解决一致性问题</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/d42f64/#_1-物理备份与逻辑备份" class="sidebar-link">1. 物理备份与逻辑备份</a></li><li class="sidebar-sub-header level2"><a href="/pages/d42f64/#_2-mysqldump实现逻辑备份" class="sidebar-link">2. mysqldump实现逻辑备份</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_2-1-备份一个数据库" class="sidebar-link">2.1 备份一个数据库</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_2-2-备份全部数据库" class="sidebar-link">2.2 备份全部数据库</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_2-3-备份部分数据库" class="sidebar-link">2.3 备份部分数据库</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_2-4-备份部分表" class="sidebar-link">2.4 备份部分表</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_2-5-备份单表的部分数据" class="sidebar-link">2.5 备份单表的部分数据</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_2-6-排除某些表的备份" class="sidebar-link">2.6 排除某些表的备份</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_2-7-只备份结构或只备份数据" class="sidebar-link">2.7 只备份结构或只备份数据</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_2-8-备份中包含存储过程、函数、事件" class="sidebar-link">2.8 备份中包含存储过程、函数、事件</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/d42f64/#_3-mysql命令恢复数据" class="sidebar-link">3. mysql命令恢复数据</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_3-1-单库备份中恢复单库" class="sidebar-link">3.1 单库备份中恢复单库</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_3-2-全量备份恢复" class="sidebar-link">3.2 全量备份恢复</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_3-3-从全量备份中恢复单库" class="sidebar-link">3.3 从全量备份中恢复单库</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_3-4-从单库备份中恢复单表" class="sidebar-link">3.4 从单库备份中恢复单表</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/d42f64/#_4-表的导出与导入" class="sidebar-link">4. 表的导出与导入</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_4-1-表的导出" class="sidebar-link">4.1 表的导出</a></li><li class="sidebar-sub-header level3"><a href="/pages/d42f64/#_4-2-表的导入" class="sidebar-link">4.2 表的导入</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Oracle</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Redis</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>数据库</span></li><li data-v-06225672><span data-v-06225672>MySQL</span></li><li data-v-06225672><span data-v-06225672>高级篇</span></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="http://coder-note.cn" target="_blank" title="作者" class="beLink" data-v-06225672>Coder'Gm</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-04-24</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">日志与备份篇<!----></h1> <div class="page-slot page-slot-top">
  <div class="wwads-cn wwads-horizontal page-ad" data-id="136" style="width:100%;max-height:80px;min-height:auto;"></div>
  <style>
    .page-ad img{
      width:80px!important;
    }
    .wwads-horizontal .wwads-content{
      display: flex;
      align-items: center;
    }
    .wwads-horizontal .wwads-text, .wwads-content .wwads-text{
      line-height:1;
      flex: 1;
      height: 100%;
      display: flex;
      align-items: center;
    }
    .wwads-horizontal .wwads-poweredby, .wwads-vertical .wwads-poweredby{display: none;!important;}
  </style>
  </div> <div class="theme-vdoing-content content__default"><h1 id="第1章-多版本并发控制"><a href="#第1章-多版本并发控制" class="header-anchor">#</a> 第1章 多版本并发控制</h1> <h2 id="_1-什么是mvcc"><a href="#_1-什么是mvcc" class="header-anchor">#</a> <strong>1.</strong> <strong>什么是MVCC</strong></h2> <p>MVCC （Multiversion Concurrency Control），多版本并发控制。顾名思义，MVCC 是通过数据行的多个版本管理来实现数据库的<code>并发控制</code>。这项技术使得在InnoDB的事务隔离级别下执行<code>一致性读</code>操作有了保证。换言之，就是为了查询一些正在被另一个事务更新的行，并且可以看到它们被更新之前的值，这样在做查询的时候就不用等待另一个事务释放锁。</p> <h2 id="_2-快照读与当前读"><a href="#_2-快照读与当前读" class="header-anchor">#</a> <strong>2.</strong> <strong>快照读与当前读</strong></h2> <p>MVCC在MySQL InnoDB中的实现主要是为了提高数据库并发性能，用更好的方式去处理<code>读-写冲突</code>，做到即使有读写冲突时，也能做到<code>不加锁</code>，<code>非阻塞并发读</code>，而这个读指的就是<code>快照读</code>, 而非<code>当前读</code>。当前读实际上是一种加锁的操作，是悲观锁的实现。而MVCC本质是采用乐观锁思想的一种方式。</p> <h3 id="_2-1-快照读"><a href="#_2-1-快照读" class="header-anchor">#</a> <strong>2.1</strong> <strong>快照读</strong></h3> <p>快照读又叫一致性读，读取的是快照数据。<strong>不加锁的简单的</strong> <strong>SELECT</strong> <strong>都属于快照读</strong>，即不加锁的非阻塞读。</p> <p>之所以出现快照读的情况，是基于提高并发性能的考虑，快照读的实现是基于MVCC，它在很多情况下，避免了加锁操作，降低了开销。</p> <p>既然是基于多版本，那么快照读可能读到的并不一定是数据的最新版本，而有可能是之前的历史版本。</p> <p>快照读的前提是隔离级别不是串行级别，串行级别下的快照读会退化成当前读。</p> <h3 id="_2-2-当前读"><a href="#_2-2-当前读" class="header-anchor">#</a> <strong>2.2</strong> <strong>当前读</strong></h3> <p>当前读读取的是记录的最新版本（最新数据，而不是历史版本的数据），读取时还要保证其他并发事务不能修改当前记录，会对读取的记录进行加锁。加锁的 SELECT，或者对数据进行增删改都会进行当前读。</p> <h2 id="_3-复习"><a href="#_3-复习" class="header-anchor">#</a> <strong>3.</strong> <strong>复习</strong></h2> <h3 id="_3-1-再谈隔离级别"><a href="#_3-1-再谈隔离级别" class="header-anchor">#</a> <strong>3.1</strong> <strong>再谈隔离级别</strong></h3> <p>我们知道事务有 4 个隔离级别，可能存在三种并发问题：</p> <p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051536648.png" alt="image-20220405153617536"></p> <p>另图：</p> <p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051536125.png" alt="image-20220405153632021"></p> <h3 id="_3-2-隐藏字段、undo-log版本链"><a href="#_3-2-隐藏字段、undo-log版本链" class="header-anchor">#</a> <strong>3.2</strong> <strong>隐藏字段、Undo Log版本链</strong></h3> <p>回顾一下undo日志的版本链，对于使用<code>InnoDB</code>存储引擎的表来说，它的聚簇索引记录中都包含两个必要的隐藏列。</p> <ul><li><code>trx_id</code>：每次一个事务对某条聚簇索引记录进行改动时，都会把该事务的<code>事务id</code>赋值给trx_id 隐藏列。</li> <li><code>roll_pointer</code>：每次对某条聚簇索引记录进行改动时，都会把旧的版本写入到 undo日志 中，然后这个隐藏列就相当于一个指针，可以通过它来找到该记录修改前的信息。</li></ul> <h2 id="_4-mvcc实现原理之readview"><a href="#_4-mvcc实现原理之readview" class="header-anchor">#</a> <strong>4. MVCC实现原理之ReadView</strong></h2> <p>MVCC 的实现依赖于：<strong>隐藏字段、Undo Log、Read View</strong>。</p> <h3 id="_4-1-什么是readview"><a href="#_4-1-什么是readview" class="header-anchor">#</a> <strong>4.1</strong> <strong>什么是ReadView</strong></h3> <p>ReadView就是事务在使用MVCC机制进行快照读操作时产生的读视图。当事务启动时，会生成数据库系统当前的一个快照，InnoDB为每个事务构造了一个数组，用来记录并维护系统当前<code>活跃事务</code>的ID（“活跃”指的就是，启动了但还没提交）。</p> <h3 id="_4-2-设计思路"><a href="#_4-2-设计思路" class="header-anchor">#</a> <strong>4.2</strong> <strong>设计思路</strong></h3> <p>使用<code>READ UNCOMMITTED</code>隔离级别的事务，由于可以读到未提交事务修改过的记录，所以直接读取记录的最新版本就好了。</p> <p>使用<code>SERIALIZABLE</code>隔离级别的事务，InnoDB规定使用加锁的方式来访问记录。</p> <p>使用<code>READ COMMITTED</code>和<code>REPEATABLE READ</code>隔离级别的事务，都必须保证读到<code>已经提交了的</code>事务修改过的记录。假如另一个事务已经修改了记录但是尚未提交，是不能直接读取最新版本的记录的，核心问题就是需要判断一下版本链中的哪个版本是当前事务可见的，这是ReadView要解决的主要问题。</p> <p>这个ReadView中主要包含4个比较重要的内容，分别如下：</p> <ol><li><code>creator_trx_id</code>，创建这个 Read View 的事务 ID。</li></ol> <blockquote><p>说明：只有在对表中的记录做改动时（执行INSERT、DELETE、UPDATE这些语句时）才会为事务分配事务id，否则在一个只读事务中的事务id值都默认为0。</p></blockquote> <ol start="2"><li><p><code>trx_ids</code>，表示在生成ReadView时当前系统中活跃的读写事务的<code>事务id列表</code>。</p></li> <li><p><code>up_limit_id</code>，活跃的事务中最小的事务 ID。</p></li> <li><p><code>low_limit_id</code>，表示生成ReadView时系统中应该分配给下一个事务的<code>id</code>值。low_limit_id 是系统最大的事务id值，这里要注意是系统中的事务id，需要区别于正在活跃的事务ID。</p></li></ol> <blockquote><p>注意：low_limit_id并不是trx_ids中的最大值，事务id是递增分配的。比如，现在有id为1， 2，3这三个事务，之后id为3的事务提交了。那么一个新的读事务在生成ReadView时，trx_ids就包括1和2，up_limit_id的值就是1，low_limit_id的值就是4。</p></blockquote> <h3 id="_4-3-readview的规则"><a href="#_4-3-readview的规则" class="header-anchor">#</a> <strong>4.3 ReadView的规则</strong></h3> <p>有了这个ReadView，这样在访问某条记录时，只需要按照下边的步骤判断记录的某个版本是否可见。</p> <ul><li>如果被访问版本的trx_id属性值与ReadView中的<code>creator_trx_id</code>值相同，意味着当前事务在访问它自己修改过的记录，所以该版本可以被当前事务访问。</li> <li>如果被访问版本的trx_id属性值小于ReadView中的<code>up_limit_id</code>值，表明生成该版本的事务在当前事务生成ReadView前已经提交，所以该版本可以被当前事务访问。</li> <li>如果被访问版本的trx_id属性值大于或等于ReadView中的<code>low_limit_id</code>值，表明生成该版本的事务在当前事务生成ReadView后才开启，所以该版本不可以被当前事务访问。</li> <li>如果被访问版本的trx_id属性值在ReadView的<code>up_limit_id</code>和<code>low_limit_id</code>之间，那就需要判断一下trx_id属性值是不是在 trx_ids 列表中。
<ul><li>如果在，说明创建ReadView时生成该版本的事务还是活跃的，该版本不可以被访问。</li> <li>如果不在，说明创建ReadView时生成该版本的事务已经被提交，该版本可以被访问。</li></ul></li></ul> <h3 id="_4-4-mvcc整体操作流程"><a href="#_4-4-mvcc整体操作流程" class="header-anchor">#</a> <strong>4.4 MVCC整体操作流程</strong></h3> <p>了解了这些概念之后，我们来看下当查询一条记录的时候，系统如何通过MVCC找到它：</p> <ol><li><p>首先获取事务自己的版本号，也就是事务 ID；</p></li> <li><p>获取 ReadView；</p></li> <li><p>查询得到的数据，然后与 ReadView 中的事务版本号进行比较；</p></li> <li><p>如果不符合 ReadView 规则，就需要从 Undo Log 中获取历史快照；</p></li> <li><p>最后返回符合规则的数据。</p></li></ol> <p>在隔离级别为读已提交（Read Committed）时，一个事务中的每一次 SELECT 查询都会重新获取一次Read View。</p> <p>如表所示：</p> <p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051549618.png" alt="image-20220405154948505"></p> <blockquote><p>注意，此时同样的查询语句都会重新获取一次 Read View，这时如果 Read View 不同，就可能产生不可重复读或者幻读的情况。</p></blockquote> <p>当隔离级别为可重复读的时候，就避免了不可重复读，这是因为一个事务只在第一次 SELECT 的时候会获取一次 Read View，而后面所有的 SELECT 都会复用这个 Read View，如下表所示：</p> <p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051550072.png" alt="image-20220405155041964"></p> <h2 id="_5-举例说明"><a href="#_5-举例说明" class="header-anchor">#</a> <strong>5.</strong> <strong>举例说明</strong></h2> <h3 id="_5-1-read-committed隔离级别下"><a href="#_5-1-read-committed隔离级别下" class="header-anchor">#</a> <strong>5.1 READ COMMITTED隔离级别下</strong></h3> <p><strong>READ COMMITTED</strong> <strong>：每次读取数据前都生成一个ReadView</strong>。</p> <h3 id="_5-2-repeatable-read隔离级别下"><a href="#_5-2-repeatable-read隔离级别下" class="header-anchor">#</a> <strong>5.2 REPEATABLE READ隔离级别下</strong></h3> <p>使用<code>REPEATABLE READ</code>隔离级别的事务来说，只会在第一次执行查询语句时生成一个 ReadView ，之后的查询就不会重复生成了。</p> <h3 id="_5-3-如何解决幻读"><a href="#_5-3-如何解决幻读" class="header-anchor">#</a> <strong>5.3</strong> <strong>如何解决幻读</strong></h3> <p>假设现在表 student 中只有一条数据，数据内容中，主键 id=1，隐藏的 trx_id=10，它的 undo log 如下图所示。</p> <p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051556631.png" alt="image-20220405155640520"></p> <p>假设现在有事务 A 和事务 B 并发执行，<code>事务 A</code>的事务 id 为<code>20</code>，<code>事务 B</code>的事务 id 为<code>30</code>。</p> <p>步骤1：事务 A 开始第一次查询数据，查询的 SQL 语句如下。</p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>select * from student where id &gt;= 1;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在开始查询之前，MySQL 会为事务 A 产生一个 ReadView，此时 ReadView 的内容如下：<code>trx_ids= [20,30]</code>，<code>up_limit_id=20</code>，<code>low_limit_id=31</code>，<code>creator_trx_id=20</code>。</p> <p>由于此时表 student 中只有一条数据，且符合 where id&gt;=1 条件，因此会查询出来。然后根据 ReadView机制，发现该行数据的trx_id=10，小于事务 A 的 ReadView 里 up_limit_id，这表示这条数据是事务 A 开启之前，其他事务就已经提交了的数据，因此事务 A 可以读取到。</p> <p>结论：事务 A 的第一次查询，能读取到一条数据，id=1。</p> <p>步骤2：接着事务 B(trx_id=30)，往表 student 中新插入两条数据，并提交事务。</p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>insert into student(id,name) values(2,'李四'); 
insert into student(id,name) values(3,'王五');
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>此时表student 中就有三条数据了，对应的 undo 如下图所示：</p> <p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051559345.png" alt="image-20220405155909223"></p> <p>步骤3：接着事务 A 开启第二次查询，根据可重复读隔离级别的规则，此时事务 A 并不会再重新生成ReadView。此时表 student 中的 3 条数据都满足 where id&gt;=1 的条件，因此会先查出来。然后根据ReadView 机制，判断每条数据是不是都可以被事务 A 看到。</p> <p>1）首先 id=1 的这条数据，前面已经说过了，可以被事务 A 看到。</p> <p>2）然后是 id=2 的数据，它的 trx_id=30，此时事务 A 发现，这个值处于 up_limit_id 和 low_limit_id 之间，因此还需要再判断 30 是否处于 trx_ids 数组内。由于事务 A 的 trx_ids=[20,30]，因此在数组内，这表示 id=2 的这条数据是与事务 A 在同一时刻启动的其他事务提交的，所以这条数据不能让事务 A 看到。</p> <p>3）同理，id=3 的这条数据，trx_id 也为 30，因此也不能被事务 A 看见。</p> <p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051559867.png" alt="image-20220405155941753"></p> <p>结论：最终事务 A 的第二次查询，只能查询出 id=1 的这条数据。这和事务 A 的第一次查询的结果是一样的，因此没有出现幻读现象，所以说在 MySQL 的可重复读隔离级别下，不存在幻读问题。</p> <h2 id="_6-总结"><a href="#_6-总结" class="header-anchor">#</a> <strong>6.</strong> <strong>总结</strong></h2> <p>这里介绍了<code>MVCC</code>在<code>READ COMMITTD</code>、<code>REPEATABLE READ</code>这两种隔离级别的事务在执行快照读操作时访问记录的版本链的过程。这样使不同事务的<code>读-写</code>、<code>写-读</code>操作并发执行，从而提升系统性能。</p> <p>核心点在于 ReadView 的原理，<code>READ COMMITTD</code>、<code>REPEATABLE READ</code>这两个隔离级别的一个很大不同就是生成ReadView的时机不同：</p> <ul><li><code>READ COMMITTD</code>在每一次进行普通SELECT操作前都会生成一个ReadView</li> <li><code>REPEATABLE READ</code>只在第一次进行普通SELECT操作前生成一个ReadView，之后的查询操作都重复使用这个ReadView就好了。</li></ul> <h1 id="第2章-其它数据库日志"><a href="#第2章-其它数据库日志" class="header-anchor">#</a> 第2章 其它数据库日志</h1> <h2 id="_1-mysql支持的日志"><a href="#_1-mysql支持的日志" class="header-anchor">#</a> <strong>1. MySQL支持的日志</strong></h2> <h3 id="_1-1-日志类型"><a href="#_1-1-日志类型" class="header-anchor">#</a> <strong>1.1</strong> <strong>日志类型</strong></h3> <p>MySQL有不同类型的日志文件，用来存储不同类型的日志，分为<code>二进制日志</code>、<code>错误日志</code>、<code>通用查询日志</code>和<code>慢查询日志</code>，这也是常用的4种。MySQL 8又新增两种支持的日志：<code>中继日志</code>和<code>数据定义语句日志</code>。使用这些日志文件，可以查看MySQL内部发生的事情。</p> <ul><li><p>**慢查询日志：**记录所有执行时间超过long_query_time的所有查询，方便我们对查询进行优化。</p></li> <li><p>**通用查询日志：**记录所有连接的起始时间和终止时间，以及连接发送给数据库服务器的所有指令，对我们复原操作的实际场景、发现问题，甚至是对数据库操作的审计都有很大的帮助。</p></li> <li><p>**错误日志：**记录MySQL服务的启动、运行或停止MySQL服务时出现的问题，方便我们了解服务器的状态，从而对服务器进行维护。</p></li> <li><p>**二进制日志：**记录所有更改数据的语句，可以用于主从服务器之间的数据同步，以及服务器遇到故障时数据的无损失恢复。</p></li> <li><p>**中继日志：**用于主从服务器架构中，从服务器用来存放主服务器二进制日志内容的一个中间文件。从服务器通过读取中继日志的内容，来同步主服务器上的操作。</p></li> <li><p>**数据定义语句日志：**记录数据定义语句执行的元数据操作。</p></li></ul> <p>除二进制日志外，其他日志都是<code>文本文件</code>。默认情况下，所有日志创建于<code>MySQL数据目录</code>中。</p> <h3 id="_1-2-日志的弊端"><a href="#_1-2-日志的弊端" class="header-anchor">#</a> <strong>1.2</strong> <strong>日志的弊端</strong></h3> <ul><li><p>日志功能会<code>降低MySQL数据库的性能</code>。</p></li> <li><p>日志会<code>占用大量的磁盘空间</code>。</p></li></ul> <h2 id="_2-通用查询日志-general-query-log"><a href="#_2-通用查询日志-general-query-log" class="header-anchor">#</a> <strong>2.</strong> <strong>通用查询日志(general query log)</strong></h2> <p>通用查询日志用来<code>记录用户的所有操作</code>，包括启动和关闭MySQL服务、所有用户的连接开始时间和截止时间、发给 MySQL 数据库服务器的所有 SQL 指令等。当我们的数据发生异常时，<strong>查看通用查询日志，还原操作时的具体场景</strong>，可以帮助我们准确定位问题。</p> <h3 id="_2-1-查看当前状态"><a href="#_2-1-查看当前状态" class="header-anchor">#</a> <strong>2.1</strong> <strong>查看当前状态</strong></h3> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>mysql&gt; SHOW VARIABLES LIKE '%general%';
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-2-启动日志"><a href="#_2-2-启动日志" class="header-anchor">#</a> <strong>2.2</strong> <strong>启动日志</strong></h3> <p><strong>方式1：永久性方式</strong></p> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">mysqld</span><span class="token punctuation">]</span></span> 
<span class="token key attr-name">general_log</span><span class="token punctuation">=</span><span class="token value attr-value">ON</span> 
<span class="token key attr-name">general_log_file</span><span class="token punctuation">=</span><span class="token value attr-value">[path[filename]] #日志文件所在目录路径，filename为日志文件名</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>方式2：临时性方式</strong></p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>SET GLOBAL general_log=on; # 开启通用查询日志
SET GLOBAL general_log_file=’path/filename’; # 设置日志文件保存位置
SET GLOBAL general_log=off; # 关闭通用查询日志
SHOW VARIABLES LIKE 'general_log%'; # 查看设置后情况
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_2-3-停止日志"><a href="#_2-3-停止日志" class="header-anchor">#</a> <strong>2.3</strong> <strong>停止日志</strong></h3> <p><strong>方式1：永久性方式</strong></p> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">mysqld</span><span class="token punctuation">]</span></span> 
<span class="token key attr-name">general_log</span><span class="token punctuation">=</span><span class="token value attr-value">OFF</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>方式2：临时性方式</strong></p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>SET GLOBAL general_log=off;
SHOW VARIABLES LIKE 'general_log%';
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="_3-错误日志-error-log"><a href="#_3-错误日志-error-log" class="header-anchor">#</a> <strong>3.错误日志(error log)</strong></h2> <h3 id="_3-1-启动日志"><a href="#_3-1-启动日志" class="header-anchor">#</a> <strong>3.1</strong> <strong>启动日志</strong></h3> <p>在MySQL数据库中，错误日志功能是<code>默认开启</code>的。而且，错误日志<code>无法被禁止</code>。</p> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">mysqld</span><span class="token punctuation">]</span></span> 
<span class="token key attr-name">log-error</span><span class="token punctuation">=</span><span class="token value attr-value">[path/[filename]] #path为日志文件所在的目录路径，filename为日志文件名</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_3-2-查看日志"><a href="#_3-2-查看日志" class="header-anchor">#</a> <strong>3.2</strong> <strong>查看日志</strong></h3> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>mysql&gt; SHOW VARIABLES LIKE 'log_err%';
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_3-3-删除-刷新日志"><a href="#_3-3-删除-刷新日志" class="header-anchor">#</a> <strong>3.3</strong> <strong>删除\刷新日志</strong></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">install</span> -omysql -gmysql -m0644 /dev/null /var/log/mysqld.log
mysqladmin -uroot -p flush-logs
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="_4-二进制日志-bin-log"><a href="#_4-二进制日志-bin-log" class="header-anchor">#</a> <strong>4.</strong> <strong>二进制日志(bin log)</strong></h2> <h3 id="_4-1-查看默认情况"><a href="#_4-1-查看默认情况" class="header-anchor">#</a> <strong>4.1</strong> <strong>查看默认情况</strong></h3> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>mysql&gt; show variables like '%log_bin%';
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_4-2-日志参数设置"><a href="#_4-2-日志参数设置" class="header-anchor">#</a> <strong>4.2</strong> <strong>日志参数设置</strong></h3> <p><strong>方式1：永久性方式</strong></p> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">mysqld</span><span class="token punctuation">]</span></span> 
<span class="token comment">#启用二进制日志 </span>
<span class="token key attr-name">log-bin</span><span class="token punctuation">=</span><span class="token value attr-value">atguigu-bin</span> 
<span class="token key attr-name">binlog_expire_logs_seconds</span><span class="token punctuation">=</span><span class="token value attr-value">600 max_binlog_size=100M</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>设置带文件夹的bin-log日志存放目录</strong></p> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">mysqld</span><span class="token punctuation">]</span></span> 
<span class="token key attr-name">log-bin</span><span class="token punctuation">=</span><span class="token value attr-value">&quot;<span class="token inner-value">/var/lib/mysql/binlog/atguigu-bin</span>&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>注意：新建的文件夹需要使用mysql用户，使用下面的命令即可。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">chown</span> -R -v mysql:mysql binlog
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>方式2：临时性方式</strong></p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code># global 级别 
mysql&gt; set global sql_log_bin=0; 
ERROR 1228 (HY000): Variable 'sql_log_bin' is a SESSION variable and can`t be used with SET GLOBAL 

# session级别 
mysql&gt; SET sql_log_bin=0; 
Query OK, 0 rows affected (0.01 秒)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_4-3-查看日志"><a href="#_4-3-查看日志" class="header-anchor">#</a> <strong>4.3</strong> <strong>查看日志</strong></h3> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>mysqlbinlog -v &quot;/var/lib/mysql/binlog/atguigu-bin.000002&quot;
# 不显示binlog格式的语句
mysqlbinlog -v --base64-output=DECODE-ROWS &quot;/var/lib/mysql/binlog/atguigu-bin.000002&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-mysql line-numbers-mode"><pre class="language-text"><code># 可查看参数帮助 
mysqlbinlog --no-defaults --help 

# 查看最后100行 
mysqlbinlog --no-defaults --base64-output=decode-rows -vv atguigu-bin.000002 |tail -100 

# 根据position查找 
mysqlbinlog --no-defaults --base64-output=decode-rows -vv atguigu-bin.000002 |grep -A20 '4939002'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>上面这种办法读取出binlog日志的全文内容比较多，不容易分辨查看到pos点信息，下面介绍一种更为方便的查询命令：</p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>mysql&gt; show binlog events [IN 'log_name'] [FROM pos] [LIMIT [offset,] row_count];
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>IN 'log_name'</code>：指定要查询的binlog文件名（不指定就是第一个binlog文件）</li> <li><code>FROM pos</code>：指定从哪个pos起始点开始查起（不指定就是从整个文件首个pos点开始算）</li> <li><code>LIMIT [offset]</code>：偏移量(不指定就是0)</li> <li><code>row_count</code>:查询总条数（不指定就是所有行）</li></ul> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>mysql&gt; show binlog events in 'atguigu-bin.000002';
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_4-4-使用日志恢复数据"><a href="#_4-4-使用日志恢复数据" class="header-anchor">#</a> <strong>4.4</strong> <strong>使用日志恢复数据</strong></h3> <p>mysqlbinlog恢复数据的语法如下：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysqlbinlog <span class="token punctuation">[</span>option<span class="token punctuation">]</span> filename<span class="token operator">|</span>mysql –uuser -ppass<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>filename</code>：是日志文件名。</li> <li><code>option</code>：可选项，比较重要的两对option参数是--start-date、--stop-date 和 --start-position、-- stop-position。
<ul><li><code>--start-date 和 --stop-date</code>：可以指定恢复数据库的起始时间点和结束时间点。</li> <li><code>--start-position和--stop-position</code>：可以指定恢复数据的开始位置和结束位置。</li></ul></li></ul> <blockquote><p>注意：使用mysqlbinlog命令进行恢复操作时，必须是编号小的先恢复，例如atguigu-bin.000001必须在atguigu-bin.000002之前恢复。</p></blockquote> <h3 id="_4-5-删除二进制日志"><a href="#_4-5-删除二进制日志" class="header-anchor">#</a> <strong>4.5</strong> <strong>删除二进制日志</strong></h3> <p><strong>1. PURGE MASTER LOGS：删除指定日志文件</strong></p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>PURGE {MASTER | BINARY} LOGS TO ‘指定日志文件名’ 
PURGE {MASTER | BINARY} LOGS BEFORE ‘指定日期’
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="_5-再谈二进制日志-binlog"><a href="#_5-再谈二进制日志-binlog" class="header-anchor">#</a> <strong>5.</strong> <strong>再谈二进制日志(binlog)</strong></h2> <h3 id="_5-1-写入机制"><a href="#_5-1-写入机制" class="header-anchor">#</a> <strong>5.1</strong> <strong>写入机制</strong></h3> <p>binlog的写入时机也非常简单，事务执行过程中，先把日志写到<code>binlog cache</code>，事务提交的时候，再把binlog cache写到binlog文件中。因为一个事务的binlog不能被拆开，无论这个事务多大，也要确保一次性写入，所以系统会给每个线程分配一个块内存作为binlog cache。</p> <p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051630535.png" alt="image-20220405163025361"></p> <p>write和fsync的时机，可以由参数<code>sync_binlog</code>控制，默认是 <code>0</code>。为0的时候，表示每次提交事务都只write，由系统自行判断什么时候执行fsync。虽然性能得到提升，但是机器宕机，page cache里面的binglog 会丢失。如下图：</p> <p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051631346.png" alt="image-20220405163125180"></p> <p>为了安全起见，可以设置为<code>1</code>，表示每次提交事务都会执行fsync，就如同<strong>redo log</strong> <strong>刷盘流程</strong>一样。最后还有一种折中方式，可以设置为N(N&gt;1)，表示每次提交事务都write，但累积N个事务后才fsync。</p> <p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051632526.png" alt="image-20220405163205364"></p> <p>在出现IO瓶颈的场景里，将sync_binlog设置成一个比较大的值，可以提升性能。同样的，如果机器宕机，会丢失最近N个事务的binlog日志。</p> <h3 id="_5-2-binlog与redolog对比"><a href="#_5-2-binlog与redolog对比" class="header-anchor">#</a> <strong>5.2 binlog与redolog对比</strong></h3> <ul><li>redo log 它是<code>物理日志</code>，记录内容是“在某个数据页上做了什么修改”，属于 InnoDB 存储引擎层产生的。</li> <li>而 binlog 是<code>逻辑日志</code>，记录内容是语句的原始逻辑，类似于“给 ID=2 这一行的 c 字段加 1”，属于MySQL Server 层。</li> <li>虽然它们都属于持久化的保证，但是侧重点不同。
<ul><li>redo log 让InnoDB存储引擎拥有了崩溃恢复能力。</li> <li>binlog保证了MySQL集群架构的数据一致性</li></ul></li></ul> <h3 id="_5-3-两阶段提交"><a href="#_5-3-两阶段提交" class="header-anchor">#</a> <strong>5.3</strong> <strong>两阶段提交</strong></h3> <p>在执行更新语句过程，会记录redo log与binlog两块日志，以基本的事务为单位，redo log在事务执行过程中可以不断写入，而binlog只有在提交事务时才写入，所以redo log与binlog的<code>写入时机</code>不一样。</p> <p>为了解决两份日志之间的逻辑一致问题，InnoDB存储引擎使用<strong>两阶段提交</strong>方案。</p> <p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051637390.png" alt="image-20220405163716222"></p> <p>使用<strong>两阶段提交</strong>后，写入binlog时发生异常也不会有影响</p> <p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051639192.png" alt="image-20220405163902977"></p> <p>另一个场景，redo log设置commit阶段发生异常，那会不会回滚事务呢？</p> <p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051639403.png" alt="image-20220405163927129"></p> <p>并不会回滚事务，它会执行上图框住的逻辑，虽然redo log是处于prepare阶段，但是能通过事务id找到对应的binlog日志，所以MySQL认为是完整的，就会提交事务恢复数据。</p> <h2 id="_6-中继日志-relay-log"><a href="#_6-中继日志-relay-log" class="header-anchor">#</a> <strong>6.</strong> <strong>中继日志(relay log)</strong></h2> <h3 id="_6-1-介绍"><a href="#_6-1-介绍" class="header-anchor">#</a> <strong>6.1</strong> <strong>介绍</strong></h3> <p><strong>中继日志只在主从服务器架构的从服务器上存在</strong>。从服务器为了与主服务器保持一致，要从主服务器读取二进制日志的内容，并且把读取到的信息写入<code>本地的日志文件</code>中，这个从服务器本地的日志文件就叫<code>中继日志</code>。然后，从服务器读取中继日志，并根据中继日志的内容对从服务器的数据进行更新，完成主从服务器的<code>数据同步</code>。</p> <h3 id="_6-2-恢复的典型错误"><a href="#_6-2-恢复的典型错误" class="header-anchor">#</a> <strong>6.2</strong> <strong>恢复的典型错误</strong></h3> <p>如果从服务器宕机，有的时候为了系统恢复，要重装操作系统，这样就可能会导致你的<code>服务器名称</code>与之前<code>不同</code>。而中继日志里是<code>包含从服务器名</code>的。在这种情况下，就可能导致你恢复从服务器的时候，无法从宕机前的中继日志里读取数据，以为是日志文件损坏了，其实是名称不对了。</p> <p>解决的方法也很简单，把从服务器的名称改回之前的名称。</p> <h1 id="第3章-主从复制"><a href="#第3章-主从复制" class="header-anchor">#</a> 第3章 主从复制</h1> <h2 id="_1-主从复制概述"><a href="#_1-主从复制概述" class="header-anchor">#</a> <strong>1.</strong> <strong>主从复制概述</strong></h2> <h3 id="_1-1-如何提升数据库并发能力"><a href="#_1-1-如何提升数据库并发能力" class="header-anchor">#</a> <strong>1.1</strong> <strong>如何提升数据库并发能力</strong></h3> <p>一般应用对数据库而言都是“<code>读多写少</code>”，也就说对数据库读取数据的压力比较大，有一个思路就是采用数据库集群的方案，做<code>主从架构</code>、进行<code>读写分离</code>，这样同样可以提升数据库的并发处理能力。但并不是所有的应用都需要对数据库进行主从架构的设置，毕竟设置架构本身是有成本的。</p> <p>如果我们的目的在于提升数据库高并发访问的效率，那么首先考虑的是如何<code>优化SQL和索引</code>，这种方式简单有效；其次才是采用<code>缓存的策略</code>，比如使用 Redis将热点数据保存在内存数据库中，提升读取的效率；最后才是对数据库采用<code>主从架构</code>，进行读写分离。</p> <h3 id="_1-2-主从复制的作用"><a href="#_1-2-主从复制的作用" class="header-anchor">#</a> <strong>1.2</strong> <strong>主从复制的作用</strong></h3> <p><strong>第1个作用：读写分离。</strong></p> <p><strong>第2个作用就是数据备份。</strong></p> <p><strong>第3个作用是具有高可用性。</strong></p> <h2 id="_2-主从复制的原理"><a href="#_2-主从复制的原理" class="header-anchor">#</a> <strong>2.</strong> <strong>主从复制的原理</strong></h2> <h3 id="_2-1-原理剖析"><a href="#_2-1-原理剖析" class="header-anchor">#</a> <strong>2.1</strong> <strong>原理剖析</strong></h3> <p><strong>三个线程</strong></p> <p>实际上主从同步的原理就是基于 binlog 进行数据同步的。在主从复制过程中，会基于<code>3 个线程</code>来操作，一个主库线程，两个从库线程。</p> <p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051646097.png" alt="image-20220405164559961"></p> <p><code>二进制日志转储线程</code>（Binlog dump thread）是一个主库线程。当从库线程连接的时候， 主库可以将二进制日志发送给从库，当主库读取事件（Event）的时候，会在 Binlog 上<code>加锁</code>，读取完成之后，再将锁释放掉。</p> <p><code>从库 I/O 线程</code>会连接到主库，向主库发送请求更新 Binlog。这时从库的 I/O 线程就可以读取到主库的二进制日志转储线程发送的 Binlog 更新部分，并且拷贝到本地的中继日志 （Relay log）。</p> <p><code>从库 SQL 线程</code>会读取从库中的中继日志，并且执行日志中的事件，将从库中的数据与主库保持同步。</p> <p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051647759.png" alt="image-20220405164718627"></p> <p><strong>复制三步骤</strong></p> <p>步骤1：<code>Master</code>将写操作记录到二进制日志（<code>binlog</code>）。</p> <p>步骤2：<code>Slave</code>将<code>Master</code>的binary log events拷贝到它的中继日志（<code>relay log</code>）；</p> <p>步骤3：<code>Slave</code>重做中继日志中的事件，将改变应用到自己的数据库中。 MySQL复制是异步的且串行化的，而且重启后从<code>接入点</code>开始复制。</p> <p><strong>复制的问题</strong></p> <p>复制的最大问题：<code>延时</code></p> <h3 id="_2-2-复制的基本原则"><a href="#_2-2-复制的基本原则" class="header-anchor">#</a> <strong>2.2</strong> <strong>复制的基本原则</strong></h3> <ul><li><p>每个<code>Slave</code>只有一个<code>Master</code></p></li> <li><p>每个<code>Slave</code>只能有一个唯一的服务器ID</p></li> <li><p>每个<code>Master</code>可以有多个<code>Slave</code></p></li></ul> <h2 id="_3-同步数据一致性问题"><a href="#_3-同步数据一致性问题" class="header-anchor">#</a> <strong>3.</strong> <strong>同步数据一致性问题</strong></h2> <p><strong>主从同步的要求：</strong></p> <ul><li><p>读库和写库的数据一致(最终一致)；</p></li> <li><p>写数据必须写到写库；</p></li> <li><p>读数据必须到读库(不一定)；</p></li></ul> <h3 id="_3-1-理解主从延迟问题"><a href="#_3-1-理解主从延迟问题" class="header-anchor">#</a> <strong>3.1</strong> <strong>理解主从延迟问题</strong></h3> <p>进行主从同步的内容是二进制日志，它是一个文件，在进行<code>网络传输</code>的过程中就一定会<code>存在主从延迟</code>（比如 500ms），这样就可能造成用户在从库上读取的数据不是最新的数据，也就是主从同步中的<code>数据不一致性</code>问题。</p> <h3 id="_3-2-主从延迟问题原因"><a href="#_3-2-主从延迟问题原因" class="header-anchor">#</a> <strong>3.2</strong> <strong>主从延迟问题原因</strong></h3> <p>在网络正常的时候，日志从主库传给从库所需的时间是很短的，即T2-T1的值是非常小的。即，网络正常情况下，主备延迟的主要来源是备库接收完binlog和执行完这个事务之间的时间差。</p> <p>**主备延迟最直接的表现是，从库消费中继日志（relay log）的速度，比主库生产binlog的速度要慢。**造成原因：</p> <p>1、从库的机器性能比主库要差</p> <p>2、从库的压力大</p> <p>3、大事务的执行</p> <h3 id="_3-3-如何减少主从延迟"><a href="#_3-3-如何减少主从延迟" class="header-anchor">#</a> <strong>3.3</strong> <strong>如何减少主从延迟</strong></h3> <p>若想要减少主从延迟的时间，可以采取下面的办法：</p> <ol><li><p>降低多线程大事务并发的概率，优化业务逻辑</p></li> <li><p>优化SQL，避免慢SQL，<code>减少批量操作</code>，建议写脚本以update-sleep这样的形式完成。</p></li> <li><p><code>提高从库机器的配置</code>，减少主库写binlog和从库读binlog的效率差。</p></li> <li><p>尽量采用<code>短的链路</code>，也就是主库和从库服务器的距离尽量要短，提升端口带宽，减少binlog传输的网络延时。</p></li> <li><p>实时性要求的业务读强制走主库，从库只做灾备，备份。</p></li></ol> <h3 id="_3-4-如何解决一致性问题"><a href="#_3-4-如何解决一致性问题" class="header-anchor">#</a> <strong>3.4</strong> <strong>如何解决一致性问题</strong></h3> <p>读写分离情况下，解决主从同步中数据不一致的问题， 就是解决主从之间 数据复制方式 的问题，如果按照数据一致性 从弱到强 来进行划分，有以下 3 种复制方式。</p> <p><strong>方法</strong> <strong>1：异步复制</strong></p> <p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051654133.png" alt="image-20220405165455998"></p> <p><strong>方法</strong> <strong>2：半同步复制</strong></p> <p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051655175.png" alt="image-20220405165513025"></p> <p><strong>方法</strong> <strong>3：组复制</strong></p> <p>首先我们将多个节点共同组成一个复制组，在<code>执行读写（RW）事务</code>的时候，需要通过一致性协议层（Consensus 层）的同意，也就是读写事务想要进行提交，必须要经过组里“大多数人”（对应 Node 节点）的同意，大多数指的是同意的节点数量需要大于 （N/2+1），这样才可以进行提交，而不是原发起方一个说了算。而针对<code>只读（RO）事务</code>则不需要经过组内同意，直接 COMMIT 即可。</p> <p><img src="https://cdn.jsdelivr.net/gh/aoshihuankong/cloudimg@master/img/202204051656560.png" alt="image-20220405165650425"></p> <h1 id="第4章-数据库备份与恢复"><a href="#第4章-数据库备份与恢复" class="header-anchor">#</a> 第4章 数据库备份与恢复</h1> <h2 id="_1-物理备份与逻辑备份"><a href="#_1-物理备份与逻辑备份" class="header-anchor">#</a> <strong>1.</strong> <strong>物理备份与逻辑备份</strong></h2> <p><strong>物理备份</strong>：备份数据文件，转储数据库物理文件到某一目录。物理备份恢复速度比较快，但占用空间比较大，MySQL中可以用<code>xtrabackup</code>工具来进行物理备份。</p> <p><strong>逻辑备份</strong>：对数据库对象利用工具进行导出工作，汇总入备份文件内。逻辑备份恢复速度慢，但占用空间小，更灵活。MySQL 中常用的逻辑备份工具为<code>mysqldump</code>。逻辑备份就是<code>备份sql语句</code>，在恢复的时候执行备份的sql语句实现数据库数据的重现。</p> <h2 id="_2-mysqldump实现逻辑备份"><a href="#_2-mysqldump实现逻辑备份" class="header-anchor">#</a> <strong>2. mysqldump实现逻辑备份</strong></h2> <h3 id="_2-1-备份一个数据库"><a href="#_2-1-备份一个数据库" class="header-anchor">#</a> <strong>2.1</strong> <strong>备份一个数据库</strong></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysqldump –u 用户名称 –h 主机名称 –p密码 待备份的数据库名称<span class="token punctuation">[</span>tbname, <span class="token punctuation">[</span>tbname<span class="token punctuation">..</span>.<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> 备份文件名 称.sql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysqldump -uroot -p atguigu<span class="token operator">&gt;</span>atguigu.sql <span class="token comment">#备份文件存储在当前目录下</span>
mysqldump -uroot -p atguigudb1 <span class="token operator">&gt;</span> /var/lib/mysql/atguigu.sql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_2-2-备份全部数据库"><a href="#_2-2-备份全部数据库" class="header-anchor">#</a> <strong>2.2</strong> <strong>备份全部数据库</strong></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysqldump -uroot -pxxxxxx --all-databases <span class="token operator">&gt;</span> all_database.sql 
mysqldump -uroot -pxxxxxx -A <span class="token operator">&gt;</span> all_database.sql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_2-3-备份部分数据库"><a href="#_2-3-备份部分数据库" class="header-anchor">#</a> <strong>2.3</strong> <strong>备份部分数据库</strong></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysqldump –u user –h <span class="token function">host</span> –p --databases <span class="token punctuation">[</span>数据库的名称1 <span class="token punctuation">[</span>数据库的名称2<span class="token punctuation">..</span>.<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> 备份文件名 称.sql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysqldump -uroot -p --databases atguigu atguigu12 <span class="token operator">&gt;</span>two_database.sql
mysqldump -uroot -p -B atguigu atguigu12 <span class="token operator">&gt;</span> two_database.sql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_2-4-备份部分表"><a href="#_2-4-备份部分表" class="header-anchor">#</a> <strong>2.4</strong> <strong>备份部分表</strong></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysqldump –u user –h <span class="token function">host</span> –p 数据库的名称 <span class="token punctuation">[</span>表名1 <span class="token punctuation">[</span>表名2<span class="token punctuation">..</span>.<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> 备份文件名称.sql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysqldump -uroot -p atguigu book<span class="token operator">&gt;</span> book.sql
<span class="token comment">#备份多张表 </span>
mysqldump -uroot -p atguigu book account <span class="token operator">&gt;</span> 2_tables_bak.sql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_2-5-备份单表的部分数据"><a href="#_2-5-备份单表的部分数据" class="header-anchor">#</a> <strong>2.5</strong> <strong>备份单表的部分数据</strong></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysqldump -uroot -p atguigu student --where<span class="token operator">=</span><span class="token string">&quot;id &lt; 10 &quot;</span> <span class="token operator">&gt;</span> student_part_id10_low_bak.sql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-6-排除某些表的备份"><a href="#_2-6-排除某些表的备份" class="header-anchor">#</a> <strong>2.6</strong> <strong>排除某些表的备份</strong></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysqldump -uroot -p atguigu --ignore-table<span class="token operator">=</span>atguigu.student <span class="token operator">&gt;</span> no_stu_bak.sql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-7-只备份结构或只备份数据"><a href="#_2-7-只备份结构或只备份数据" class="header-anchor">#</a> <strong>2.7</strong> <strong>只备份结构或只备份数据</strong></h3> <ul><li>只备份结构</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysqldump -uroot -p atguigu --no-data <span class="token operator">&gt;</span> atguigu_no_data_bak.sql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>只备份数据</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysqldump -uroot -p atguigu --no-create-info <span class="token operator">&gt;</span> atguigu_no_create_info_bak.sql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-8-备份中包含存储过程、函数、事件"><a href="#_2-8-备份中包含存储过程、函数、事件" class="header-anchor">#</a> <strong>2.8</strong> <strong>备份中包含存储过程、函数、事件</strong></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysqldump -uroot -p -R -E --databases atguigu <span class="token operator">&gt;</span> fun_atguigu_bak.sql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_3-mysql命令恢复数据"><a href="#_3-mysql命令恢复数据" class="header-anchor">#</a> <strong>3. mysql命令恢复数据</strong></h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysql –u root –p <span class="token punctuation">[</span>dbname<span class="token punctuation">]</span> <span class="token operator">&lt;</span> backup.sql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_3-1-单库备份中恢复单库"><a href="#_3-1-单库备份中恢复单库" class="header-anchor">#</a> <strong>3.1</strong> <strong>单库备份中恢复单库</strong></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#备份文件中包含了创建数据库的语句</span>
mysql -uroot -p <span class="token operator">&lt;</span> atguigu.sql
<span class="token comment">#备份文件中不包含了创建数据库的语句</span>
mysql -uroot -p atguigu<span class="token operator"><span class="token file-descriptor important">4</span>&lt;</span> atguigu.sql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_3-2-全量备份恢复"><a href="#_3-2-全量备份恢复" class="header-anchor">#</a> <strong>3.2</strong> <strong>全量备份恢复</strong></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysql –u root –p <span class="token operator">&lt;</span> all.sql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_3-3-从全量备份中恢复单库"><a href="#_3-3-从全量备份中恢复单库" class="header-anchor">#</a> <strong>3.3</strong> <strong>从全量备份中恢复单库</strong></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sed</span> -n <span class="token string">'/^-- Current Database: `atguigu`/,/^-- Current Database: `/p'</span> all_database.sql <span class="token operator">&gt;</span> atguigu.sql 
<span class="token comment">#分离完成后我们再导入atguigu.sql即可恢复单个库</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_3-4-从单库备份中恢复单表"><a href="#_3-4-从单库备份中恢复单表" class="header-anchor">#</a> <strong>3.4</strong> <strong>从单库备份中恢复单表</strong></h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cat</span> atguigu.sql <span class="token operator">|</span> <span class="token function">sed</span> -e <span class="token string">'/./{H;$!d;}'</span> -e <span class="token string">'x;/CREATE TABLE `class`/!d;q'</span> <span class="token operator">&gt;</span> class_structure.sql 
<span class="token function">cat</span> atguigu.sql <span class="token operator">|</span> <span class="token function">grep</span> --ignore-case <span class="token string">'insert into `class`'</span> <span class="token operator">&gt;</span> class_data.sql 
<span class="token comment">#用shell语法分离出创建表的语句及插入数据的语句后 再依次导出即可完成恢复 </span>

use atguigu<span class="token punctuation">;</span> 
mysql<span class="token operator">&gt;</span> <span class="token builtin class-name">source</span> class_structure.sql<span class="token punctuation">;</span> 
Query OK, <span class="token number">0</span> rows affected, <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span> 

mysql<span class="token operator">&gt;</span> <span class="token builtin class-name">source</span> class_data.sql<span class="token punctuation">;</span> 
Query OK, <span class="token number">1</span> row affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="_4-表的导出与导入"><a href="#_4-表的导出与导入" class="header-anchor">#</a> <strong>4.</strong> <strong>表的导出与导入</strong></h2> <h3 id="_4-1-表的导出"><a href="#_4-1-表的导出" class="header-anchor">#</a> <strong>4.1</strong> <strong>表的导出</strong></h3> <p><strong>1.</strong> <strong>使用SELECT…INTO OUTFILE导出文本文件</strong></p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>SHOW GLOBAL VARIABLES LIKE '%secure%';
SELECT * FROM account INTO OUTFILE &quot;/var/lib/mysql-files/account.txt&quot;;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>2.</strong> <strong>使用mysqldump命令导出文本文件</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysqldump -uroot -p -T <span class="token string">&quot;/var/lib/mysql-files/&quot;</span> atguigu account
<span class="token comment"># 或</span>
mysqldump -uroot -p -T <span class="token string">&quot;/var/lib/mysql-files/&quot;</span> atguigu account --fields-terminated- <span class="token assign-left variable">by</span><span class="token operator">=</span><span class="token string">','</span> --fields-optionally-enclosed-by<span class="token operator">=</span><span class="token string">'\&quot;'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>3.</strong> <strong>使用mysql命令导出文本文件</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysql -uroot -p --execute<span class="token operator">=</span><span class="token string">&quot;SELECT * FROM account;&quot;</span> atguigu<span class="token operator">&gt;</span> <span class="token string">&quot;/var/lib/mysql-files/account.txt&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_4-2-表的导入"><a href="#_4-2-表的导入" class="header-anchor">#</a> <strong>4.2</strong> <strong>表的导入</strong></h3> <p><strong>1.</strong> <strong>使用LOAD DATA INFILE方式导入文本文件</strong></p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>LOAD DATA INFILE '/var/lib/mysql-files/account_0.txt' INTO TABLE atguigu.account;
# 或
LOAD DATA INFILE '/var/lib/mysql-files/account_1.txt' INTO TABLE atguigu.account FIELDS TERMINATED BY ',' ENCLOSED BY '\&quot;';
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>2.</strong> <strong>使用mysqlimport方式导入文本文件</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysqlimport -uroot -p atguigu <span class="token string">'/var/lib/mysql-files/account.txt'</span> --fields-terminated- <span class="token assign-left variable">by</span><span class="token operator">=</span><span class="token string">','</span> --fields-optionally-enclosed-by<span class="token operator">=</span><span class="token string">'\&quot;'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div></div>  <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/06/04, 00:16:10</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/711e05/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">事务篇</div></a> <a href="/pages/59225b/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">MySQL查询所有表和字段信息</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/711e05/" class="prev">事务篇</a></span> <span class="next"><a href="/pages/59225b/">MySQL查询所有表和字段信息</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:zgming@aliyun.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/coder-gm" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2017-2022
    <span>苏ICP备2022003313号-1</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.44e0923e.js" defer></script><script src="/assets/js/2.4a42c91c.js" defer></script><script src="/assets/js/93.b5aecfec.js" defer></script>
  </body>
</html>
